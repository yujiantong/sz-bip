<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.bofide.bip.mapper.RenewalingCustomerMapper" >
  <resultMap id="BaseResultMap" type="com.bofide.bip.po.RenewalingCustomer" >
  	<id column="id" property="id" jdbcType="INTEGER" />
    <result column="customerId" property="customerId" jdbcType="INTEGER" />
    <result column="fourSStoreId" property="fourSStoreId" jdbcType="INTEGER" />
    <result column="fourSStore" property="fourSStore" jdbcType="VARCHAR" />
    <result column="carOwner" property="carOwner" jdbcType="VARCHAR" />
    <result column="insured" property="insured" jdbcType="VARCHAR" />
    <result column="certificateNumber" property="certificateNumber" jdbcType="VARCHAR"/>
    <result column="contact" property="contact" jdbcType="VARCHAR" />
    <result column="contactWay" property="contactWay" jdbcType="VARCHAR" />
    <result column="address" property="address" jdbcType="VARCHAR" />
    <result column="chassisNumber" property="chassisNumber" jdbcType="VARCHAR" />
    <result column="engineNumber" property="engineNumber" jdbcType="VARCHAR" />
    <result column="insuranceCompLY" property="insuranceCompLY" jdbcType="VARCHAR" />
    <result column="syxrqEnd" property="syxrqEnd" jdbcType="DATE" />
    <result column="insuranceEndDate" property="jqxrqEnd" jdbcType="DATE"/>
    <result column="zdZheKou" property="zdZheKou" jdbcType="DOUBLE"/>
    <result column="carBrand" property="carBrand" jdbcType="VARCHAR" />
    <result column="vehicleModel" property="vehicleModel" jdbcType="VARCHAR" />
    <result column="carLicenseNumber" property="carLicenseNumber" jdbcType="VARCHAR" />
    <result column="registrationDate" property="registrationDate" jdbcType="DATE" />
    <result column="renewalType" property="renewalType" jdbcType="INTEGER" />
    <result column="solicitMemberLY" property="solicitMemberLY" jdbcType="VARCHAR" />
    <result column="insuranceTypeLY" property="insuranceTypeLY" jdbcType="VARCHAR" />
    <result column="renewalWay" property="renewalWay" jdbcType="VARCHAR" />
    <result column="insurNumber" property="insurNumber" jdbcType="INTEGER" />
    <result column="insurDateLY" property="insurDateLY" jdbcType="DATE" />
    <result column="insuranceCoverageLY" property="insuranceCoverageLY" jdbcType="DOUBLE" />
    <result column="isMaintainAgain" property="isMaintainAgain" jdbcType="INTEGER" />
    <result column="maintainNumberLY" property="maintainNumberLY" jdbcType="INTEGER" />
    <result column="accidentNumberLY" property="accidentNumberLY" jdbcType="INTEGER" />
    <result column="accidentOutputValueLY" property="accidentOutputValueLY" jdbcType="INTEGER" />
    <result column="serviceConsultantId" property="serviceConsultantId" jdbcType="INTEGER"/>
    <result column="serviceConsultant" property="serviceConsultant" jdbcType="VARCHAR" />
    <result column="customerLevel" property="customerLevel" jdbcType="VARCHAR" />
    <result column="principal" property="principal" jdbcType="VARCHAR" />
    <result column="principalId" property="principalId" jdbcType="INTEGER" />
 	<result column="clerkId" property="clerkId" jdbcType="INTEGER" />
 	<result column="clerk" property="clerk" jdbcType="VARCHAR" />
 	<result column="customerSource" property="customerSource" jdbcType="VARCHAR"/>
    <result column="customerCharacter" property="customerCharacter" jdbcType="VARCHAR"/>
    <result column="remark" property="remark" jdbcType="VARCHAR" />
    <result column="status" property="status" jdbcType="INTEGER"/>
    <result column="isInvite" property="isInvite" jdbcType="INTEGER" />
    <result column="inviteDate" property="inviteDate" jdbcType="DATE" />
    <result column="isComeStore" property="isComeStore" jdbcType="INTEGER" />
    <result column="comeStoreDate" property="comeStoreDate" jdbcType="DATE" />
    <result column="comeStoreNumber" property="comeStoreNumber" jdbcType="INTEGER"/>
    <result column="sfgyx" property="sfgyx" jdbcType="INTEGER"/>
    <result column="lastTraceDate" property="lastTraceDate" jdbcType="TIMESTAMP" />
	<result column="insuranceNumber" property="insuranceNumber" jdbcType="DATE" />
    <result column="lastTraceResult" property="lastTraceResult" jdbcType="DATE" />
    <result column="willingTraceDate" property="willingTraceDate" jdbcType="DATE" />
    <result column="isQuote" property="isQuote" jdbcType="VARCHAR" />
    <result column="quoteDate" property="quoteDate" jdbcType="INTEGER" />
    <result column="privilegeProLY" property="privilegeProLY" jdbcType="VARCHAR" />
 	<result column="firstAcceptDate" property="firstAcceptDate" jdbcType="DATE" />
 	<!-- 注意cusLostInsurStatu一定要放在 virtualJqxdqr之前，请别乱动-->
 	<result column="cusLostInsurStatu" property="cusLostInsurStatu" jdbcType="INTEGER"></result>
 	<result column="virtualJqxdqr" property="virtualJqxdqr" jdbcType="DATE"/>
 	<result column="customerDescription" property="customerDescription" jdbcType="VARCHAR"/>
 	<result column="lastYearIsDeal" property="lastYearIsDeal" jdbcType="INTEGER"></result>
 	<result column="holder" property="holder" jdbcType="VARCHAR"></result>
 	<result column="holderId" property="holderId" jdbcType="INTEGER"></result>
 	<result column="holderRoleId" property="holderRoleId" jdbcType="INTEGER"></result>
 	<result column="bhInsuranceEndDate" property="bhInsuranceEndDate" jdbcType="DATE"/>
 	<result column="ifUpdate" property="ifUpdate" jdbcType="INTEGER"/>
 	<result column="ifLoan" property="ifLoan" jdbcType="INTEGER"/>
 	<result column="factoryLicenseType" property="factoryLicenseType" jdbcType="VARCHAR"></result>
 	<result column="carAnnualCheckUpDate" property="carAnnualCheckUpDate" jdbcType="DATE"/>
 	<result column="insuredLY" property="insuredLY" jdbcType="VARCHAR"/>
 	<result column="buyfromThisStore" property="buyfromThisStore" jdbcType="INTEGER"/>
 	<result column="gotThroughNum" property="gotThroughNum" jdbcType="INTEGER"/>
 	<result column="contactWayReserve" property="contactWayReserve" jdbcType="VARCHAR"/>
 	<result column="bhUpdateTime" property="bhUpdateTime" jdbcType="TIMESTAMP"/>
 	<result column="createTime" property="createTime" jdbcType="TIMESTAMP" />
 	<result column="nicheng" property="nicheng" jdbcType="VARCHAR"/>
 	<result column="createrId" property="createrId" jdbcType="INTEGER"/>
 	<result column="defeatFlag" property="defeatFlag" jdbcType="INTEGER"/>
 	
	<collection property="coverType" ofType="com.bofide.bip.common.po.CoverType" column="coverType">
		<result column="coverType" property="coverType" jdbcType="INTEGER" />
 		<result column="coverTypeName" property="coverTypeName" jdbcType="VARCHAR"/>
	</collection>
   <collection property="customerAssigns" ofType="com.bofide.bip.po.CustomerAssign" column="customerId">
   	<result column="id" property="id" jdbcType="INTEGER" />
   <result column="customerId" property="customerId" jdbcType="INTEGER" />
    <result column="userId" property="userId" jdbcType="INTEGER" />
    <result column="traceStatu" property="traceStatu" jdbcType="INTEGER" />
    <result column="traceDate" property="traceDate" jdbcType="DATE" />
    <result column="inviteStatu" property="inviteStatu" jdbcType="INTEGER" />
 	<result column="inviteDate" property="inviteDate" jdbcType="DATE" />
    <result column="acceptStatu" property="acceptStatu" jdbcType="INTEGER" />
    <result column="acceptDate" property="acceptDate" jdbcType="DATE" />
    <result column="returnStatu" property="returnStatu" jdbcType="INTEGER" />
    <result column="returnDate" property="returnDate" jdbcType="DATE" />
 	<result column="customerTraceId" property="customerTraceId" jdbcType="INTEGER" />
 	<result column="assignDate" property="assignDate" jdbcType="DATE" />
 	<result column="delayDate" property="delayDate" jdbcType="DATE"/>
 	<result column="applyStatu" property="applyStatu" jdbcType="INTEGER" />
 	<result column="applyLossReason" property="applyLossReason" jdbcType="VARCHAR" />
   </collection>
   <collection property="insuranceBills" ofType="com.bofide.bip.po.InsuranceBill" column="chassisNumber">
   	<result column="insuranceBillId" property="insuranceBillId" jdbcType="INTEGER" />
    <result column="fourSStoreId" property="fourSStoreId" jdbcType="INTEGER" />
    <result column="foursStore" property="foursStore" jdbcType="VARCHAR" />
    <result column="carLicenseNumber" property="carLicenseNumber" jdbcType="VARCHAR" />
    <result column="chassisNumber" property="chassisNumber" jdbcType="VARCHAR" />
    <result column="engineNumber" property="engineNumber" jdbcType="VARCHAR" />
    <result column="registrationDate" property="registrationDate" jdbcType="DATE" />
    <result column="carBrand" property="carBrand" jdbcType="VARCHAR" />
    <result column="vehicleModel" property="vehicleModel" jdbcType="VARCHAR" />
    <result column="binsuranceNumber" property="binsuranceNumber" jdbcType="VARCHAR" />
    <result column="binsuranceCoverage" property="binsuranceCoverage" jdbcType="INTEGER" />
    <result column="vehicleTax" property="vehicleTax" jdbcType="INTEGER" />
    <result column="privilegePro" property="privilegePro" jdbcType="VARCHAR" />
    <result column="renewalWay" property="renewalWay" jdbcType="VARCHAR" />
    <result column="insurNumber" property="insurNumber" jdbcType="INTEGER" />
    <result column="cinsuranceNumber" property="cinsuranceNumber" jdbcType="VARCHAR" />
    <result column="cinsuranceCoverage" property="cinsuranceCoverage" jdbcType="INTEGER" />
    <result column="premiumCount" property="premiumCount" jdbcType="INTEGER" />
    <result column="privilegeSum" property="privilegeSum" jdbcType="INTEGER" />
    <result column="donateCostCount" property="donateCostCount" jdbcType="INTEGER" />
    <result column="factorageCount" property="factorageCount" jdbcType="INTEGER" />
    <result column="realPay" property="realPay" jdbcType="INTEGER" />
    <result column="payWay" property="payWay" jdbcType="VARCHAR" />
    <result column="sdfs" property="sdfs" jdbcType="VARCHAR" />
    <result column="profit" property="profit" jdbcType="INTEGER" />
    <result column="coverType" property="coverType" jdbcType="INTEGER" />
    <result column="insurDate" property="insurDate" jdbcType="DATE" />
    <result column="syxrqStart" property="syxrqStart" jdbcType="DATE" />
    <result column="syxrqEnd" property="syxrqEnd" jdbcType="DATE" />
    <result column="jqxrqStart" property="jqxrqStart" jdbcType="DATE" />
    <result column="jqxrqEnd" property="jqxrqEnd" jdbcType="DATE" />
    <result column="qnbe" property="qnbe" jdbcType="INTEGER"/>
    <result column="qnsyxje" property="qnsyxje" jdbcType="INTEGER"/>
    <result column="qnjqxje" property="qnjqxje" jdbcType="INTEGER"/>
    <result column="qnccsje" property="qnccsje" jdbcType="INTEGER"/>
    <result column="invoiceName" property="invoiceName" jdbcType="VARCHAR" />
    <result column="insuranceCompName" property="insuranceCompName" jdbcType="VARCHAR" />
    <result column="insuranceType" property="insuranceType" jdbcType="VARCHAR" />
    <result column="remark" property="remark" jdbcType="VARCHAR" />
    <result column="principalId" property="principalId" jdbcType="INTEGER" />
    <result column="principal" property="principal" jdbcType="VARCHAR" />
    <result column="clerkId" property="clerkId" jdbcType="INTEGER"/>
    <result column="clerk" property="clerk" jdbcType="VARCHAR"/>
    <result column="insuranceWriterId" property="insuranceWriterId" jdbcType="INTEGER" />
    <result column="insuranceWriter" property="insuranceWriter" jdbcType="VARCHAR" />
    <result column="cashier" property="cashier" jdbcType="VARCHAR" />
    <result column="solicitMemberId" property="solicitMemberId" jdbcType="INTEGER" />
    <result column="solicitMember" property="solicitMember" jdbcType="VARCHAR" />
    <result column="carOwner" property="carOwner" jdbcType="VARCHAR" />
    <result column="insured" property="insured" jdbcType="VARCHAR" />
    <result column="certificateNumber" property="certificateNumber" jdbcType="VARCHAR"/>
    <result column="contact" property="contact" jdbcType="VARCHAR" />
    <result column="contactWay" property="contactWay" jdbcType="VARCHAR" />
    <result column="customerSource" property="customerSource" jdbcType="VARCHAR"/>
    <result column="customerCharacter" property="customerCharacter" jdbcType="VARCHAR"/>
    <result column="address" property="address" jdbcType="VARCHAR" />
    <result column="cdrq" property="cdrq" jdbcType="DATE" />
   </collection>
   <collection property="customerTraceRecodes" ofType="com.bofide.bip.po.CustomerTraceRecode" column="principalId">
   		<result column="customerTraceId" property="customerTraceId" jdbcType="INTEGER" />
	    <result column="customerId" property="customerId" jdbcType="INTEGER" />
	    <result column="currentTraceDate" property="currentTraceDate" jdbcType="TIMESTAMP" />
	    <result column="nextTraceDate" property="nextTraceDate" jdbcType="DATE" />
	    <result column="renewalType" property="renewalType" jdbcType="VARCHAR" />
	    <result column="customerLevel" property="customerLevel" jdbcType="VARCHAR" />
	    <result column="inviteDate" property="inviteDate" jdbcType="DATE" />
	    <result column="traceContext" property="traceContext" jdbcType="VARCHAR" />
	    <result column="currentTraceDate" property="currentTraceDate" jdbcType="DATE" />
	    <result column="customerDescription" property="customerDescription" jdbcType="VARCHAR" />
	    <result column="quote" property="quote" jdbcType="VARCHAR" />
	    <result column="quotedPrice" property="quotedPrice" jdbcType="VARCHAR" />
	    <result column="principalId" property="principalId" jdbcType="INTEGER" />
	    <result column="principal" property="principal" jdbcType="VARCHAR" />
	    <result column="outBillDay" property="outBillDay" jdbcType="INTEGER" />
	    <result column="inviteNumber" property="inviteNumber" jdbcType="INTEGER" />
	    <result column="invite" property="invite" jdbcType="INTEGER" />
	    <result column="comeStore" property="comeStore" jdbcType="INTEGER" />
	    <result column="comeStoreDate" property="comeStoreDate" jdbcType="TIMESTAMP" />
	    <result column="sfjt" property="sfjt" jdbcType="INTEGER" />
	    <result column="lxr" property="lxr" jdbcType="VARCHAR" />
	    <result column="lxfs" property="lxfs" jdbcType="VARCHAR" />
	    <result column="cx" property="cx" jdbcType="VARCHAR" />
	    <result column="bxdqr" property="bxdqr" jdbcType="DATE" />
	    <result column="cyts" property="cyts" jdbcType="INTEGER" />
    </collection>
  </resultMap>
  <select id="findByCusLostInsurStatu" resultMap="BaseResultMap" parameterType="java.util.HashMap">
  	SELECT
		rc.*,ct.coverTypeName,ca.*,u.userName holder, u.id holderId, u.roleId holderRoleId
	FROM
		bf_bip_renewaling_customer rc
	LEFT JOIN bf_bip_cover_type ct ON ct.coverType = rc.renewalType
	LEFT JOIN bf_bip_customer_assign ca ON rc.customerId = ca.customerId
	JOIN bf_bip_user u ON ca.userId = u.id
	AND ifnull(traceStatu, 0) != 3
  	 <where>
  	 	<if test="users != null and users.size() > 0">
  			and ca.userId in
  			<foreach collection="users" item="user" open="(" separator="," close=")">
  				#{user.id}
  			</foreach> 
  		</if>
  		<if test="cusLostInsurStatu != null and cusLostInsurStatu != ''">
  			and rc.cusLostInsurStatu = #{cusLostInsurStatu,jdbcType=INTEGER}
  		</if> 
  		<if test="startTime != null and startTime != ''">
  			<![CDATA[and rc.insuranceEndDate >= #{startTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="endTime != null and endTime != ''">
  			<![CDATA[and rc.insuranceEndDate <= #{endTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="storeId != null and storeId != ''">
  			and rc.fourSStoreId = #{storeId}
  		</if>
  		<!-- 添加查询条件过滤 -->
  		<if test="renewalType != null and renewalType != ''">
  			and rc.renewalType = #{renewalType}
  		</if>
  		<if test="holder != null and holder != ''">
  			and u.userName = #{holder}
  		</if>
  		<if test="chassisNumber != null and chassisNumber != ''">
  			and rc.chassisNumber like '%${chassisNumber}%'
  		</if>
  		<if test="contact != null and contact != ''">
  			and rc.contact = #{contact}
  		</if>
  		<if test="contactWay != null and contactWay != ''">
  			and (rc.contactWay like '%${contactWay}%'
	 		        or rc.contactWayReserve like '%${contactWay}%'
	 		    )
  		</if>
  		<if test="carLicenseNumber != null and carLicenseNumber != ''">
  			and rc.carLicenseNumber like '%${carLicenseNumber}%'
  		</if>
  	 </where>
  	 <!-- ORDER BY rc.virtualJqxdqr ASC  -->
  	 <!-- short代表按某字段排序，shortmain 1：升序，2：降序 -->
  	    <if test="short==null and shortmain==null"> ORDER BY rc.virtualJqxdqr ASC</if>
  	    <if test="short==2 and shortmain==1"> ORDER BY rc.principal ASC</if>
  	    <if test="short==2 and shortmain==2"> ORDER BY rc.principal DESC</if>
  	    <if test="short==3 and shortmain==1"> ORDER BY rc.clerk ASC</if>
  	    <if test="short==3 and shortmain==2"> ORDER BY rc.clerk DESC</if>
  	    <if test="short==4 and shortmain==1"> ORDER BY rc.contact ASC</if>
  	    <if test="short==4 and shortmain==2"> ORDER BY rc.contact DESC</if>
  	    <if test="short==5 and shortmain==1"> ORDER BY rc.contactWay ASC</if>
  	    <if test="short==5 and shortmain==2"> ORDER BY rc.contactWay DESC</if>
  	    <if test="short==6 and shortmain==1"> ORDER BY rc.chassisNumber ASC</if>
  	    <if test="short==6 and shortmain==2"> ORDER BY rc.chassisNumber DESC</if>
  	    <if test="short==7 and shortmain==1"> ORDER BY rc.carLicenseNumber ASC</if>
  	    <if test="short==7 and shortmain==2"> ORDER BY rc.carLicenseNumber DESC</if>
  	    <if test="short==8 and shortmain==1"> ORDER BY ct.coverTypeName ASC</if>
  	    <if test="short==8 and shortmain==2"> ORDER BY ct.coverTypeName DESC</if>
  	    <if test="short==9 and shortmain==1"> ORDER BY DATE_FORMAT(rc.insuranceEndDate,'%m-%d') ASC</if>
  	    <if test="short==9 and shortmain==2"> ORDER BY DATE_FORMAT(rc.insuranceEndDate,'%m-%d') DESC</if>
  	    <if test="short==10 and shortmain==1"> ORDER BY rc.bhUpdateTime ASC</if>
  	    <if test="short==10 and shortmain==2"> ORDER BY rc.bhUpdateTime DESC</if>
  	    <if test="short==11 and shortmain==1"> ORDER BY rc.customerLevel ASC</if>
  	    <if test="short==11 and shortmain==2"> ORDER BY rc.customerLevel DESC</if>
  	    <if test="short==12 and shortmain==1"> ORDER BY rc.gotThroughNum ASC</if>
  	    <if test="short==12 and shortmain==2"> ORDER BY rc.gotThroughNum DESC</if>
  	    <if test="short==13 and shortmain==1"> ORDER BY rc.willingTraceDate ASC</if>
  	    <if test="short==13 and shortmain==2"> ORDER BY rc.willingTraceDate DESC</if>
  	    <if test="short==14 and shortmain==1"> ORDER BY rc.lastTraceDate ASC</if>
  	    <if test="short==14 and shortmain==2"> ORDER BY rc.lastTraceDate DESC</if>
  	    <if test="short==15 and shortmain==1"> ORDER BY rc.lastTraceResult ASC</if>
  	    <if test="short==15 and shortmain==2"> ORDER BY rc.lastTraceResult DESC</if>
  	    <if test="short==16 and shortmain==1"> ORDER BY ca.delayDate ASC</if>
  	    <if test="short==16 and shortmain==2"> ORDER BY ca.delayDate DESC</if>
  	    <if test="short==17 and shortmain==1"> ORDER BY rc.virtualJqxdqr ASC</if>
  	    <if test="short==17 and shortmain==2"> ORDER BY rc.virtualJqxdqr DESC</if>
  	    <if test="short==18 and shortmain==1"> ORDER BY ca.assignDate ASC</if>
  	    <if test="short==18 and shortmain==2"> ORDER BY ca.assignDate DESC</if>
  	    <if test="short==19 and shortmain==1"> ORDER BY holder ASC</if>
  	    <if test="short==19 and shortmain==2"> ORDER BY holder DESC</if>
  	 LIMIT #{start,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}
  </select>
  
  <!--续保主管、总经理、保险经理查询脱保统计  -->
  <select id="countFindByCusLostInsurStatu1"  resultType="java.lang.Integer" parameterType="java.util.HashMap">
  	SELECT
		count(1)
	FROM
		bf_bip_renewaling_customer rc
	LEFT JOIN bf_bip_cover_type ct ON ct.coverType = rc.renewalType 
	LEFT JOIN bf_bip_customer_assign ca ON rc.customerId = ca.customerId 
	JOIN bf_bip_user u ON ca.userId = u.id 
	and ifnull(traceStatu,0) != 3
  	 <where>
  	 	<!-- and ifnull(traceStatu,0) != 3 -->
  	 	<if test="users != null and users.size() > 0">
  			and ca.userId in
  			<foreach collection="users" item="user" open="(" separator="," close=")">
  				#{user.id}
  			</foreach> 
  		</if>
  		<if test="cusLostInsurStatu != null and cusLostInsurStatu != ''">
  			and rc.cusLostInsurStatu = #{cusLostInsurStatu,jdbcType=INTEGER}
  		</if> 
  		<if test="startTime != null and startTime != ''">
  			<![CDATA[and rc.insuranceEndDate >= #{startTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="endTime != null and endTime != ''">
  			<![CDATA[and rc.insuranceEndDate <= #{endTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="storeId != null and storeId != ''">
  			and rc.fourSStoreId = #{storeId}
  		</if>
  		<!-- 添加查询条件过滤 -->
  		<if test="renewalType != null and renewalType != ''">
  			and rc.renewalType = #{renewalType}
  		</if>
  		<if test="holder != null and holder != ''">
  			and u.userName = #{holder}
  		</if>
  		<if test="chassisNumber != null and chassisNumber != ''">
  			and rc.chassisNumber like '%${chassisNumber}%'
  		</if>
  		<if test="contact != null and contact != ''">
  			and rc.contact = #{contact}
  		</if>
  		<if test="contactWay != null and contactWay != ''">
  			and (rc.contactWay like '%${contactWay}%'
	 		        or rc.contactWayReserve like '%${contactWay}%'
	 		    )
  		</if>
  		<if test="carLicenseNumber != null and carLicenseNumber != ''">
  			and rc.carLicenseNumber like '%${carLicenseNumber}%'
  		</if>
  	 </where>
  </select>
  <!-- 按潜客的潜客脱保状态条件查询潜客跟踪记录 -->
  <select id="countFindByCusLostInsurStatuGzjl" resultType="java.lang.Integer" parameterType="java.util.HashMap">
  select  
   	count(1)
  from bf_bip_customer_trace_recode
    	where customerId in( 
  	SELECT
		rc.customerId
	FROM
		bf_bip_renewaling_customer rc
	LEFT JOIN bf_bip_cover_type ct ON ct.coverType = rc.renewalType 
	LEFT JOIN bf_bip_customer_assign ca ON rc.customerId = ca.customerId 
	JOIN bf_bip_user u ON ca.userId = u.id 
	and ifnull(traceStatu,0) != 3
  	 <where>
  	 	<!-- and ifnull(traceStatu,0) != 3 -->
  	 	<if test="users != null and users.size() > 0">
  			and ca.userId in
  			<foreach collection="users" item="user" open="(" separator="," close=")">
  				#{user.id}
  			</foreach> 
  		</if>
  		<if test="cusLostInsurStatu != null and cusLostInsurStatu != ''">
  			and rc.cusLostInsurStatu = #{cusLostInsurStatu,jdbcType=INTEGER}
  		</if> 
  		<if test="startTime != null and startTime != ''">
  			<![CDATA[and rc.insuranceEndDate >= #{startTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="endTime != null and endTime != ''">
  			<![CDATA[and rc.insuranceEndDate <= #{endTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="storeId != null and storeId != ''">
  			and rc.fourSStoreId = #{storeId}
  		</if>
  		<!-- 添加查询条件过滤 -->
  		<if test="renewalType != null and renewalType != ''">
  			and rc.renewalType = #{renewalType}
  		</if>
  		<if test="holder != null and holder != ''">
  			and u.userName = #{holder}
  		</if>
  		<if test="chassisNumber != null and chassisNumber != ''">
  			and rc.chassisNumber like '%${chassisNumber}%'
  		</if>
  		<if test="contact != null and contact != ''">
  			and rc.contact = #{contact}
  		</if>
  		<if test="contactWay != null and contactWay != ''">
  			and (rc.contactWay like '%${contactWay}%'
	 		        or rc.contactWayReserve like '%${contactWay}%'
	 		    )
  		</if>
  		<if test="carLicenseNumber != null and carLicenseNumber != ''">
  			and rc.carLicenseNumber like '%${carLicenseNumber}%'
  		</if>
  	 </where>
  	 )
  </select>
 <!--其他角色查询脱保统计  -->
  <select id="countFindByCusLostInsurStatu"  resultType="java.lang.Integer" parameterType="java.util.HashMap">
  	select 
  		count(*) 
  	from bf_bip_renewaling_customer rc
  	 <where>
  	 	rc.customerLevel != 'O'
  	 	and rc.customerLevel != 'F'
  	 	<if test="storeId != null and storeId != ''">
  			and rc.fourSStoreId = #{storeId,jdbcType=INTEGER}
  		</if> 
  		<if test="cusLostInsurStatu != null and cusLostInsurStatu != ''">
  			and rc.cusLostInsurStatu = #{cusLostInsurStatu,jdbcType=INTEGER}
  		</if> 
  		<if test="startTime != null and startTime != ''">
  			<![CDATA[and rc.insuranceEndDate >= #{startTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="endTime != null and endTime != ''">
  			<![CDATA[and rc.insuranceEndDate <= #{endTime,jdbcType=DATE}]]>
  		</if>
  		<if test="storeId != null and storeId != ''">
  			and rc.fourSStoreId = #{storeId}
  		</if> 
  		
  	 </where>
  </select>
  
  <select id="findByCusLostInsurStatu2" resultMap="BaseResultMap" parameterType="java.util.HashMap">
  	  SELECT
		rc.*,ct.coverTypeName,ca.*,u.userName holder, u.id holderId, u.roleId holderRoleId
	FROM
		bf_bip_renewaling_customer rc
	LEFT JOIN bf_bip_cover_type ct ON ct.coverType = rc.renewalType,
 	bf_bip_customer_assign ca JOIN bf_bip_user u ON (ca.userId = u.id) 	 
  	 <where>
  	 	rc.customerId = ca.customerId
  	 	and ifnull(traceStatu,0) != 3
  	 	and ifnull(acceptStatu,0) != 1
  	 	<if test="users != null and users.size() > 0">
  			and ca.userId in
  			<foreach collection="users" item="user" open="(" separator="," close=")">
  				#{user.id}
  			</foreach> 
  		</if>
  		<if test="cusLostInsurStatu != null and cusLostInsurStatu != ''">
  			and rc.cusLostInsurStatu = #{cusLostInsurStatu,jdbcType=INTEGER}
  		</if> 
  		<if test="startTime != null and startTime != ''">
  			<![CDATA[and rc.insuranceEndDate >= #{startTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="endTime != null and endTime != ''">
  			<![CDATA[and rc.insuranceEndDate <= #{endTime,jdbcType=DATE}]]>
  		</if>
  		<if test="storeId != null and storeId != ''">
  			and rc.fourSStoreId = #{storeId}
  		</if> 
  		<!-- 添加查询条件过滤 -->
  		<if test="renewalType != null and renewalType != ''">
  			and rc.renewalType = #{renewalType}
  		</if>
  		<if test="holder != null and holder != ''">
  			and u.userName = #{holder}
  		</if>
  		<if test="chassisNumber != null and chassisNumber != ''">
  			and rc.chassisNumber like '%${chassisNumber}%'
  		</if>
  		<if test="contact != null and contact != ''">
  			and rc.contact = #{contact}
  		</if>
  		<if test="contactWay != null and contactWay != ''">
  			and (rc.contactWay like '%${contactWay}%'
	 		        or rc.contactWayReserve like '%${contactWay}%'
	 		    )
  		</if>
  		<if test="carLicenseNumber != null and carLicenseNumber != ''">
  			and rc.carLicenseNumber like '%${carLicenseNumber}%'
  		</if>
  	 </where>
  	 <!-- ORDER BY rc.id  -->
  	 <!-- short代表按某字段排序，shortmain 1：升序，2：降序 -->
  	    <if test="short==null and shortmain==null"> ORDER BY rc.id ASC</if>
  	    <if test="short==2 and shortmain==1"> ORDER BY rc.principal ASC</if>
  	    <if test="short==2 and shortmain==2"> ORDER BY rc.principal DESC</if>
  	    <if test="short==3 and shortmain==1"> ORDER BY rc.clerk ASC</if>
  	    <if test="short==3 and shortmain==2"> ORDER BY rc.clerk DESC</if>
  	    <if test="short==4 and shortmain==1"> ORDER BY rc.contact ASC</if>
  	    <if test="short==4 and shortmain==2"> ORDER BY rc.contact DESC</if>
  	    <if test="short==5 and shortmain==1"> ORDER BY rc.contactWay ASC</if>
  	    <if test="short==5 and shortmain==2"> ORDER BY rc.contactWay DESC</if>
  	    <if test="short==6 and shortmain==1"> ORDER BY rc.chassisNumber ASC</if>
  	    <if test="short==6 and shortmain==2"> ORDER BY rc.chassisNumber DESC</if>
  	    <if test="short==7 and shortmain==1"> ORDER BY rc.carLicenseNumber ASC</if>
  	    <if test="short==7 and shortmain==2"> ORDER BY rc.carLicenseNumber DESC</if>
  	    <if test="short==8 and shortmain==1"> ORDER BY ct.coverTypeName ASC</if>
  	    <if test="short==8 and shortmain==2"> ORDER BY ct.coverTypeName DESC</if>
  	    <if test="short==9 and shortmain==1"> ORDER BY DATE_FORMAT(rc.insuranceEndDate,'%m-%d') ASC</if>
  	    <if test="short==9 and shortmain==2"> ORDER BY DATE_FORMAT(rc.insuranceEndDate,'%m-%d') DESC</if>
  	    <if test="short==10 and shortmain==1"> ORDER BY rc.bhUpdateTime ASC</if>
  	    <if test="short==10 and shortmain==2"> ORDER BY rc.bhUpdateTime DESC</if>
  	    <if test="short==11 and shortmain==1"> ORDER BY rc.customerLevel ASC</if>
  	    <if test="short==11 and shortmain==2"> ORDER BY rc.customerLevel DESC</if>
  	    <if test="short==12 and shortmain==1"> ORDER BY rc.gotThroughNum ASC</if>
  	    <if test="short==12 and shortmain==2"> ORDER BY rc.gotThroughNum DESC</if>
  	    <if test="short==13 and shortmain==1"> ORDER BY rc.willingTraceDate ASC</if>
  	    <if test="short==13 and shortmain==2"> ORDER BY rc.willingTraceDate DESC</if>
  	    <if test="short==14 and shortmain==1"> ORDER BY rc.lastTraceDate ASC</if>
  	    <if test="short==14 and shortmain==2"> ORDER BY rc.lastTraceDate DESC</if>
  	    <if test="short==15 and shortmain==1"> ORDER BY rc.lastTraceResult ASC</if>
  	    <if test="short==15 and shortmain==2"> ORDER BY rc.lastTraceResult DESC</if>
  	    <if test="short==16 and shortmain==1"> ORDER BY ca.delayDate ASC</if>
  	    <if test="short==16 and shortmain==2"> ORDER BY ca.delayDate DESC</if>
  	    <if test="short==17 and shortmain==1"> ORDER BY rc.virtualJqxdqr ASC</if>
  	    <if test="short==17 and shortmain==2"> ORDER BY rc.virtualJqxdqr DESC</if>
  	    <if test="short==18 and shortmain==1"> ORDER BY ca.assignDate ASC</if>
  	    <if test="short==18 and shortmain==2"> ORDER BY ca.assignDate DESC</if>
  	 LIMIT #{start,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}
  </select>
<!-- 统计上个查询的总数 -->
  <select id="countFindByCusLostInsurStatu2"  resultType="java.lang.Integer" parameterType="java.util.HashMap">
  	 select 
		count(*) 
  	 from bf_bip_renewaling_customer rc, bf_bip_customer_assign ca
  	 JOIN bf_bip_user u ON (ca.userId = u.id) 
  	 <where>
  	 	rc.customerId = ca.customerId
  	 	and ifnull(traceStatu,0) != 3
  	 	and ifnull(acceptStatu,0) != 1
  	 	<if test="users != null and users.size() > 0">
  			and ca.userId in
  			<foreach collection="users" item="user" open="(" separator="," close=")">
  				#{user.id}
  			</foreach> 
  		</if>
  		<if test="cusLostInsurStatu != null and cusLostInsurStatu != ''">
  			and rc.cusLostInsurStatu = #{cusLostInsurStatu,jdbcType=INTEGER}
  		</if> 
  		<if test="startTime != null and startTime != ''">
  			<![CDATA[and rc.insuranceEndDate >= #{startTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="endTime != null and endTime != ''">
  			<![CDATA[and rc.insuranceEndDate <= #{endTime,jdbcType=DATE}]]>
  		</if>
  		<if test="storeId != null and storeId != ''">
  			and rc.fourSStoreId = #{storeId}
  		</if>  
  		<!-- 添加查询条件过滤 -->
  		<if test="renewalType != null and renewalType != ''">
  			and rc.renewalType = #{renewalType}
  		</if>
  		<if test="holder != null and holder != ''">
  			and u.userName = #{holder}
  		</if>
  		<if test="chassisNumber != null and chassisNumber != ''">
  			and rc.chassisNumber like '%${chassisNumber}%'
  		</if>
  		<if test="contact != null and contact != ''">
  			and rc.contact = #{contact}
  		</if>
  		<if test="contactWay != null and contactWay != ''">
  			and (rc.contactWay like '%${contactWay}%'
	 		        or rc.contactWayReserve like '%${contactWay}%'
	 		    )
  		</if>
  		<if test="carLicenseNumber != null and carLicenseNumber != ''">
  			and rc.carLicenseNumber like '%${carLicenseNumber}%'
  		</if>
  	 </where>
  </select>
  <select id="findByTraceStatu" resultMap="BaseResultMap" parameterType="java.util.HashMap">
  	 SELECT
		rc.*,ct.coverTypeName,ca.*,u.userName holder,u.id holderId,u.roleId holderRoleId
	FROM
		bf_bip_renewaling_customer rc
	LEFT JOIN bf_bip_cover_type ct ON ct.coverType = rc.renewalType,
 	bf_bip_customer_assign ca JOIN bf_bip_user u ON (ca.userId = u.id) 	 
  	 <where>
  	 	rc.customerId = ca.customerId
  	 	and (ifnull(rc.cusLostInsurStatu,0) != 2
		or (ca.delayDate is not null
		and ca.delayDate >= CURDATE()))
  	 	<if test="users != null and users.size() > 0">
  			and ca.userId in
  			<foreach collection="users" item="user" open="(" separator="," close=")">
  				#{user.id}
  			</foreach> 
  		</if>
  		<if test="traceStatu != null and traceStatu != ''">
  			and (ca.traceStatu = #{traceStatu,jdbcType=INTEGER} or ca.traceStatu = 4)
  		</if> 
  		<if test="customerLevels != null and customerLevels.length > 0">
  			and rc.customerLevel not in  
  			<foreach collection="customerLevels" item="customerLevel" open="(" separator="," close=")">
  				#{customerLevel}
  			</foreach>
  		</if>
  		<if test="startTime != null and startTime != ''">
  			<![CDATA[and ca.traceDate >= #{startTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="endTime != null and endTime != ''">
  			<![CDATA[and ca.traceDate <= #{endTime,jdbcType=DATE}]]>
  		</if>
  		<if test="storeId != null and storeId != ''">
  			and rc.fourSStoreId = #{storeId}
  		</if>
  		<!-- 添加查询条件过滤 -->
  		<if test="renewalType != null and renewalType != ''">
  			and rc.renewalType = #{renewalType}
  		</if>
  		<if test="holder != null and holder != ''">
  			and u.userName = #{holder}
  		</if>
  		<if test="chassisNumber != null and chassisNumber != ''">
  			and rc.chassisNumber like '%${chassisNumber}%'
  		</if>
  		<if test="contact != null and contact != ''">
  			and rc.contact = #{contact}
  		</if>
  		<if test="contactWay != null and contactWay != ''">
  			and (rc.contactWay like '%${contactWay}%'
	 		        or rc.contactWayReserve like '%${contactWay}%'
	 		    )
  		</if>
  		<if test="carLicenseNumber != null and carLicenseNumber != ''">
  			and rc.carLicenseNumber like '%${carLicenseNumber}%'
  		</if>
  		<if test="ifLoan != null">
  			and rc.ifLoan = #{ifLoan}
  		</if>
  		<if test="sfgyx != null and sfgyx == 1">
  			and rc.sfgyx = #{sfgyx}
  		</if>
  	 </where>
  	 <if test="qnbfSort != null and qnbfSort == 1">
  			ORDER BY rc.insuranceCoverageLY DESC
  	 </if>
  	<!--  <if test="qnbfSort == null or qnbfSort == 0 ">
  			ORDER BY rc.virtualJqxdqr,rc.customerId
  	 </if> -->
  	 <!-- short代表按某字段排序，shortmain 1：升序，2：降序 -->
  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==null and shortmain==null"> ORDER BY rc.virtualJqxdqr,rc.customerId</if>
  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==2 and shortmain==1"> ORDER BY rc.principal ASC</if>
  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==2 and shortmain==2"> ORDER BY rc.principal DESC</if>
  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==3 and shortmain==1"> ORDER BY rc.clerk ASC</if>
  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==3 and shortmain==2"> ORDER BY rc.clerk DESC</if>
  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==4 and shortmain==1"> ORDER BY rc.contact ASC</if>
  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==4 and shortmain==2"> ORDER BY rc.contact DESC</if>
  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==5 and shortmain==1"> ORDER BY rc.contactWay ASC</if>
  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==5 and shortmain==2"> ORDER BY rc.contactWay DESC</if>
  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==6 and shortmain==1"> ORDER BY rc.chassisNumber ASC</if>
  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==6 and shortmain==2"> ORDER BY rc.chassisNumber DESC</if>
  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==7 and shortmain==1"> ORDER BY rc.carLicenseNumber ASC</if>
  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==7 and shortmain==2"> ORDER BY rc.carLicenseNumber DESC</if>
  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==8 and shortmain==1"> ORDER BY ct.coverTypeName ASC</if>
  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==8 and shortmain==2"> ORDER BY ct.coverTypeName DESC</if>
  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==9 and shortmain==1"> ORDER BY DATE_FORMAT(rc.insuranceEndDate,'%m-%d') ASC</if>
  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==9 and shortmain==2"> ORDER BY DATE_FORMAT(rc.insuranceEndDate,'%m-%d') DESC</if>
  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==10 and shortmain==1"> ORDER BY rc.bhUpdateTime ASC</if>
  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==10 and shortmain==2"> ORDER BY rc.bhUpdateTime DESC</if>
  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==11 and shortmain==1"> ORDER BY rc.customerLevel ASC</if>
  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==11 and shortmain==2"> ORDER BY rc.customerLevel DESC</if> 
  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==12 and shortmain==1"> ORDER BY rc.gotThroughNum ASC</if>
  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==12 and shortmain==2"> ORDER BY rc.gotThroughNum DESC</if>
  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==13 and shortmain==1"> ORDER BY rc.willingTraceDate ASC</if>
  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==13 and shortmain==2"> ORDER BY rc.willingTraceDate DESC</if>
  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==14 and shortmain==1"> ORDER BY rc.lastTraceDate ASC</if>
  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==14 and shortmain==2"> ORDER BY rc.lastTraceDate DESC</if>
  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==15 and shortmain==1"> ORDER BY rc.lastTraceResult ASC</if>
  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==15 and shortmain==2"> ORDER BY rc.lastTraceResult DESC</if>
  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==16 and shortmain==1"> ORDER BY ca.delayDate ASC</if>
  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==16 and shortmain==2"> ORDER BY ca.delayDate DESC</if>
  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==17 and shortmain==1"> ORDER BY rc.virtualJqxdqr ASC</if>
  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==17 and shortmain==2"> ORDER BY rc.virtualJqxdqr DESC</if>
  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==18 and shortmain==1"> ORDER BY ca.assignDate ASC</if>
  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==18 and shortmain==2"> ORDER BY ca.assignDate DESC</if>
  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==19 and shortmain==1"> ORDER BY holder ASC</if>
  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==19 and shortmain==2"> ORDER BY holder DESC</if>
  	    <if test="qnbfSort != null and qnbfSort == 1 and short==null and shortmain==null"> , rc.virtualJqxdqr,rc.customerId</if>
  	    <if test="qnbfSort != null and qnbfSort == 1 and short==2 and shortmain==1"> , rc.principal ASC</if>
  	    <if test="qnbfSort != null and qnbfSort == 1 and short==2 and shortmain==2"> , rc.principal DESC</if>
  	    <if test="qnbfSort != null and qnbfSort == 1 and short==3 and shortmain==1"> , rc.clerk ASC</if>
  	    <if test="qnbfSort != null and qnbfSort == 1 and short==3 and shortmain==2"> , rc.clerk DESC</if>
  	    <if test="qnbfSort != null and qnbfSort == 1 and short==4 and shortmain==1"> , rc.contact ASC</if>
  	    <if test="qnbfSort != null and qnbfSort == 1 and short==4 and shortmain==2"> , rc.contact DESC</if>
  	    <if test="qnbfSort != null and qnbfSort == 1 and short==5 and shortmain==1"> , rc.contactWay ASC</if>
  	    <if test="qnbfSort != null and qnbfSort == 1 and short==5 and shortmain==2"> , rc.contactWay DESC</if>
  	    <if test="qnbfSort != null and qnbfSort == 1 and short==6 and shortmain==1"> , rc.chassisNumber ASC</if>
  	    <if test="qnbfSort != null and qnbfSort == 1 and short==6 and shortmain==2"> , rc.chassisNumber DESC</if>
  	    <if test="qnbfSort != null and qnbfSort == 1 and short==7 and shortmain==1"> , rc.carLicenseNumber ASC</if>
  	    <if test="qnbfSort != null and qnbfSort == 1 and short==7 and shortmain==2"> , rc.carLicenseNumber DESC</if>
  	    <if test="qnbfSort != null and qnbfSort == 1 and short==8 and shortmain==1"> , ct.coverTypeName ASC</if>
  	    <if test="qnbfSort != null and qnbfSort == 1 and short==8 and shortmain==2"> , ct.coverTypeName DESC</if>
  	    <if test="qnbfSort != null and qnbfSort == 1 and short==9 and shortmain==1"> , DATE_FORMAT(rc.insuranceEndDate,'%m-%d') ASC</if>
  	    <if test="qnbfSort != null and qnbfSort == 1 and short==9 and shortmain==2"> , DATE_FORMAT(rc.insuranceEndDate,'%m-%d') DESC</if>
  	    <if test="qnbfSort != null and qnbfSort == 1 and short==10 and shortmain==1"> , rc.bhUpdateTime ASC</if>
  	    <if test="qnbfSort != null and qnbfSort == 1 and short==10 and shortmain==2"> , rc.bhUpdateTime DESC</if>
  	    <if test="qnbfSort != null and qnbfSort == 1 and short==11 and shortmain==1"> , rc.customerLevel ASC</if>
  	    <if test="qnbfSort != null and qnbfSort == 1 and short==11 and shortmain==2"> , rc.customerLevel DESC</if>
  	    <if test="qnbfSort != null and qnbfSort == 1 and short==12 and shortmain==1"> , rc.gotThroughNum ASC</if>
  	    <if test="qnbfSort != null and qnbfSort == 1 and short==12 and shortmain==2"> , rc.gotThroughNum DESC</if>
  	    <if test="qnbfSort != null and qnbfSort == 1 and short==13 and shortmain==1"> , rc.willingTraceDate ASC</if>
  	    <if test="qnbfSort != null and qnbfSort == 1 and short==13 and shortmain==2"> , rc.willingTraceDate DESC</if>
  	    <if test="qnbfSort != null and qnbfSort == 1 and short==14 and shortmain==1"> , rc.lastTraceDate ASC</if>
  	    <if test="qnbfSort != null and qnbfSort == 1 and short==14 and shortmain==2"> , rc.lastTraceDate DESC</if>
  	    <if test="qnbfSort != null and qnbfSort == 1 and short==15 and shortmain==1"> , rc.lastTraceResult ASC</if>
  	    <if test="qnbfSort != null and qnbfSort == 1 and short==15 and shortmain==2"> , rc.lastTraceResult DESC</if>
  	    <if test="qnbfSort != null and qnbfSort == 1 and short==16 and shortmain==1"> , ca.delayDate ASC</if>
  	    <if test="qnbfSort != null and qnbfSort == 1 and short==16 and shortmain==2"> , ca.delayDate DESC</if>
  	    <if test="qnbfSort != null and qnbfSort == 1 and short==17 and shortmain==1"> , rc.virtualJqxdqr ASC</if>
  	    <if test="qnbfSort != null and qnbfSort == 1 and short==17 and shortmain==2"> , rc.virtualJqxdqr DESC</if>
  	    <if test="qnbfSort != null and qnbfSort == 1 and short==18 and shortmain==1"> , ca.assignDate ASC</if>
  	    <if test="qnbfSort != null and qnbfSort == 1 and short==18 and shortmain==2"> , ca.assignDate DESC</if>
  	    <if test="qnbfSort != null and qnbfSort == 1 and short==19 and shortmain==1"> , holder ASC</if>
  	    <if test="qnbfSort != null and qnbfSort == 1 and short==19 and shortmain==2"> , holder DESC</if>
  	 LIMIT #{start,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}
  </select>
  <!-- 统计上个查询的总数 -->
   <select id="countFindByTraceStatu"  resultType="java.lang.Integer" parameterType="java.util.HashMap">
  	 select
  	  count(*) 
  	 from bf_bip_renewaling_customer rc, bf_bip_customer_assign ca 
	 JOIN bf_bip_user u ON (ca.userId = u.id) 
  	 <where>
  	 	rc.customerId = ca.customerId
  	 	and (ifnull(rc.cusLostInsurStatu,0) != 2
		or (ca.delayDate is not null
		and ca.delayDate >= CURDATE()))
  	 	<if test="users != null and users.size() > 0">
  			and ca.userId in
  			<foreach collection="users" item="user" open="(" separator="," close=")">
  				#{user.id}
  			</foreach> 
  		</if>
  		<if test="traceStatu != null and traceStatu != ''">
  			and (ca.traceStatu = #{traceStatu,jdbcType=INTEGER} or ca.traceStatu = 4)
  		</if> 
  		<if test="customerLevels != null and customerLevels.length > 0">
  			and rc.customerLevel not in  
  			<foreach collection="customerLevels" item="customerLevel" open="(" separator="," close=")">
  				#{customerLevel}
  			</foreach>
  		</if>
  		<if test="startTime != null and startTime != ''">
  			<![CDATA[and ca.traceDate >= #{startTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="endTime != null and endTime != ''">
  			<![CDATA[and ca.traceDate <= #{endTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="storeId != null and storeId != ''">
  			and rc.fourSStoreId = #{storeId,jdbcType=INTEGER}
  		</if>
  		<!-- 添加查询条件过滤 -->
  		<if test="renewalType != null and renewalType != ''">
  			and rc.renewalType = #{renewalType}
  		</if>
  		<if test="holder != null and holder != ''">
  			and u.userName = #{holder}
  		</if>
  		<if test="chassisNumber != null and chassisNumber != ''">
  			and rc.chassisNumber like '%${chassisNumber}%'
  		</if>
  		<if test="contact != null and contact != ''">
  			and rc.contact = #{contact}
  		</if>
  		<if test="contactWay != null and contactWay != ''">
  			and (rc.contactWay like '%${contactWay}%'
	 		        or rc.contactWayReserve like '%${contactWay}%'
	 		    )
  		</if>
  		<if test="carLicenseNumber != null and carLicenseNumber != ''">
  			and rc.carLicenseNumber like '%${carLicenseNumber}%'
  		</if>
  		<if test="ifLoan != null">
  			and rc.ifLoan = #{ifLoan}
  		</if>
  		<if test="sfgyx != null and sfgyx == 1">
  			and rc.sfgyx = #{sfgyx}
  		</if>
  	 </where>
  </select>
  <!-- 统计"按跟踪状态条件查询潜客跟踪记录"总数(应跟踪，已跟踪)-->
   <select id="countFindByTraceStatuGzjl"  resultType="java.lang.Integer" parameterType="java.util.HashMap">
  	 select  
   	count(1)
  	from bf_bip_customer_trace_recode
    	where customerId in(
  	 select
  	  rc.customerId
  	 from bf_bip_renewaling_customer rc, bf_bip_customer_assign ca 
	 JOIN bf_bip_user u ON (ca.userId = u.id) 
  	 <where>
  	 	rc.customerId = ca.customerId
  	 	and (ifnull(rc.cusLostInsurStatu,0) != 2
		or (ca.delayDate is not null
		and ca.delayDate >= CURDATE()))
  	 	<if test="users != null and users.size() > 0">
  			and ca.userId in
  			<foreach collection="users" item="user" open="(" separator="," close=")">
  				#{user.id}
  			</foreach> 
  		</if>
  		<if test="traceStatu != null and traceStatu != ''">
  			and (ca.traceStatu = #{traceStatu,jdbcType=INTEGER} or ca.traceStatu = 4)
  		</if> 
  		<if test="startTime != null and startTime != ''">
  			<![CDATA[and ca.traceDate >= #{startTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="endTime != null and endTime != ''">
  			<![CDATA[and ca.traceDate <= #{endTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="storeId != null and storeId != ''">
  			and rc.fourSStoreId = #{storeId,jdbcType=INTEGER}
  		</if>
  		<!-- 添加查询条件过滤 -->
  		<if test="renewalType != null and renewalType != ''">
  			and rc.renewalType = #{renewalType}
  		</if>
  		<if test="holder != null and holder != ''">
  			and u.userName = #{holder}
  		</if>
  		<if test="chassisNumber != null and chassisNumber != ''">
  			and rc.chassisNumber like '%${chassisNumber}%'
  		</if>
  		<if test="contact != null and contact != ''">
  			and rc.contact = #{contact}
  		</if>
  		<if test="contactWay != null and contactWay != ''">
  			and (rc.contactWay like '%${contactWay}%'
	 		        or rc.contactWayReserve like '%${contactWay}%'
	 		    )
  		</if>
  		<if test="carLicenseNumber != null and carLicenseNumber != ''">
  			and rc.carLicenseNumber like '%${carLicenseNumber}%'
  		</if>
  	 </where>)
  </select>
  <select id="findByAcceptStatu" resultMap="BaseResultMap" parameterType="java.util.HashMap">
  	SELECT
		rc.*,ct.coverTypeName,ca.*,u.userName holder,u.id holderId,u.roleId holderRoleId
	FROM
		bf_bip_renewaling_customer rc
	LEFT JOIN bf_bip_cover_type ct ON ct.coverType = rc.renewalType,
 	bf_bip_customer_assign ca JOIN bf_bip_user u ON (ca.userId = u.id)
  	 <where>
  	 	rc.customerId = ca.customerId
  	 	and ifnull(ca.traceStatu,0) != 3 
  	 	<if test="users != null and users.size() > 0">
  			and ca.userId in
  			<foreach collection="users" item="user" open="(" separator="," close=")">
  				#{user.id}
  			</foreach> 
  		</if>
  		<if test="acceptStatu != null and acceptStatu != ''">
  			and ca.acceptStatu = #{acceptStatu,jdbcType=INTEGER}
  		</if>
  		<if test="storeId != null and storeId != ''">
  			and rc.fourSStoreId = #{storeId}
  		</if> 
  		<!-- 添加查询条件过滤-->
  		<if test="renewalType != null and renewalType != ''">
  			and rc.renewalType = #{renewalType}
  		</if>
  		<if test="holder != null and holder != ''">
  			and u.userName = #{holder}
  		</if>
  		<if test="chassisNumber != null and chassisNumber != ''">
  			and rc.chassisNumber like '%${chassisNumber}%'
  		</if>
  		<if test="contact != null and contact != ''">
  			and rc.contact = #{contact}
  		</if>
  		<if test="contactWay != null and contactWay != ''">
  			and (rc.contactWay like '%${contactWay}%'
	 		        or rc.contactWayReserve like '%${contactWay}%'
	 		    )
  		</if>
  		<if test="carLicenseNumber != null and carLicenseNumber != ''">
  			and rc.carLicenseNumber like '%${carLicenseNumber}%'
  		</if>
  	 </where>
  	 <!-- ORDER BY rc.id  -->
  	 <!-- short代表按某字段排序，shortmain 1：升序，2：降序 -->
  	            <if test="short==null and shortmain==null"> ORDER BY  rc.id</if>
  	            <if test="short==2 and shortmain==1"> ORDER BY  rc.principal ASC</if>
		  	    <if test="short==2 and shortmain==2"> ORDER BY  rc.principal DESC</if>
		  	    <if test="short==3 and shortmain==1"> ORDER BY  rc.clerk ASC</if>
		  	    <if test="short==3 and shortmain==2"> ORDER BY  rc.clerk DESC</if>
		  	    <if test="short==4 and shortmain==1"> ORDER BY  rc.contact ASC</if>
		  	    <if test="short==4 and shortmain==2"> ORDER BY  rc.contact DESC</if>
		  	    <if test="short==5 and shortmain==1"> ORDER BY  rc.contactWay ASC</if>
		  	    <if test="short==5 and shortmain==2"> ORDER BY  rc.contactWay DESC</if>
		  	    <if test="short==6 and shortmain==1"> ORDER BY  rc.chassisNumber ASC</if>
		  	    <if test="short==6 and shortmain==2"> ORDER BY  rc.chassisNumber DESC</if>
		  	    <if test="short==7 and shortmain==1"> ORDER BY  rc.carLicenseNumber ASC</if>
		  	    <if test="short==7 and shortmain==2"> ORDER BY  rc.carLicenseNumber DESC</if>
		  	    <if test="short==8 and shortmain==1"> ORDER BY  ct.coverTypeName ASC</if>
		  	    <if test="short==8 and shortmain==2"> ORDER BY  ct.coverTypeName DESC</if>
		  	    <if test="short==9 and shortmain==1"> ORDER BY  DATE_FORMAT(rc.insuranceEndDate,'%m-%d') ASC</if>
		  	    <if test="short==9 and shortmain==2"> ORDER BY  DATE_FORMAT(rc.insuranceEndDate,'%m-%d') DESC</if>
		  	    <if test="short==10 and shortmain==1"> ORDER BY  rc.bhUpdateTime ASC</if>
		  	    <if test="short==10 and shortmain==2"> ORDER BY  rc.bhUpdateTime DESC</if>
		  	    <if test="short==11 and shortmain==1"> ORDER BY rc.customerLevel ASC</if>
  	            <if test="short==11 and shortmain==2"> ORDER BY rc.customerLevel DESC</if>
		  	    <if test="short==12 and shortmain==1"> ORDER BY  rc.gotThroughNum ASC</if>
		  	    <if test="short==12 and shortmain==2"> ORDER BY  rc.gotThroughNum DESC</if>
		  	    <if test="short==13 and shortmain==1"> ORDER BY  rc.willingTraceDate ASC</if>
		  	    <if test="short==13 and shortmain==2"> ORDER BY  rc.willingTraceDate DESC</if>
		  	    <if test="short==14 and shortmain==1"> ORDER BY  rc.lastTraceDate ASC</if>
		  	    <if test="short==14 and shortmain==2"> ORDER BY  rc.lastTraceDate DESC</if>
		  	    <if test="short==15 and shortmain==1"> ORDER BY  rc.lastTraceResult ASC</if>
		  	    <if test="short==15 and shortmain==2"> ORDER BY  rc.lastTraceResult DESC</if>
		  	    <if test="short==16 and shortmain==1"> ORDER BY  ca.delayDate ASC</if>
		  	    <if test="short==16 and shortmain==2"> ORDER BY  ca.delayDate DESC</if>
		  	    <if test="short==17 and shortmain==1"> ORDER BY  rc.virtualJqxdqr ASC</if>
		  	    <if test="short==17 and shortmain==2"> ORDER BY  rc.virtualJqxdqr DESC</if>
		  	    <if test="short==18 and shortmain==1"> ORDER BY  ca.assignDate ASC</if>
		  	    <if test="short==18 and shortmain==2"> ORDER BY  ca.assignDate DESC</if>
		  	    <if test="short==19 and shortmain==1"> ORDER BY  holder ASC</if>
		  	    <if test="short==19 and shortmain==2"> ORDER BY  holder DESC</if>
  	 LIMIT #{start,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}
  </select>
   <!-- 统计上个查询的总数 -->
   <select id="countFindByAcceptStatu" resultType="java.lang.Integer" parameterType="java.util.HashMap">
  	 select 
		count(*) 
	 from bf_bip_renewaling_customer rc
  	 left join bf_bip_cover_type ct on ct.coverType = rc.renewalType, bf_bip_customer_assign ca 
  	 JOIN bf_bip_user u ON (ca.userId = u.id)
  	 <where>
  	 	rc.customerId = ca.customerId
  	 	and ifnull(ca.traceStatu,0) != 3 
  	 	<if test="users != null and users.size() > 0">
  			and ca.userId in
  			<foreach collection="users" item="user" open="(" separator="," close=")">
  				#{user.id}
  			</foreach> 
  		</if>
  		<if test="acceptStatu != null and acceptStatu != ''">
  			and ca.acceptStatu = #{acceptStatu,jdbcType=INTEGER}
  		</if> 
  		<if test="storeId != null and storeId != ''">
  			and rc.fourSStoreId = #{storeId}
  		</if>
  		<!-- 添加查询条件过滤 -->
  		<if test="renewalType != null and renewalType != ''">
  			and rc.renewalType = #{renewalType}
  		</if>
  		<if test="holder != null and holder != ''">
  			and u.userName = #{holder}
  		</if>
  		<if test="chassisNumber != null and chassisNumber != ''">
  			and rc.chassisNumber like '%${chassisNumber}%'
  		</if>
  		<if test="contact != null and contact != ''">
  			and rc.contact = #{contact}
  		</if>
  		<if test="contactWay != null and contactWay != ''">
  			and (rc.contactWay like '%${contactWay}%'
	 		        or rc.contactWayReserve like '%${contactWay}%'
	 		    )
  		</if>
  		<if test="carLicenseNumber != null and carLicenseNumber != ''">
  			and rc.carLicenseNumber like '%${carLicenseNumber}%'
  		</if>
  	 </where>
  </select>
  <!-- 统计"根据接受状态查询潜客信息跟踪记录"总数-->
   <select id="countFindByAcceptStatuGzjl" resultType="java.lang.Integer" parameterType="java.util.HashMap">
  	 select  
   	count(1)
  from bf_bip_customer_trace_recode
    	where customerId in(
  	 select 
		rc.customerId 
	 from bf_bip_renewaling_customer rc
  	 left join bf_bip_cover_type ct on ct.coverType = rc.renewalType, bf_bip_customer_assign ca 
  	 JOIN bf_bip_user u ON (ca.userId = u.id)
  	 <where>
  	 	rc.customerId = ca.customerId
  	 	and ifnull(ca.traceStatu,0) != 3 
  	 	<if test="users != null and users.size() > 0">
  			and ca.userId in
  			<foreach collection="users" item="user" open="(" separator="," close=")">
  				#{user.id}
  			</foreach> 
  		</if>
  		<if test="acceptStatu != null and acceptStatu != ''">
  			and ca.acceptStatu = #{acceptStatu,jdbcType=INTEGER}
  		</if> 
  		<if test="storeId != null and storeId != ''">
  			and rc.fourSStoreId = #{storeId}
  		</if>
  		<!-- 添加查询条件过滤 -->
  		<if test="renewalType != null and renewalType != ''">
  			and rc.renewalType = #{renewalType}
  		</if>
  		<if test="holder != null and holder != ''">
  			and u.userName = #{holder}
  		</if>
  		<if test="chassisNumber != null and chassisNumber != ''">
  			and rc.chassisNumber like '%${chassisNumber}%'
  		</if>
  		<if test="contact != null and contact != ''">
  			and rc.contact = #{contact}
  		</if>
  		<if test="contactWay != null and contactWay != ''">
  			and (rc.contactWay like '%${contactWay}%'
	 		        or rc.contactWayReserve like '%${contactWay}%'
	 		    )
  		</if>
  		<if test="carLicenseNumber != null and carLicenseNumber != ''">
  			and rc.carLicenseNumber like '%${carLicenseNumber}%'
  		</if>
  	 </where>)
  </select>
   <select id="findByInviteStatuRC" resultMap="BaseResultMap" parameterType="java.util.HashMap">
  	 SELECT
		rc.*,ct.coverTypeName,ca.*,u.userName holder,u.id holderId,u.roleId holderRoleId
	FROM
		bf_bip_renewaling_customer rc
	LEFT JOIN bf_bip_cover_type ct ON ct.coverType = rc.renewalType,
 	bf_bip_customer_assign ca JOIN bf_bip_user u ON (ca.userId = u.id)
  	 <where>
  	 	rc.customerId = ca.customerId
  	 	and traceStatu != 3
  	 	<if test="userId != null and userId != ''">
  			and ca.userId = #{userId,jdbcType=INTEGER}
  		</if>
  		<if test="inviteStatu != null and inviteStatu != ''">
  			and ca.inviteStatu = #{inviteStatu,jdbcType=INTEGER}
  		</if> 
  		<if test="startTime != null and startTime != ''">
  			<![CDATA[and rc.inviteDate >= #{startTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="endTime != null and endTime != ''">
  			<![CDATA[and rc.inviteDate <= #{endTime,jdbcType=DATE}]]>
  		</if>
  		<if test="storeId != null and storeId != ''">
  			and rc.fourSStoreId = #{storeId}
  		</if> 
  		<!-- 添加查询条件过滤 -->
  		<if test="renewalType != null and renewalType != ''">
  			and rc.renewalType = #{renewalType}
  		</if>
  		<if test="holder != null and holder != ''">
  			and u.userName = #{holder}
  		</if>
  		<if test="chassisNumber != null and chassisNumber != ''">
  			and rc.chassisNumber like '%${chassisNumber}%'
  		</if>
  		<if test="contact != null and contact != ''">
  			and rc.contact = #{contact}
  		</if>
  		<if test="contactWay != null and contactWay != ''">
  			and (rc.contactWay like '%${contactWay}%'
	 		        or rc.contactWayReserve like '%${contactWay}%'
	 		    )
  		</if>
  		<if test="carLicenseNumber != null and carLicenseNumber != ''">
  			and rc.carLicenseNumber like '%${carLicenseNumber}%'
  		</if>
  	 </where>
  	 ORDER BY rc.id LIMIT #{start,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}
  </select>
   <!-- 统计上个查询的总数 -->
  <select id="countFindByInviteStatu" resultType="java.lang.Integer" parameterType="java.util.HashMap">
  	 select count(*) from bf_bip_renewaling_customer rc
  	 left join bf_bip_cover_type ct on ct.coverType = rc.renewalType, bf_bip_customer_assign ca 
  	 JOIN bf_bip_user u ON (ca.userId = u.id)
  	 <where>
  	 	rc.customerId = ca.customerId
  	 	and traceStatu != 3
  	 	<if test="userId != null and userId != ''">
  			and ca.userId = #{userId,jdbcType=INTEGER}
  		</if>
  		<if test="inviteStatu != null and inviteStatu != ''">
  			and ca.inviteStatu = #{inviteStatu,jdbcType=INTEGER}
  		</if> 
  		<if test="startTime != null and startTime != ''">
  			<![CDATA[and rc.inviteDate >= #{startTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="endTime != null and endTime != ''">
  			<![CDATA[and rc.inviteDate <= #{endTime,jdbcType=DATE}]]>
  		</if>
  		<if test="storeId != null and storeId != ''">
  			and rc.fourSStoreId = #{storeId}
  		</if> 
  		<!-- 添加查询条件过滤 -->
  		<if test="renewalType != null and renewalType != ''">
  			and rc.renewalType = #{renewalType}
  		</if>
  		<if test="holder != null and holder != ''">
  			and u.userName = #{holder}
  		</if>
  		<if test="chassisNumber != null and chassisNumber != ''">
  			and rc.chassisNumber like '%${chassisNumber}%'
  		</if>
  		<if test="contact != null and contact != ''">
  			and rc.contact = #{contact}
  		</if>
  		<if test="contactWay != null and contactWay != ''">
  			and (rc.contactWay like '%${contactWay}%'
	 		        or rc.contactWayReserve like '%${contactWay}%'
	 		    )
  		</if>
  		<if test="carLicenseNumber != null and carLicenseNumber != ''">
  			and rc.carLicenseNumber like '%${carLicenseNumber}%'
  		</if> 
  	 </where>
  </select>
  <select id="findByReturnStatu" resultMap="BaseResultMap" parameterType="java.util.HashMap">
  	 SELECT
		t.*, u.userName holder
	FROM
	(
		SELECT
			rc.fourSStoreId,
			rc.insuranceEndDate,
			rc.renewalType,
			rc.customerLevel,
			rc.contact,
			rc.contactWay,
			rc.principalId,
			rc.principal,
			rc.clerkId,
			rc.clerk,
			rc.status,
			rc.cusLostInsurStatu,
			rc.carLicenseNumber,
			rc.virtualJqxdqr,
			rc.lastTraceDate,
			rc.willingTraceDate,
			rc.lastTraceResult,
			rc.lastYearIsDeal,
			rc.chassisNumber,
			rc.firstAcceptDate,
			rc.factoryLicenseType,
			rc.carAnnualCheckUpDate,
			rc.insuredLY,
			rc.buyfromThisStore,
			rc.gotThroughNum,
			rc.contactWayReserve,
			rc.sfgyx,
			ct.coverTypeName,
			ca.customerId,
			ca.userId,
			ca.traceStatu,
			ca.traceDate,
			ca.inviteStatu,
			ca.inviteDate,
			ca.acceptStatu,
			ca.acceptDate,
			ca.returnStatu,
			ca.returnDate,
			ca.customerTraceId,
			ca.assignDate,
			ca.delayDate
		FROM
			bf_bip_renewaling_customer rc
		LEFT JOIN bf_bip_cover_type ct ON ct.coverType = rc.renewalType,
		bf_bip_customer_assign ca JOIN bf_bip_user u ON (ca.userId = u.id)
	 <where>
  	 	rc.customerId = ca.customerId
  	 	and rc.customerLevel != "O"
  	 	<if test="customerLevel != null and customerLevel != ''">
  			and rc.customerLevel = #{customerLevel}
  		</if>
  	 	<if test="users != null and users.size() > 0">
  			and ca.userId in
  			<foreach collection="users" item="user" open="(" separator="," close=")">
  				#{user.id}
  			</foreach> 
  		</if>
  		<if test="returnStatu != null and returnStatu != ''">
  			and ca.returnStatu = #{returnStatu,jdbcType=INTEGER}
  			<if test="returnStatu == 4">
  				and ifnull(ca.traceStatu, 0) != 3
  			</if>
  		</if> 
  		<if test="startTime != null and startTime != ''">
  			<![CDATA[and ca.returnDate >= #{startTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="endTime != null and endTime != ''">
  			<![CDATA[and ca.returnDate <= #{endTime,jdbcType=DATE}]]>
  		</if>
  		<if test="storeId != null and storeId != ''">
  			and rc.fourSStoreId = #{storeId}
  		</if> 
  		<!-- 添加查询条件过滤 -->
  		<if test="renewalType != null and renewalType != ''">
  			and rc.renewalType = #{renewalType}
  		</if>
  		<if test="holder != null and holder != ''">
  			and u.userName = #{holder}
  		</if>
  		<if test="chassisNumber != null and chassisNumber != ''">
  			and rc.chassisNumber like '%${chassisNumber}%'
  		</if>
  		<if test="contact != null and contact != ''">
  			and rc.contact = #{contact}
  		</if>
  		<if test="contactWay != null and contactWay != ''">
  			and (rc.contactWay like '%${contactWay}%'
	 		        or rc.contactWayReserve like '%${contactWay}%'
	 		    )
  		</if>
  		<if test="carLicenseNumber != null and carLicenseNumber != ''">
  			and rc.carLicenseNumber like '%${carLicenseNumber}%'
  		</if>
  		<if test="insuranceEndDateStart != null and insuranceEndDateStart !=''">
	 		<![CDATA[and  DATE_FORMAT(rc.insuranceEndDate,'%m-%d')  >=  #{insuranceEndDateStart,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="insuranceEndDateEnd != null and insuranceEndDateEnd !=''">
	 		<![CDATA[and  DATE_FORMAT(rc.insuranceEndDate,'%m-%d')  <=  #{insuranceEndDateEnd,jdbcType=DATE} ]]>
	 	</if> 
  	 </where>
	 <!-- ORDER BY rc.id  -->
	 <!-- short代表按某字段排序，shortmain 1：升序，2：降序 -->
	            <if test="short==null and shortmain==null"> ORDER BY  rc.id</if>
	            <if test="short==2 and shortmain==1"> ORDER BY  rc.principal ASC</if>
		  	    <if test="short==2 and shortmain==2"> ORDER BY  rc.principal DESC</if>
		  	    <if test="short==3 and shortmain==1"> ORDER BY  rc.clerk ASC</if>
		  	    <if test="short==3 and shortmain==2"> ORDER BY  rc.clerk DESC</if>
		  	    <if test="short==4 and shortmain==1"> ORDER BY  rc.contact ASC</if>
		  	    <if test="short==4 and shortmain==2"> ORDER BY  rc.contact DESC</if>
		  	    <if test="short==5 and shortmain==1"> ORDER BY  rc.contactWay ASC</if>
		  	    <if test="short==5 and shortmain==2"> ORDER BY  rc.contactWay DESC</if>
		  	    <if test="short==6 and shortmain==1"> ORDER BY  rc.chassisNumber ASC</if>
		  	    <if test="short==6 and shortmain==2"> ORDER BY  rc.chassisNumber DESC</if>
		  	    <if test="short==7 and shortmain==1"> ORDER BY  rc.carLicenseNumber ASC</if>
		  	    <if test="short==7 and shortmain==2"> ORDER BY  rc.carLicenseNumber DESC</if>
		  	    <if test="short==8 and shortmain==1"> ORDER BY  ct.coverTypeName ASC</if>
		  	    <if test="short==8 and shortmain==2"> ORDER BY  ct.coverTypeName DESC</if>
		  	    <if test="short==9 and shortmain==1"> ORDER BY  DATE_FORMAT(rc.insuranceEndDate,'%m-%d') ASC</if>
		  	    <if test="short==9 and shortmain==2"> ORDER BY  DATE_FORMAT(rc.insuranceEndDate,'%m-%d') DESC</if>
		  	    <if test="short==10 and shortmain==1"> ORDER BY  rc.bhUpdateTime ASC</if>
		  	    <if test="short==10 and shortmain==2"> ORDER BY  rc.bhUpdateTime DESC</if>
		  	    <if test="short==11 and shortmain==1"> ORDER BY rc.customerLevel ASC</if>
  	            <if test="short==11 and shortmain==2"> ORDER BY rc.customerLevel DESC</if>
		  	    <if test="short==12 and shortmain==1"> ORDER BY  rc.gotThroughNum ASC</if>
		  	    <if test="short==12 and shortmain==2"> ORDER BY  rc.gotThroughNum DESC</if>
		  	    <if test="short==13 and shortmain==1"> ORDER BY  rc.willingTraceDate ASC</if>
		  	    <if test="short==13 and shortmain==2"> ORDER BY  rc.willingTraceDate DESC</if>
		  	    <if test="short==14 and shortmain==1"> ORDER BY  rc.lastTraceDate ASC</if>
		  	    <if test="short==14 and shortmain==2"> ORDER BY  rc.lastTraceDate DESC</if>
		  	    <if test="short==15 and shortmain==1"> ORDER BY  rc.lastTraceResult ASC</if>
		  	    <if test="short==15 and shortmain==2"> ORDER BY  rc.lastTraceResult DESC</if>
		  	    <if test="short==16 and shortmain==1"> ORDER BY  ca.delayDate ASC</if>
		  	    <if test="short==16 and shortmain==2"> ORDER BY  ca.delayDate DESC</if>
		  	    <if test="short==17 and shortmain==1"> ORDER BY  rc.virtualJqxdqr ASC</if>
		  	    <if test="short==17 and shortmain==2"> ORDER BY  rc.virtualJqxdqr DESC</if>
		  	    <if test="short==18 and shortmain==1"> ORDER BY  ca.assignDate ASC</if>
		  	    <if test="short==18 and shortmain==2"> ORDER BY  ca.assignDate DESC</if>
		  	    <if test="short==19 and shortmain==1"> ORDER BY  #{userName} ASC</if>
		  	    <if test="short==19 and shortmain==2"> ORDER BY  #{userName} DESC</if>
	 LIMIT #{start,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}
	) AS t
	LEFT JOIN bf_bip_customer_assign ca2 ON t.customerId = ca2.customerId
	AND ifnull(ca2.traceStatu, 0) != 3
	LEFT JOIN bf_bip_user u ON ca2.userId = u.id

  </select>
  <!-- 统计上个查询的总数 -->
  <select id="countFindByReturnStatu" resultType="java.lang.Integer" parameterType="java.util.HashMap">
  	  select count(*) from bf_bip_renewaling_customer rc
  	 left join bf_bip_cover_type ct on ct.coverType = rc.renewalType, bf_bip_customer_assign ca 
  	 JOIN bf_bip_user u ON (ca.userId = u.id)
  	 <where>
  	 	rc.customerId = ca.customerId
  	 	and rc.customerLevel != "O"
  	 	<if test="customerLevel != null and customerLevel != ''">
  			and rc.customerLevel = #{customerLevel}
  		</if>
  	 	<if test="users != null and users.size() > 0">
  			and ca.userId in
  			<foreach collection="users" item="user" open="(" separator="," close=")">
  				#{user.id}
  			</foreach> 
  		</if>
  		<if test="returnStatu != null and returnStatu != ''">
  			and ca.returnStatu = #{returnStatu,jdbcType=INTEGER}
  			<if test="returnStatu == 4">
  				and ifnull(ca.traceStatu, 0) != 3
  			</if>
  		</if> 
  		<if test="startTime != null and startTime != ''">
  			<![CDATA[and ca.returnDate >= #{startTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="endTime != null and endTime != ''">
  			<![CDATA[and ca.returnDate <= #{endTime,jdbcType=DATE}]]>
  		</if>
  		<if test="storeId != null and storeId != ''">
  			and rc.fourSStoreId = #{storeId}
  		</if> 
  		<!-- 添加查询条件过滤 -->
  		<if test="renewalType != null and renewalType != ''">
  			and rc.renewalType = #{renewalType}
  		</if>
  		<if test="holder != null and holder != ''">
  			and u.userName = #{holder}
  		</if>
  		<if test="chassisNumber != null and chassisNumber != ''">
  			and rc.chassisNumber like '%${chassisNumber}%'
  		</if>
  		<if test="contact != null and contact != ''">
  			and rc.contact = #{contact}
  		</if>
  		<if test="contactWay != null and contactWay != ''">
  			and (rc.contactWay like '%${contactWay}%'
	 		        or rc.contactWayReserve like '%${contactWay}%'
	 		    )
  		</if>
  		<if test="carLicenseNumber != null and carLicenseNumber != ''">
  			and rc.carLicenseNumber like '%${carLicenseNumber}%'
  		</if> 
  		<if test="insuranceEndDateStart != null and insuranceEndDateStart !=''">
	 		<![CDATA[and  DATE_FORMAT(rc.insuranceEndDate,'%m-%d')  >=  #{insuranceEndDateStart,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="insuranceEndDateEnd != null and insuranceEndDateEnd !=''">
	 		<![CDATA[and  DATE_FORMAT(rc.insuranceEndDate,'%m-%d')  <=  #{insuranceEndDateEnd,jdbcType=DATE} ]]>
	 	</if> 
  	 </where>
  </select>
  <!-- 根据回退状态查询潜客信息潜客跟踪记录总数 -->
  <select id="countFindByReturnStatuGzjl" resultType="java.lang.Integer" parameterType="java.util.HashMap">
  select  
   	count(1)
  from bf_bip_customer_trace_recode
    	where customerId in(select 
			t.customerId from (
				SELECT
				a.fourSStoreId,
				a.insuranceEndDate,
				a.renewalType,
				a.customerLevel,
				a.contact,
				a.contactWay,
				a.principalId,
				a.principal,
				a.clerkId,
				a.clerk,
				a. STATUS,
				a.cusLostInsurStatu,
				a.carLicenseNumber,
				a.virtualJqxdqr,
				a.lastTraceDate,
				a.willingTraceDate,
				a.lastTraceResult,
				a.lastYearIsDeal,
				a.chassisNumber,
				a.firstAcceptDate,
				a.factoryLicenseType,
				a.carAnnualCheckUpDate,
				a.insuredLY,
				a.buyfromThisStore,
				a.gotThroughNum,
				a.contactWayReserve,
				a.sfgyx,
				b.coverTypeName,
				a.customerId,
				d.userName htr
			FROM
				bf_bip_cover_type b,
				bf_bip_operation_record c,
				bf_bip_user d,
				bf_bip_renewaling_customer a
			LEFT JOIN bf_bip_customer_assign e ON a.customerId = e.customerId
			<where>
		  	 	a.renewalType = b.coverType
				AND a.customerId = c.customerId
				AND c.operationFlag = 2
				AND c.userId = d.id
				AND c.userId = e.userId
			  	<if test="storeId != null and storeId != ''">
			  		and a.fourSStoreId = #{storeId}
			  	</if>
			  	<if test="userId != null and userId != ''">
			  		and c.userId = #{userId}
			  	</if>
			  	<if test="roleId != null and roleId != ''">
			  		and d.roleId = #{roleId}
			  	</if>
			  	<if test="startTime != null and startTime != ''">
			  		<![CDATA[and c.operationDate >= #{startTime,jdbcType=DATE}]]>
			  	</if> 
			  	<if test="endTime != null and endTime != ''">
			  		<![CDATA[and c.operationDate <= #{endTime,jdbcType=DATE}]]>
			  	</if>
			  	<if test="renewalType != null and renewalType != ''">
						and a.renewalType = #{renewalType}
				</if>
				<if test="insuranceCompLY != null and insuranceCompLY !=''">
					and a.insuranceCompLY = #{insuranceCompLY}
				</if>
				<if test="customerLevel != null and customerLevel !=''">
					and a.customerLevel = #{customerLevel}
				</if>
				<if test="insuranceEndDateStart != null and insuranceEndDateStart !=''">
					<![CDATA[and a.insuranceEndDate >=  #{insuranceEndDateStart}]]>
				</if>
				<if test="insuranceEndDateEnd != null and insuranceEndDateEnd !=''">
					<![CDATA[and a.insuranceEndDate <=  #{insuranceEndDateEnd}]]>
				</if>
				<if test="contact != null and contact !=''">
					and a.contact = #{contact}
				</if>
				<if test="contactWay != null and contactWay !=''">
					and a.contactWay like '%${contactWay}%'
				</if>
				<if test="carBrand != null and carBrand !=''">
					and a.carBrand = #{carBrand}
				</if>
				<if test="vehicleModel != null and vehicleModel !=''">
					and a.vehicleModel = #{vehicleModel}
				</if>
				<if test="chassisNumber != null and chassisNumber !=''">
					and a.chassisNumber like '%${chassisNumber}%'
				</if>
				<if test="carLicenseNumber != null and carLicenseNumber !=''">
					and a.carLicenseNumber like '%${carLicenseNumber}%'
				</if>
				<if test="insured != null and insured != ''">
					and a.insured = #{insured}
				</if>
				<if test="carOwner != null and carOwner !=''">
					and a.carOwner like '%${carOwner}%' 
				</if>
				<if test="operatorID != null and operatorID != ''">
					and c.userId = #{operatorID}
				</if>
		  	 </where>
		) t LEFT JOIN bf_bip_customer_assign e on t.customerId = e.customerId and IFNULL(e.traceStatu,0) !=3
			LEFT JOIN bf_bip_user d on e.userId = d.id
			<where>
				<if test="holder != null and holder !=''">
					and d.userName = #{holder}
				</if>
				<if test="roleId1 != null and roleId1 != ''">
			  		and d.roleId = #{roleId1}
			  	</if>
			</where>)
  </select>
   <select id="findByApproval" resultMap="BaseResultMap" parameterType="java.util.HashMap">
  	 SELECT
		rc.*,ct.coverTypeName,ca.*,u.userName holder,u.id holderId,u.roleId holderRoleId
	FROM
		bf_bip_renewaling_customer rc
	LEFT JOIN bf_bip_cover_type ct ON ct.coverType = rc.renewalType,
 	bf_bip_customer_assign ca JOIN bf_bip_user u ON (ca.userId = u.id)
  	 <where>
  	 	rc.customerId = ca.customerId
  	 	and ifnull(ca.traceStatu,0) != 3
  	 	<if test="users != null and users.size() > 0">
  			and ca.userId in
  			<foreach collection="users" item="user" open="(" separator="," close=")">
  				#{user.id}
  			</foreach> 
  		</if>
  		<if test="returnStatu1 != null and returnStatu1 != '' or returnStatu2 != null and returnStatu2 != ''">
  			and (ca.returnStatu = #{returnStatu1,jdbcType=INTEGER} or ca.returnStatu = #{returnStatu2,jdbcType=INTEGER})
  		</if>
  		<if test="returnStatu3 != null and returnStatu3 != ''">
  			and ca.returnStatu = #{returnStatu3,jdbcType=INTEGER}
  		</if>
  		<if test="applyStatu != null and applyStatu != ''">
  			and ca.applyStatu = #{applyStatu,jdbcType=INTEGER}
  		</if>
  		<if test="startTime != null and startTime != ''">
  			<![CDATA[and ca.returnDate >= #{startTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="endTime != null and endTime != ''">
  			<![CDATA[and ca.returnDate <= #{endTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="storeId != null and storeId != ''">
  			and rc.fourSStoreId = #{storeId}
  		</if> 
  		<!-- 添加查询条件过滤 -->
  		<if test="renewalType != null and renewalType != ''">
  			and rc.renewalType = #{renewalType}
  		</if>
  		<if test="holder != null and holder != ''">
  			and u.userName = #{holder}
  		</if>
  		<if test="chassisNumber != null and chassisNumber != ''">
  			and rc.chassisNumber like '%${chassisNumber}%'
  		</if>
  		<if test="contact != null and contact != ''">
  			and rc.contact = #{contact}
  		</if>
  		<if test="contactWay != null and contactWay != ''">
  			and (rc.contactWay like '%${contactWay}%'
	 		        or rc.contactWayReserve like '%${contactWay}%'
	 		    )
  		</if>
  		<if test="carLicenseNumber != null and carLicenseNumber != ''">
  			and rc.carLicenseNumber like '%${carLicenseNumber}%'
  		</if> 
  	 </where>
  	 <!-- ORDER BY rc.id --> 
  	 <!-- short代表按某字段排序，shortmain 1：升序，2：降序 -->
  	            <if test="short==null and shortmain==null"> ORDER BY  rc.id</if>
  	            <if test="short==2 and shortmain==1"> ORDER BY  rc.principal ASC</if>
		  	    <if test="short==2 and shortmain==2"> ORDER BY  rc.principal DESC</if>
		  	    <if test="short==3 and shortmain==1"> ORDER BY  rc.clerk ASC</if>
		  	    <if test="short==3 and shortmain==2"> ORDER BY  rc.clerk DESC</if>
		  	    <if test="short==4 and shortmain==1"> ORDER BY  rc.contact ASC</if>
		  	    <if test="short==4 and shortmain==2"> ORDER BY  rc.contact DESC</if>
		  	    <if test="short==5 and shortmain==1"> ORDER BY  rc.contactWay ASC</if>
		  	    <if test="short==5 and shortmain==2"> ORDER BY  rc.contactWay DESC</if>
		  	    <if test="short==6 and shortmain==1"> ORDER BY  rc.chassisNumber ASC</if>
		  	    <if test="short==6 and shortmain==2"> ORDER BY  rc.chassisNumber DESC</if>
		  	    <if test="short==7 and shortmain==1"> ORDER BY  rc.carLicenseNumber ASC</if>
		  	    <if test="short==7 and shortmain==2"> ORDER BY  rc.carLicenseNumber DESC</if>
		  	    <if test="short==8 and shortmain==1"> ORDER BY  ct.coverTypeName ASC</if>
		  	    <if test="short==8 and shortmain==2"> ORDER BY  ct.coverTypeName DESC</if>
		  	    <if test="short==9 and shortmain==1"> ORDER BY  DATE_FORMAT(rc.insuranceEndDate,'%m-%d') ASC</if>
		  	    <if test="short==9 and shortmain==2"> ORDER BY  DATE_FORMAT(rc.insuranceEndDate,'%m-%d') DESC</if>
		  	    <if test="short==10 and shortmain==1"> ORDER BY  rc.bhUpdateTime ASC</if>
		  	    <if test="short==10 and shortmain==2"> ORDER BY  rc.bhUpdateTime DESC</if>
		  	    <if test="short==11 and shortmain==1"> ORDER BY rc.customerLevel ASC</if>
  	            <if test="short==11 and shortmain==2"> ORDER BY rc.customerLevel DESC</if>
		  	    <if test="short==12 and shortmain==1"> ORDER BY  rc.gotThroughNum ASC</if>
		  	    <if test="short==12 and shortmain==2"> ORDER BY  rc.gotThroughNum DESC</if>
		  	    <if test="short==13 and shortmain==1"> ORDER BY  rc.willingTraceDate ASC</if>
		  	    <if test="short==13 and shortmain==2"> ORDER BY  rc.willingTraceDate DESC</if>
		  	    <if test="short==14 and shortmain==1"> ORDER BY  rc.lastTraceDate ASC</if>
		  	    <if test="short==14 and shortmain==2"> ORDER BY  rc.lastTraceDate DESC</if>
		  	    <if test="short==15 and shortmain==1"> ORDER BY  rc.lastTraceResult ASC</if>
		  	    <if test="short==15 and shortmain==2"> ORDER BY  rc.lastTraceResult DESC</if>
		  	    <if test="short==16 and shortmain==1"> ORDER BY  ca.delayDate ASC</if>
		  	    <if test="short==16 and shortmain==2"> ORDER BY  ca.delayDate DESC</if>
		  	    <if test="short==17 and shortmain==1"> ORDER BY  rc.virtualJqxdqr ASC</if>
		  	    <if test="short==17 and shortmain==2"> ORDER BY  rc.virtualJqxdqr DESC</if>
		  	    <if test="short==18 and shortmain==1"> ORDER BY  ca.assignDate ASC</if>
		  	    <if test="short==18 and shortmain==2"> ORDER BY  ca.assignDate DESC</if>
		  	    <if test="short==19 and shortmain==1"> ORDER BY  holder ASC</if>
		  	    <if test="short==19 and shortmain==2"> ORDER BY  holder DESC</if>
  	 LIMIT #{start,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}
  </select>
  <select id="findByApprovalCount" resultType="java.lang.Integer" parameterType="java.util.HashMap">
  	  select count(*) from bf_bip_renewaling_customer rc
  	 left join bf_bip_cover_type ct on ct.coverType = rc.renewalType, bf_bip_customer_assign ca 
  	 JOIN bf_bip_user u ON (ca.userId = u.id)
  	 <where>
  	 	rc.customerId = ca.customerId
  	 	and ifnull(ca.traceStatu,0) != 3
  	 	<if test="users != null and users.size() > 0">
  			and ca.userId in
  			<foreach collection="users" item="user" open="(" separator="," close=")">
  				#{user.id}
  			</foreach> 
  		</if>
  		<if test="returnStatu1 != null and returnStatu1 != '' or returnStatu2 != null and returnStatu2 != ''">
  			and (ca.returnStatu = #{returnStatu1,jdbcType=INTEGER} or ca.returnStatu = #{returnStatu2,jdbcType=INTEGER})
  		</if>
  		<if test="returnStatu3 != null and returnStatu3 != ''">
  			and ca.returnStatu = #{returnStatu3,jdbcType=INTEGER}
  		</if>
  		<if test="applyStatu != null and applyStatu != ''">
  			and ca.applyStatu = #{applyStatu,jdbcType=INTEGER}
  		</if> 
  		<if test="startTime != null and startTime != ''">
  			<![CDATA[and ca.returnDate >= #{startTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="endTime != null and endTime != ''">
  			<![CDATA[and ca.returnDate <= #{endTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="storeId != null and storeId != ''">
  			and rc.fourSStoreId = #{storeId}
  		</if> 
  		<!-- 添加查询条件过滤 -->
  		<if test="renewalType != null and renewalType != ''">
  			and rc.renewalType = #{renewalType}
  		</if>
  		<if test="holder != null and holder != ''">
  			and u.userName = #{holder}
  		</if>
  		<if test="chassisNumber != null and chassisNumber != ''">
  			and rc.chassisNumber like '%${chassisNumber}%'
  		</if>
  		<if test="contact != null and contact != ''">
  			and rc.contact like '%${contact}%'
  		</if>
  		<if test="contactWay != null and contactWay != ''">
  			and (rc.contactWay like '%${contactWay}%'
	 		        or rc.contactWayReserve like '%${contactWay}%'
	 		    )
  		</if>
  		<if test="carLicenseNumber != null and carLicenseNumber != ''">
  			and rc.carLicenseNumber like '%${carLicenseNumber}%'
  		</if>
  		<!-- 手机端 -->
  		<if test="insuranceCompLY != null">
			and rc.insuranceCompLY = #{insuranceCompLY}
		</if>
		<if test="customerLevel != null">
			and rc.customerLevel = #{customerLevel}
		</if>
		<if test="insuranceEndDateStart != null">
			<![CDATA[and rc.insuranceEndDate >=  #{insuranceEndDateStart}]]>
		</if>
		<if test="insuranceEndDateEnd != null">
			<![CDATA[and rc.insuranceEndDate <=  #{insuranceEndDateEnd}]]>
		</if>
		<if test="carBrand != null">
			and rc.carBrand = #{carBrand}
		</if>
		<if test="vehicleModel != null">
			and rc.vehicleModel = #{vehicleModel}
		</if>
		<if test="insured != null">
			and rc.insured like '%${insured}%'
		</if>
		<if test="carOwner != null">
			and rc.carOwner like '%${carOwner}%'
		</if> 
  	 </where>
  </select>
  <!-- 查询待审批潜客跟踪记录总数 -->
  <select id="countFindByApprovalGzjl" resultType="java.lang.Integer" parameterType="java.util.HashMap">
  select  
   	count(1)
  from bf_bip_customer_trace_recode
    	where customerId in(
  	  select rc.customerId from bf_bip_renewaling_customer rc
  	 left join bf_bip_cover_type ct on ct.coverType = rc.renewalType, bf_bip_customer_assign ca 
  	 JOIN bf_bip_user u ON (ca.userId = u.id)
  	 <where>
  	 	rc.customerId = ca.customerId
  	 	and ifnull(ca.traceStatu,0) != 3
  	 	<if test="users != null and users.size() > 0">
  			and ca.userId in
  			<foreach collection="users" item="user" open="(" separator="," close=")">
  				#{user.id}
  			</foreach> 
  		</if>
  		<if test="returnStatu1 != null and returnStatu1 != '' or returnStatu2 != null and returnStatu2 != ''">
  			and (ca.returnStatu = #{returnStatu1,jdbcType=INTEGER} or ca.returnStatu = #{returnStatu2,jdbcType=INTEGER})
  		</if> 
  		<if test="startTime != null and startTime != ''">
  			<![CDATA[and ca.returnDate >= #{startTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="endTime != null and endTime != ''">
  			<![CDATA[and ca.returnDate <= #{endTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="storeId != null and storeId != ''">
  			and rc.fourSStoreId = #{storeId}
  		</if> 
  		<!-- 添加查询条件过滤 -->
  		<if test="renewalType != null and renewalType != ''">
  			and rc.renewalType = #{renewalType}
  		</if>
  		<if test="holder != null and holder != ''">
  			and u.userName = #{holder}
  		</if>
  		<if test="chassisNumber != null and chassisNumber != ''">
  			and rc.chassisNumber like '%${chassisNumber}%'
  		</if>
  		<if test="contact != null and contact != ''">
  			and rc.contact like '%${contact}%'
  		</if>
  		<if test="contactWay != null and contactWay != ''">
  			and (rc.contactWay like '%${contactWay}%'
	 		        or rc.contactWayReserve like '%${contactWay}%'
	 		    )
  		</if>
  		<if test="carLicenseNumber != null and carLicenseNumber != ''">
  			and rc.carLicenseNumber like '%${carLicenseNumber}%'
  		</if>
  		<!-- 手机端 -->
  		<if test="insuranceCompLY != null">
			and rc.insuranceCompLY = #{insuranceCompLY}
		</if>
		<if test="customerLevel != null">
			and rc.customerLevel = #{customerLevel}
		</if>
		<if test="insuranceEndDateStart != null">
			<![CDATA[and rc.insuranceEndDate >=  #{insuranceEndDateStart}]]>
		</if>
		<if test="insuranceEndDateEnd != null">
			<![CDATA[and rc.insuranceEndDate <=  #{insuranceEndDateEnd}]]>
		</if>
		<if test="carBrand != null">
			and rc.carBrand = #{carBrand}
		</if>
		<if test="vehicleModel != null">
			and rc.vehicleModel = #{vehicleModel}
		</if>
		<if test="insured != null">
			and rc.insured like '%${insured}%'
		</if>
		<if test="carOwner != null">
			and rc.carOwner like '%${carOwner}%'
		</if>  
  	 </where>)
  </select>
  <select id="findByCondition" resultMap="BaseResultMap" parameterType="java.util.HashMap" >
    SELECT
		rc.*,ct.coverTypeName,ca.*,u.userName holder
	FROM
		bf_bip_renewaling_customer rc
	LEFT JOIN bf_bip_cover_type ct ON ct.coverType = rc.renewalType,
 	bf_bip_customer_assign ca JOIN bf_bip_user u ON (ca.userId = u.id)
     <where>
     	rc.customerId = ca.customerId 
     	and fourSStoreId = #{fourSStoreId}
     	and traceStatu != 3
     	and acceptStatu != 1
     	and ifnull(returnStatu,0) not in (2,5) 
  		<if test="users != null and users.size() > 0">
  			and ca.userId in
  			<foreach collection="users" item="user" open="(" separator="," close=")">
  				#{user.id}
  			</foreach> 
  		</if>
  		
	 	<if test="condition.carBrand != null and condition.carBrand !=''">
	 		and rc.carBrand = #{condition.carBrand}
	 	</if>
	 	<if test="condition.vehicleModel != null and condition.vehicleModel !=''">
	 		and rc.vehicleModel = #{condition.vehicleModel}
	 	</if>
	 	<if test="condition.chassisNumber != null and condition.chassisNumber !=''">
	 		and rc.chassisNumber like '%${condition.chassisNumber}%'
	 	</if>
	 	<if test="condition.carLicenseNumber != null and condition.carLicenseNumber !=''">
	 		and rc.carLicenseNumber like '%${condition.carLicenseNumber}%'
	 	</if>
	 	<if test="condition.insured != null and condition.insured !=''">
	 		and rc.insured = #{condition.insured}
	 	</if>
	 	<if test="condition.contact != null and condition.contact !=''">
	 		and rc.contact = #{condition.contact}
	 	</if>
	 	<if test="condition.contactWay != null and condition.contactWay !=''">
	 		and (rc.contactWay like '%${condition.contactWay}%'
	 		        or rc.contactWayReserve like '%${condition.contactWay}%'
	 		    )
	 	</if>
	 	<if test="condition.insuranceCompLY != null and condition.insuranceCompLY !=''">
	 		and rc.insuranceCompLY = #{condition.insuranceCompLY}
	 	</if>
	 	<!-- 投保类型可以多选 -->
	 	<if test="condition.renewalTypes != null and condition.renewalTypes.size() > 0">
  			and rc.renewalType in
  			<foreach collection="condition.renewalTypes" item="renewalType" open="(" separator="," close=")">
  				#{renewalType}
  			</foreach> 
  		</if>
	 	<if test="condition.customerLevel != null and condition.customerLevel.size() > 0">
  			and rc.customerLevel in 
  			<foreach collection="condition.customerLevel" item="level" open="(" separator="," close=")">
  				#{level}
  			</foreach>
  		</if>
	 	<if test="condition.comeStoreNumber != null and condition.comeStoreNumber !=''">
	 		and rc.comeStoreNumber = #{condition.comeStoreNumber}
	 	</if>
	 		<if test="condition.principalId != null and condition.principalId !=''">
	 		and rc.principalId = #{condition.principalId}
	 	</if>
	 	<if test="condition.insurNumber != null and condition.insurNumber !=''">
	 		and rc.insurNumber = #{condition.insurNumber}
	 	</if>
	 	<if test="insurDateLYStart != null and insurDateLYStart !=''">
	 		<![CDATA[and  rc.insurDateLY  >=  #{insurDateLYStart,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="insurDateLYEnd != null and insurDateLYEnd !=''">
	 		<![CDATA[and  rc.insurDateLY  <=  #{insurDateLYEnd,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="insuranceEndDateStart != null and insuranceEndDateStart !=''">
	 		<![CDATA[and  DATE_FORMAT(rc.insuranceEndDate,'%m-%d')  >=  #{insuranceEndDateStart,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="insuranceEndDateEnd != null and insuranceEndDateEnd !=''">
	 		<![CDATA[and  DATE_FORMAT(rc.insuranceEndDate,'%m-%d')  <=  #{insuranceEndDateEnd,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="syxrqDateStart != null and syxrqDateStart !=''">
	 		<![CDATA[and  DATE_FORMAT(rc.syxrqEnd,'%m-%d') >=  #{syxrqDateStart,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="syxrqDateEnd != null and syxrqDateEnd !=''">
	 		<![CDATA[and  DATE_FORMAT(rc.syxrqEnd,'%m-%d') <=  #{syxrqDateEnd,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="condition.isInvite != null">
	 		and IFNULL(rc.isInvite,0) = #{condition.isInvite}
	 	</if>
	 	<if test="inviteDateStart != null and inviteDateStart !=''">
	 		<![CDATA[and  rc.inviteDate  >=  #{inviteDateStart,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="inviteDateEnd != null and inviteDateEnd !=''">
	 		<![CDATA[and  rc.inviteDate  <=  #{inviteDateEnd,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="condition.isComeStore != null">
	 		and rc.isComeStore = #{condition.isComeStore}
	 	</if>
	 	<if test="comeStoreDateStart != null and comeStoreDateStart !=''">
	 		<![CDATA[and  rc.comeStoreDate  >=  #{comeStoreDateStart,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="comeStoreDateEnd != null and comeStoreDateEnd !=''">
	 		<![CDATA[and  rc.comeStoreDate  <=  #{comeStoreDateEnd,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="lastTraceDateStart != null and lastTraceDateStart !=''">
	 		<![CDATA[and  DATE_FORMAT(rc.lastTraceDate,'%Y-%m-%d')  >=  #{lastTraceDateStart,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="lastTraceDateEnd != null and lastTraceDateEnd !=''">
	 		<![CDATA[and  DATE_FORMAT(rc.lastTraceDate,'%Y-%m-%d')  <=  #{lastTraceDateEnd,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="condition.isQuote != null">
	 		and rc.isQuote = #{condition.isQuote}
	 	</if>
	 	<if test="quoteDateStart != null and quoteDateStart !=''">
	 		<![CDATA[and  rc.quoteDate  >=  #{quoteDateStart,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="quoteDateEnd != null and quoteDateEnd !=''">
	 		<![CDATA[and  rc.quoteDate  <=  #{quoteDateEnd,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="traceDateStart != null and traceDateStart !=''">
	 		<![CDATA[and  rc.willingTraceDate  >=  #{traceDateStart,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="traceDateEnd != null and traceDateEnd !=''">
	 		<![CDATA[and  rc.willingTraceDate  <=  #{traceDateEnd,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="zdZheKouStart != null and zdZheKouStart !=''">
	 		<![CDATA[and  rc.zdZheKou  >=  #{zdZheKouStart} ]]>
	 	</if>
	 	<if test="zdZheKouEnd != null and zdZheKouEnd !=''">
	 		<![CDATA[and  rc.zdZheKou  <=  #{zdZheKouEnd} ]]>
	 	</if>
	 	<if test="remainLostInsurDayStart != null and remainLostInsurDayStart !=''">
	 		<![CDATA[and  rc.virtualJqxdqr  >=  #{remainLostInsurDayStart,jdbcType=DATE}]]>
	 	</if>
	 	<if test="remainLostInsurDayEnd != null and remainLostInsurDayEnd !=''">
	 		<![CDATA[and  rc.virtualJqxdqr  <=  #{remainLostInsurDayEnd,jdbcType=DATE}]]>
	 	</if>
	 	<if test="remainLostInsurDayEnd != null and remainLostInsurDayEnd !='' and remainLostInsurDayStart != null and remainLostInsurDayStart !=''">
	 		and  rc.customerLevel not in('F','S','O') and rc.status=2
	 	</if>
	 	<!-- 添加车主,持有人查询条件 -->
	 	<if test="condition.carOwner != null and condition.carOwner !=''">
	 		and rc.carOwner like '%${condition.carOwner}%'
	 	</if>
	 	<if test="condition.holder != null and condition.holder !=''">
	 		and u.userName = #{condition.holder}
	 	</if>
	 	<if test="condition.sfgyx != null">
	 		and rc.sfgyx = #{condition.sfgyx}
	 	</if>
	 	<if test="condition.ifLoan != null">
	 		and rc.ifLoan = #{condition.ifLoan}
	 	</if>
	 	<if test="registrationDateStart != null and registrationDateStart !=''">
	 		<![CDATA[and  rc.registrationDate >=  #{registrationDateStart,jdbcType=DATE}]]>
	 	</if>
	 	<if test="registrationDateEnd != null and registrationDateEnd !=''">
	 		<![CDATA[and  rc.registrationDate <=  #{registrationDateEnd,jdbcType=DATE}]]>
	 	</if>
	 </where>
	 <!-- ORDER BY rc.id  -->
	 <!-- short代表按某字段排序，shortmain 1：升序，2：降序 -->
	    <if test="short==null and shortmain==null">ORDER BY rc.id</if>
  	    <if test="short==2 and shortmain==1">ORDER BY rc.principal ASC</if>
  	    <if test="short==2 and shortmain==2">ORDER BY rc.principal DESC</if>
  	    <if test="short==3 and shortmain==1">ORDER BY rc.clerk ASC</if>
  	    <if test="short==3 and shortmain==2">ORDER BY rc.clerk DESC</if>
  	    <if test="short==4 and shortmain==1">ORDER BY rc.contact ASC</if>
  	    <if test="short==4 and shortmain==2">ORDER BY rc.contact DESC</if>
  	    <if test="short==5 and shortmain==1">ORDER BY rc.contactWay ASC</if>
  	    <if test="short==5 and shortmain==2">ORDER BY rc.contactWay DESC</if>
		<if test="short==6 and shortmain==1">ORDER BY rc.chassisNumber ASC</if>
  	    <if test="short==6 and shortmain==2">ORDER BY rc.chassisNumber DESC</if>
		<if test="short==7 and shortmain==1">ORDER BY rc.carLicenseNumber ASC</if>
  	    <if test="short==7 and shortmain==2">ORDER BY rc.carLicenseNumber DESC</if>
		<if test="short==8 and shortmain==1">ORDER BY ct.coverTypeName ASC</if>
  	    <if test="short==8 and shortmain==2">ORDER BY ct.coverTypeName DESC</if>
  	    <if test="short==9 and shortmain==1">ORDER BY DATE_FORMAT(rc.insuranceEndDate,'%m-%d') ASC</if>
  	    <if test="short==9 and shortmain==2">ORDER BY DATE_FORMAT(rc.insuranceEndDate,'%m-%d') DESC</if>
  	    <if test="short==10 and shortmain==1">ORDER BY rc.bhUpdateTime ASC</if>
  	    <if test="short==10 and shortmain==2">ORDER BY rc.bhUpdateTime DESC</if>
  	    <if test="short==11 and shortmain==1"> ORDER BY rc.customerLevel ASC</if>
  	    <if test="short==11 and shortmain==2"> ORDER BY rc.customerLevel DESC</if>
  	    <if test="short==12 and shortmain==1">ORDER BY rc.gotThroughNum ASC</if>
  	    <if test="short==12 and shortmain==2">ORDER BY rc.gotThroughNum DESC</if>
  	    <if test="short==13 and shortmain==1">ORDER BY rc.willingTraceDate ASC</if>
  	    <if test="short==13 and shortmain==2">ORDER BY rc.willingTraceDate DESC</if>
  	    <if test="short==14 and shortmain==1">ORDER BY rc.lastTraceDate ASC</if>
  	    <if test="short==14 and shortmain==2">ORDER BY rc.lastTraceDate DESC</if>
  	    <if test="short==15 and shortmain==1">ORDER BY rc.lastTraceResult ASC</if>
  	    <if test="short==15 and shortmain==2">ORDER BY rc.lastTraceResult DESC</if>
  	    <if test="short==16 and shortmain==1">ORDER BY ca.delayDate ASC</if>
  	    <if test="short==16 and shortmain==2">ORDER BY ca.delayDate DESC</if>
  	    <if test="short==17 and shortmain==1">ORDER BY rc.virtualJqxdqr ASC</if>
  	    <if test="short==17 and shortmain==2">ORDER BY rc.virtualJqxdqr DESC</if>
  	    <if test="short==18 and shortmain==1">ORDER BY ca.assignDate ASC</if>
  	    <if test="short==18 and shortmain==2">ORDER BY ca.assignDate DESC</if>
  	    <if test="short==19 and shortmain==1">ORDER BY holder ASC</if>
  	    <if test="short==19 and shortmain==2">ORDER BY holder DESC</if>
	 LIMIT #{start,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}
  </select>
  	<!-- 统计上个查询的总数 -->
   <select id="countFindByCondition" resultType="java.lang.Integer" parameterType="java.util.HashMap" >
    select 
    	count(*) 
    from bf_bip_renewaling_customer rc, bf_bip_customer_assign ca 
    JOIN bf_bip_user u ON (ca.userId = u.id)
     <where>
     	rc.customerId = ca.customerId 
     	and fourSStoreId = #{fourSStoreId}
     	and traceStatu != 3
     	and acceptStatu != 1
     	and ( ifnull(returnStatu,0) != 2 or  ifnull(returnStatu,0) != 5) 
  		<if test="users != null and users.size() > 0">
  			and ca.userId in
  			<foreach collection="users" item="user" open="(" separator="," close=")">
  				#{user.id}
  			</foreach> 
  		</if>
  		
	 	<if test="condition.carBrand != null and condition.carBrand !=''">
	 		and rc.carBrand = #{condition.carBrand}
	 	</if>
	 	<if test="condition.vehicleModel != null and condition.vehicleModel !=''">
	 		and rc.vehicleModel = #{condition.vehicleModel}
	 	</if>
	 	<if test="condition.chassisNumber != null and condition.chassisNumber !=''">
	 		and rc.chassisNumber like '%${condition.chassisNumber}%'
	 	</if>
	 	<if test="condition.carLicenseNumber != null and condition.carLicenseNumber !=''">
	 		and rc.carLicenseNumber like '%${condition.carLicenseNumber}%'
	 	</if>
	 	<if test="condition.insured != null and condition.insured !=''">
	 		and rc.insured = #{condition.insured}
	 	</if>
	 	<if test="condition.contact != null and condition.contact !=''">
	 		and rc.contact = #{condition.contact}
	 	</if>
	 	<if test="condition.contactWay != null and condition.contactWay !=''">
	 		and (rc.contactWay like '%${condition.contactWay}%'
	 		        or rc.contactWayReserve like '%${condition.contactWay}%'
	 		    )
	 	</if>
	 	<if test="condition.insuranceCompLY != null and condition.insuranceCompLY !=''">
	 		and rc.insuranceCompLY = #{condition.insuranceCompLY}
	 	</if>
	 	<!-- 投保类型可以多选 -->
	 	<if test="condition.renewalTypes != null and condition.renewalTypes.size() > 0">
  			and rc.renewalType in
  			<foreach collection="condition.renewalTypes" item="renewalType" open="(" separator="," close=")">
  				#{renewalType}
  			</foreach> 
  		</if>
	 	<if test="condition.customerLevel != null and condition.customerLevel.size() > 0">
  			and rc.customerLevel in 
  			<foreach collection="condition.customerLevel" item="level" open="(" separator="," close=")">
  				#{level}
  			</foreach>
  		</if>
	 	<if test="condition.comeStoreNumber != null and condition.comeStoreNumber !=''">
	 		and rc.comeStoreNumber = #{condition.comeStoreNumber}
	 	</if>
	 		<if test="condition.principalId != null and condition.principalId !=''">
	 		and rc.principalId = #{condition.principalId}
	 	</if>
	 	<if test="condition.insurNumber != null and condition.insurNumber !=''">
	 		and rc.insurNumber = #{condition.insurNumber}
	 	</if>
	 	<if test="insurDateLYStart != null and insurDateLYStart !=''">
	 		<![CDATA[and  rc.insurDateLY  >=  #{insurDateLYStart,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="insurDateLYEnd != null and insurDateLYEnd !=''">
	 		<![CDATA[and  rc.insurDateLY  <=  #{insurDateLYEnd,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="insuranceEndDateStart != null and insuranceEndDateStart !=''">
	 		<![CDATA[and  DATE_FORMAT(rc.insuranceEndDate,'%m-%d')  >=  #{insuranceEndDateStart,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="insuranceEndDateEnd != null and insuranceEndDateEnd !=''">
	 		<![CDATA[and  DATE_FORMAT(rc.insuranceEndDate,'%m-%d')  <=  #{insuranceEndDateEnd,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="syxrqDateStart != null and syxrqDateStart !=''">
	 		<![CDATA[and  DATE_FORMAT(rc.syxrqEnd,'%m-%d') >=  #{syxrqDateStart,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="syxrqDateEnd != null and syxrqDateEnd !=''">
	 		<![CDATA[and  DATE_FORMAT(rc.syxrqEnd,'%m-%d') <=  #{syxrqDateEnd,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="condition.isInvite != null">
	 		and IFNULL(rc.isInvite,0) = #{condition.isInvite}
	 	</if>
	 	<if test="inviteDateStart != null and inviteDateStart !=''">
	 		<![CDATA[and  rc.inviteDate  >=  #{inviteDateStart,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="inviteDateEnd != null and inviteDateEnd !=''">
	 		<![CDATA[and  rc.inviteDate  <=  #{inviteDateEnd,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="condition.isComeStore != null ">
	 		and rc.isComeStore = #{condition.isComeStore}
	 	</if>
	 	<if test="comeStoreDateStart != null and comeStoreDateStart !=''">
	 		<![CDATA[and  rc.comeStoreDate  >=  #{comeStoreDateStart,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="comeStoreDateEnd != null and comeStoreDateEnd !=''">
	 		<![CDATA[and  rc.comeStoreDate  <=  #{comeStoreDateEnd,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="lastTraceDateStart != null and lastTraceDateStart !=''">
	 		<![CDATA[and  DATE_FORMAT(rc.lastTraceDate,'%Y-%m-%d')  >=  #{lastTraceDateStart,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="lastTraceDateEnd != null and lastTraceDateEnd !=''">
	 		<![CDATA[and  DATE_FORMAT(rc.lastTraceDate,'%Y-%m-%d')  <=  #{lastTraceDateEnd,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="condition.isQuote != null">
	 		and rc.isQuote = #{condition.isQuote}
	 	</if>
	 	<if test="quoteDateStart != null and quoteDateStart !=''">
	 		<![CDATA[and  rc.quoteDate  >=  #{quoteDateStart,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="quoteDateEnd != null and quoteDateEnd !=''">
	 		<![CDATA[and  rc.quoteDate  <=  #{quoteDateEnd,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="traceDateStart != null and traceDateStart !=''">
	 		<![CDATA[and  rc.willingTraceDate  >=  #{traceDateStart,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="traceDateEnd != null and traceDateEnd !=''">
	 		<![CDATA[and  rc.willingTraceDate  <=  #{traceDateEnd,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="remainLostInsurDayStart != null and remainLostInsurDayStart !=''">
	 		<![CDATA[and  rc.virtualJqxdqr  >=  #{remainLostInsurDayStart,jdbcType=DATE}]]>
	 	</if>
	 	<if test="remainLostInsurDayEnd != null and remainLostInsurDayEnd !=''">
	 		<![CDATA[and  rc.virtualJqxdqr  <=  #{remainLostInsurDayEnd,jdbcType=DATE}]]>
	 	</if>
	 	<if test="remainLostInsurDayEnd != null and remainLostInsurDayEnd !='' and remainLostInsurDayStart != null and remainLostInsurDayStart !=''">
	 		and  rc.customerLevel not in('F','S','O') and rc.status=2
	 	</if>
	 	<!-- 添加车主,持有人查询条件 -->
	 	<if test="condition.carOwner != null and condition.carOwner !=''">
	 		and rc.carOwner like '%${condition.carOwner}%'
	 	</if>
	 	<if test="condition.holder != null and condition.holder !=''">
	 		and u.userName = #{condition.holder}
	 	</if>
	 	<if test="condition.sfgyx != null">
	 		and rc.sfgyx = #{condition.sfgyx}
	 	</if>
	 	<if test="condition.ifLoan != null">
	 		and rc.ifLoan = #{condition.ifLoan}
	 	</if>
	 	<if test="registrationDateStart != null and registrationDateStart !=''">
	 		<![CDATA[and  rc.registrationDate >=  #{registrationDateStart,jdbcType=DATE}]]>
	 	</if>
	 	<if test="registrationDateEnd != null and registrationDateEnd !=''">
	 		<![CDATA[and  rc.registrationDate <=  #{registrationDateEnd,jdbcType=DATE}]]>
	 	</if>
	 </where>
  </select>
  
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    delete from bf_bip_renewaling_customer
    where customerId = #{customerId,jdbcType=INTEGER}
  </delete>
 
  <update id="updateSelectiveByCustomerId" parameterType="java.util.Map" >
    update bf_bip_renewaling_customer
    <set >
      <if test="carOwner != null" >carOwner = #{carOwner},</if>
      <if test="insured != null" >insured = #{insured},</if>
      <if test="contact != null" >contact = #{contact},</if>
      <if test="contactWay != null" >contactWay = #{contactWay},</if>
      <if test="address != null" >address = #{address,jdbcType=VARCHAR},</if>
      <if test="chassisNumber != null" >chassisNumber = #{chassisNumber},</if>
      <if test="engineNumber != null" >engineNumber = #{engineNumber},</if>
      <if test="insuranceCompLY != null" >insuranceCompLY = #{insuranceCompLY},</if>
      <if test="insuranceEndDate != null" >insuranceEndDate = #{insuranceEndDate},</if>
      <if test="zdZheKou != null" >zdZheKou = #{zdZheKou},</if>
      <if test="carBrand != null" >carBrand = #{carBrand},</if>
      <if test="vehicleModel != null" >vehicleModel = #{vehicleModel},</if>
      <if test="carLicenseNumber != null" >carLicenseNumber = #{carLicenseNumber},</if>
      <if test="registrationDate != null" >registrationDate = #{registrationDate},</if>
      <if test="renewalType != null" >renewalType = #{renewalType},</if>
      <if test="solicitMemberLY != null" >solicitMemberLY = #{solicitMemberLY},</if>
      <if test="insuranceTypeLY != null" >insuranceTypeLY = #{insuranceTypeLY},</if>
      <if test="renewalWay != null" >renewalWay = #{renewalWay},</if>
      <if test="insurNumber != null" >insurNumber = #{insurNumber},</if>
      <if test="insurDateLY != null" >insurDateLY = #{insurDateLY},</if>
      <if test="insuranceCoverageLY != null" >insuranceCoverageLY = #{insuranceCoverageLY},</if>
      <if test="isMaintainAgain != null" >isMaintainAgain = #{isMaintainAgain},</if>
      <if test="maintainNumberLY != null" >maintainNumberLY = #{maintainNumberLY},</if>
      <if test="accidentNumberLY != null" >accidentNumberLY = #{accidentNumberLY},</if>
      <if test="accidentOutputValueLY != null" >accidentOutputValueLY = #{accidentOutputValueLY},</if>
      <if test="serviceConsultant != null" >serviceConsultant = #{serviceConsultant},</if>
      <if test="syxrqEnd != null" >syxrqEnd = #{syxrqEnd},</if>
      <if test="privilegeProLY != null" >privilegeProLY = #{privilegeProLY},</if>
      <if test="certificateNumber != null" >certificateNumber = #{certificateNumber},</if>
      <if test="isMaintainAgain != null" >isMaintainAgain = #{isMaintainAgain},</if>
      <if test="serviceConsultantId != null" >serviceConsultantId = #{serviceConsultantId},</if>
      <if test="customerSource != null" >customerSource = #{customerSource},</if>
      <if test="customerCharacter != null" >customerCharacter = #{customerCharacter},</if>
      <if test="sfgyx != null" >sfgyx = #{sfgyx},</if>
      <if test="customerDescription != null" >customerDescription = #{customerDescription},</if>
      <if test="insuranceNumber != null" >insuranceNumber = #{insuranceNumber},</if>
      <if test="virtualJqxdqr != null" >virtualJqxdqr = #{virtualJqxdqr},</if>
      <if test="lastYearIsDeal != null" >lastYearIsDeal = #{lastYearIsDeal},</if>
      <if test="isQuote != null" >isQuote = #{isQuote},</if>
      <if test="customerLevel != null" >customerLevel = #{customerLevel},</if>
      <if test="isComeStore != null" >isComeStore = #{isComeStore},</if>
      <if test="cusLostInsurStatu != null" >cusLostInsurStatu = #{cusLostInsurStatu},</if>
      <if test="firstAcceptDate != null" >firstAcceptDate = #{firstAcceptDate},</if>
      <if test="lastTraceResult != null" >lastTraceResult = #{lastTraceResult},</if>
      <if test="willingTraceDate != null" >willingTraceDate = #{willingTraceDate},</if>
      <if test="comeStoreNumber != null" >comeStoreNumber = #{comeStoreNumber},</if>
      <if test="quoteDate != null" >quoteDate = #{quoteDate},</if>
      <if test="remark != null" >remark = #{remark},</if>
      <if test="isInvite != null" >isInvite = #{isInvite},</if>
      <if test="comeStoreDate != null" >comeStoreDate = #{comeStoreDate},</if>
      <if test="lastTraceDate != null" >lastTraceDate = #{lastTraceDate},</if>
      <if test="fourSStoreId != null" >fourSStoreId = #{fourSStoreId},</if>
      <if test="fourSStore != null" >fourSStore = #{fourSStore},</if>
      <if test="principalId != null" >principalId = #{principalId},</if>
      <if test="principal != null" >principal = #{principal},</if>
      <if test="clerkId != null" >clerkId = #{clerkId},</if>
      <if test="clerk != null" >clerk = #{clerk},</if>
      <if test="inviteDate != null" >inviteDate = #{inviteDate},</if>
      <if test="bhInsuranceEndDate != null">bhInsuranceEndDate = #{bhInsuranceEndDate},</if>
      <if test="ifUpdate != null">ifUpdate = #{ifUpdate},</if>
      <if test="factoryLicenseType != null">factoryLicenseType = #{factoryLicenseType},</if>
	  <if test="carAnnualCheckUpDate != null">carAnnualCheckUpDate = #{carAnnualCheckUpDate},</if>
	  <if test="insuredLY != null">insuredLY = #{insuredLY},</if>
	  <if test="buyfromThisStore != null">buyfromThisStore = #{buyfromThisStore},</if>
	  <if test="gotThroughNum != null">gotThroughNum = #{gotThroughNum},</if>
	  <if test="contactWayReserve != null">contactWayReserve = #{contactWayReserve},</if>
	  <if test="bhUpdateTime != null">bhUpdateTime = now(),</if> 
    </set>
    where customerId = #{customerId}
  </update>
  <!-- 通过车架号查询潜客信息 -->
  <select id="selectBychaNum" resultMap="BaseResultMap">
    select 
    *
    from bf_bip_renewaling_customer
    where chassisNumber = #{chassisNumber,jdbcType=VARCHAR}
    and fourSStoreId = #{storeId,jdbcType=INTEGER}
  </select>
  
  <!-- 通过邀约日期查询邀约潜客信息-->
    <select id="findInvitedCust" resultMap="BaseResultMap" parameterType="java.util.HashMap">
  	 select
  	 rc.*,ca.*,ct.*,u.username holder ,u.id holderId,u.roleId holderRoleId
  	 from 
  	 bf_bip_renewaling_customer rc
  	 left join bf_bip_cover_type ct on ct.coverType = rc.renewalType 
	 left join bf_bip_customer_assign ca on  rc.customerId = ca.customerId
     left join bf_bip_user u on ca.userId = u.id
  	 <where>
  		and rc.fourSStoreId = #{storeId,jdbcType=INTEGER}
  		and ca.traceStatu != 3
  		and ca.inviteStatu = 2
		and u.roleId = 2
  		<if test="startTime != null and startTime != ''">
  			<![CDATA[and rc.inviteDate >= #{startTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="endTime != null and endTime != ''">
  			<![CDATA[and rc.inviteDate <= #{endTime,jdbcType=DATE}]]>
  		</if>
  		<!-- 添加查询条件过滤 -->
  		<if test="renewalType != null and renewalType != ''">
  			and rc.renewalType = #{renewalType}
  		</if>
  		<if test="holder != null and holder != ''">
  			and u.userName = #{holder}
  		</if>
  		<if test="chassisNumber != null and chassisNumber != ''">
  			and rc.chassisNumber like '%${chassisNumber}%'
  		</if>
  		<if test="contact != null and contact != ''">
  			and rc.contact = #{contact}
  		</if>
  		<if test="contactWay != null and contactWay != ''">
  			and (rc.contactWay like '%${contactWay}%'
	 		        or rc.contactWayReserve like '%${contactWay}%'
	 		    )
  		</if>
  		<if test="carLicenseNumber != null and carLicenseNumber != ''">
  			and rc.carLicenseNumber like '%${carLicenseNumber}%'
  		</if>
  	 </where>
  	 ORDER BY rc.id LIMIT #{start,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}
  </select>
  <!-- 统计上个查询的总数 -->
    <select id="countFindInvitedCust" resultType="java.lang.Integer" parameterType="java.util.HashMap">
  	 select
  	 count(*)
  	 from 
  	 bf_bip_renewaling_customer rc
  	 left join bf_bip_cover_type ct on ct.coverType = rc.renewalType 
	 left join bf_bip_customer_assign ca on  rc.customerId = ca.customerId
     left join bf_bip_user u on ca.userId = u.id
  	 <where>
  		and rc.fourSStoreId = #{storeId,jdbcType=INTEGER}
  		and ca.traceStatu != 3
  		and ca.inviteStatu = 2
		and u.roleId = 2
  		<if test="startTime != null and startTime != ''">
  			<![CDATA[and rc.inviteDate >= #{startTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="endTime != null and endTime != ''">
  			<![CDATA[and rc.inviteDate <= #{endTime,jdbcType=DATE}]]>
  		</if>
  		<!-- 添加查询条件过滤 -->
  		<if test="renewalType != null and renewalType != ''">
  			and rc.renewalType = #{renewalType}
  		</if>
  		<if test="holder != null and holder != ''">
  			and u.userName = #{holder}
  		</if>
  		<if test="chassisNumber != null and chassisNumber != ''">
  			and rc.chassisNumber like '%${chassisNumber}%'
  		</if>
  		<if test="contact != null and contact != ''">
  			and rc.contact = #{contact}
  		</if>
  		<if test="contactWay != null and contactWay != ''">
  			and (rc.contactWay like '%${contactWay}%'
	 		        or rc.contactWayReserve like '%${contactWay}%'
	 		    )
  		</if>
  		<if test="carLicenseNumber != null and carLicenseNumber != ''">
  			and rc.carLicenseNumber like '%${carLicenseNumber}%'
  		</if>
  	 </where>
  </select>
  <!-- 统计"根据邀约日期查询邀约客户跟踪记录"数量 -->
    <select id="countFindInvitedCustGzjl" resultType="java.lang.Integer" parameterType="java.util.HashMap">
  	 select  
   	count(1)
  	from bf_bip_customer_trace_recode
    	where customerId in(
  	 select
  	 rc.customerId
  	 from 
  	 bf_bip_renewaling_customer rc
  	 left join bf_bip_cover_type ct on ct.coverType = rc.renewalType 
	 left join bf_bip_customer_assign ca on  rc.customerId = ca.customerId
     left join bf_bip_user u on ca.userId = u.id
  	 <where>
  		and rc.fourSStoreId = #{storeId,jdbcType=INTEGER}
  		and ca.traceStatu != 3
  		and ca.inviteStatu = 2
		and u.roleId = 2
  		<if test="startTime != null and startTime != ''">
  			<![CDATA[and rc.inviteDate >= #{startTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="endTime != null and endTime != ''">
  			<![CDATA[and rc.inviteDate <= #{endTime,jdbcType=DATE}]]>
  		</if>
  		<!-- 添加查询条件过滤 -->
  		<if test="renewalType != null and renewalType != ''">
  			and rc.renewalType = #{renewalType}
  		</if>
  		<if test="holder != null and holder != ''">
  			and u.userName = #{holder}
  		</if>
  		<if test="chassisNumber != null and chassisNumber != ''">
  			and rc.chassisNumber like '%${chassisNumber}%'
  		</if>
  		<if test="contact != null and contact != ''">
  			and rc.contact = #{contact}
  		</if>
  		<if test="contactWay != null and contactWay != ''">
  			and (rc.contactWay like '%${contactWay}%'
	 		        or rc.contactWayReserve like '%${contactWay}%'
	 		    )
  		</if>
  		<if test="carLicenseNumber != null and carLicenseNumber != ''">
  			and rc.carLicenseNumber like '%${carLicenseNumber}%'
  		</if>
  	 </where>)
  </select>
  
  <!-- 根据潜客id查询潜客信息  -->
  <select id="findCustomerInfoByCustomerId" resultMap="BaseResultMap">
   select  
   	a.customerId,
   	a.fourSStoreId,
   	a.fourSStore,
   	a.carLicenseNumber,
    a.chassisNumber,
    a.engineNumber,
    a.registrationDate,
   	a.carBrand,
   	a.status,
   	a.vehicleModel,
   	a.syxrqEnd,
   	a.insuranceEndDate,
   	a.zdZheKou,
	a.renewalType,	
   	a.renewalWay,
   	a.principalId,
    a.principal,
   	a.solicitMemberLY,
   	a.insurNumber,
   	a.insurDateLY,
   	a.insuranceCompLY,
   	a.insuranceCoverageLY,
   	a.privilegeProLY,
   	a.insuranceTypeLY,
   	a.remark,
   	a.carOwner,
   	a.insured,
   	a.certificateNumber,
   	a.customerLevel,
    a.contact,
    a.contactWay,
    a.address,
    a.isMaintainAgain,
    a.maintainNumberLY,
    a.accidentNumberLY,
    a.accidentOutputValueLY,
    a.serviceConsultantId,
    a.serviceConsultant,
    a.customerSource,
    a.customerCharacter,
    a.sfgyx,
    a.customerDescription,
    a.bhInsuranceEndDate,
    a.ifUpdate,
    a.ifLoan,
    a.factoryLicenseType,
    a.carAnnualCheckUpDate,
    a.insuredLY,
    a.buyfromThisStore,
    a.gotThroughNum,
    a.contactWayReserve,
    a.nicheng,
    b.clerkId,
    b.clerk,
    b.willingTraceDate,
    b.lastTraceDate,
    b.lastTraceResult,
    b.isComeStore,
    b.comeStoreNumber,
	b.firstAcceptDate,
	b.cusLostInsurStatu,
	b.virtualJqxdqr,
	b.isQuote,
	b.isInvite,
	b.lastYearIsDeal,
	u.id holderId,u.roleId holderRoleId, ca.*
	from bf_bip_customer a LEFT JOIN bf_bip_renewaling_customer b on (a.customerId = b.customerId)
	left join bf_bip_customer_assign ca on ca.customerId = a.customerId and ifnull(ca.traceStatu,0) != 3
	left join bf_bip_user u on u.id = ca.userId and u.deleted =0
    	where a.customerId = #{customerId,jdbcType=INTEGER} LIMIT 1
  </select>
   <select id="findAllCsutomerByStoreId" resultMap="BaseResultMap">
  	select  a.customerId,
    a.principal,
    a.clerk,
    a.insured,
    a.contact,
    a.contactWay,
    a.status,
    a.insuranceCompLY,
    a.chassisNumber,
    a.engineNumber,
    a.vehicleModel,
    a.insuranceEndDate,
    a.customerLevel,
    b.willingTraceDate,
    b.lastTraceDate,
    b.lastTraceResult,
    b.isComeStore,
    b.comeStoreNumber,
	b.firstAcceptDate,
	a.virtualJqxdqr,
	a.renewalType
	from bf_bip_customer a LEFT JOIN bf_bip_renewaling_customer b on (a.customerId = b.customerId)
    where
    a.fourSStoreId = #{storeId,jdbcType=INTEGER}
  
  </select>
  
  <!-- 根据多条件查询潜客信息 -->
  <select id="findCustomerByCondition"  resultMap="BaseResultMap" parameterType="java.util.HashMap">
  	select  a.*,
    b.willingTraceDate,
    b.lastTraceDate,
    b.lastTraceResult,
    b.isComeStore,
    b.comeStoreNumber,
	b.firstAcceptDate,
	b.isInvite,
	b.isQuote,
	ct.coverTypeName,
	ca.traceStatu,
	ca.inviteStatu,
	ca.acceptStatu,
	ca.acceptDate,
	ca.returnStatu,
	ca.delayDate,
	ca.userId,
	ca.assignDate,
	u.userName holder,
	u.id holderId,
	u.roleId holderRoleId
	from bf_bip_customer a LEFT JOIN bf_bip_renewaling_customer b on (a.customerId = b.customerId)
	left join bf_bip_cover_type ct on ct.coverType = a.renewalType 
	left join  bf_bip_customer_assign ca on (a.customerId = ca.customerId) and ifnull(ca.traceStatu,0) != 3
	left JOIN bf_bip_user u ON ca.userId = u.id 
    <where>
    	<if test="fourSStoreId != null and fourSStoreId != ''">
  			and a.fourSStoreId = #{fourSStoreId,jdbcType=INTEGER}
  		</if>
  		<if test="carBrand != null and carBrand != ''">
  			and a.carBrand = #{carBrand,jdbcType=VARCHAR}
  		</if>
  		<if test="vehicleModel != null and vehicleModel != ''">
  			and a.vehicleModel = #{vehicleModel,jdbcType=VARCHAR}
  		</if>
  		<if test="chassisNumber != null and chassisNumber != ''">
  			and a.chassisNumber like '%${chassisNumber}%'
  		</if>
  		<if test="carLicenseNumber != null and carLicenseNumber != ''">
  			and a.carLicenseNumber like '%${carLicenseNumber}%'
  		</if>
  		<if test="insured != null and insured != ''">
  			and a.insured = #{insured,jdbcType=VARCHAR}
  		</if>
  		<if test="contact != null and contact != ''">
  			and a.contact = #{contact,jdbcType=VARCHAR}
  		</if>
  		<if test="contactWay != null and contactWay != ''">
  			and (a.contactWay like '%${contactWay}%'
	 		        or a.contactWayReserve like '%${contactWay}%'
	 		    )
  		</if>
  		<!-- 投保类型可以多选 -->
	 	<if test="renewalTypes != null and renewalTypes.size() > 0">
  			and a.renewalType in
  			<foreach collection="renewalTypes" item="renewalType" open="(" separator="," close=")">
  				#{renewalType}
  			</foreach> 
  		</if>
  		<if test="insuranceCompLY != null and insuranceCompLY != ''">
  			and a.insuranceCompLY = #{insuranceCompLY,jdbcType=VARCHAR}
  		</if>
  		<if test="renewalWay != null and renewalWay != ''">
  			and a.renewalWay = #{renewalWay,jdbcType=VARCHAR}
  		</if>
  		<if test="customerLevel != null and customerLevel.size() > 0">
  			and a.customerLevel in 
  			<foreach collection="customerLevel" item="level" open="(" separator="," close=")">
  				#{level}
  			</foreach>
  		</if>
  		<if test="comeStoreNumber != null and comeStoreNumber != '' ">
  			and b.comeStoreNumber = #{comeStoreNumber,jdbcType=INTEGER}
  		</if> 
  		<if test="principalId != null and principalId != ''">
  			and b.principalId = #{principalId,jdbcType=INTEGER}
  		</if>
  		<if test="insurNumber != null and insurNumber != ''">
  			and b.insurNumber = #{insurNumber,jdbcType=INTEGER}
  		</if> 
  		<if test="insuDateStartTime != null and insuDateStartTime != ''">
  			<![CDATA[and a.insurDateLY >= #{insuDateStartTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="insuDateEndTime != null and insuDateEndTime != ''">
  			<![CDATA[and a.insurDateLY <= #{insuDateEndTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="insuEndStartTime != null and insuEndStartTime != ''">
  			<![CDATA[and DATE_FORMAT(a.insuranceEndDate,'%m-%d') >= #{insuEndStartTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="insuEndEndTime != null and insuEndEndTime != ''">
  			<![CDATA[and DATE_FORMAT(a.insuranceEndDate,'%m-%d') <= #{insuEndEndTime,jdbcType=DATE}]]>
  		</if> 
  		 <if test="isInvite != null">
  			and IFNULL(b.isInvite,0) = #{isInvite,jdbcType=INTEGER}
  		</if>  
  		<if test="syxrqDateStart != null and syxrqDateStart !=''">
	 		<![CDATA[and  DATE_FORMAT(a.syxrqEnd,'%m-%d') >=  #{syxrqDateStart,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="syxrqDateEnd != null and syxrqDateEnd !=''">
	 		<![CDATA[and  DATE_FORMAT(a.syxrqEnd,'%m-%d') <=  #{syxrqDateEnd,jdbcType=DATE} ]]>
	 	</if>
  		<if test="inviteStartTime != null and inviteStartTime != ''">
  			<![CDATA[and b.inviteDate >= #{inviteStartTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="inviteEndTime != null and inviteEndTime != ''">
  			<![CDATA[and b.inviteDate <= #{inviteEndTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="isComeStore != null">
  			and b.isComeStore = #{isComeStore,jdbcType=INTEGER}
  		</if> 
  		<if test="isQuote != null">
  			and b.isQuote = #{isQuote,jdbcType=INTEGER}
  		</if>
		<if test="quoteStartTime != null and quoteStartTime !=''">
			<![CDATA[and  b.quoteDate  >=  #{quoteStartTime,jdbcType=DATE} ]]>
		</if>
		<if test="quoteEndTime != null and quoteEndTime !=''">
			<![CDATA[and  b.quoteDate  <=  #{quoteEndTime,jdbcType=DATE} ]]>
		</if>		
  		<if test="comeStoreStartTime != null and comeStoreStartTime != ''">
  			<![CDATA[and b.comeStoreDate >= #{comeStoreStartTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="comeStoreEndTime != null and comeStoreEndTime != ''">
  			<![CDATA[and b.comeStoreDate <= #{comeStoreEndTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="lastTraceStartTime != null and lastTraceStartTime != ''">
  			<![CDATA[and DATE_FORMAT(b.lastTraceDate,'%Y-%m-%d') >= #{lastTraceStartTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="lastTraceEndTime != null and lastTraceEndTime != ''">
  			<![CDATA[and DATE_FORMAT(b.lastTraceDate,'%Y-%m-%d') <= #{lastTraceEndTime,jdbcType=DATE}]]>
  		</if>
  		<if test="traceStartTime != null and traceStartTime != ''">
  			<![CDATA[and b.willingTraceDate >= #{traceStartTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="traceEndTime != null and traceEndTime != ''">
  			<![CDATA[and b.willingTraceDate <= #{traceEndTime,jdbcType=DATE}]]>
  		</if>
  		<if test="zdZheKouStart != null and zdZheKouStart !=''">
             <![CDATA[and  b.zdZheKou  >=  #{zdZheKouStart} ]]>
         </if>
         <if test="zdZheKouEnd != null and zdZheKouEnd !=''">
             <![CDATA[and  b.zdZheKou  <=  #{zdZheKouEnd} ]]>
         </if>
  		  
  		<!-- 添加车主,持有人查询条件 -->
	 	<if test="carOwner != null and carOwner !=''">
	 		and a.carOwner like '%${carOwner}%'
	 	</if>
	 	<if test="holder != null and holder !=''">
	 		and u.userName = #{holder}
	 	</if>
	 	<if test="roleId != null and roleId !=''">
	 		and u.roleId = #{roleId}
	 	</if>
	 	<if test="remainLostInsurDayStart != null and remainLostInsurDayStart !=''">
	 		<![CDATA[and  a.virtualJqxdqr  >=  #{remainLostInsurDayStart,jdbcType=DATE}]]>
	 	</if>
	 	<if test="remainLostInsurDayEnd != null and remainLostInsurDayEnd !=''">
	 		<![CDATA[and  a.virtualJqxdqr  <=  #{remainLostInsurDayEnd,jdbcType=DATE}]]>
	 	</if>
	 	<if test="remainLostInsurDayEnd != null and remainLostInsurDayEnd !='' and remainLostInsurDayStart != null and remainLostInsurDayStart !=''">
	 		and  a.customerLevel not in('F','S','O') and a.status=2
	 	</if>
	 	<if test="sfgyx != null">
	 		and a.sfgyx = #{sfgyx}
	 	</if>
	 	<if test="ifLoan != null">
	 		and a.ifLoan = #{ifLoan}
	 	</if>
	 	<if test="registrationDateStart != null and registrationDateStart !=''">
	 		<![CDATA[and  a.registrationDate >=  #{registrationDateStart,jdbcType=DATE}]]>
	 	</if>
	 	<if test="registrationDateEnd != null and registrationDateEnd !=''">
	 		<![CDATA[and  a.registrationDate <=  #{registrationDateEnd,jdbcType=DATE}]]>
	 	</if>
	 	<if test="defeatFlag != null and defeatFlag != ''">
  			and a.defeatFlag = #{defeatFlag,jdbcType=INTEGER}
  		</if>
  		<if test="createrId != null and createrId != ''">
  			and a.createrId = #{createrId}
  		</if>
  		<if test="createTimeStart != null and createTimeStart != ''">
			<![CDATA[and date_format(a.createTime,'%Y-%m-%d') >= #{createTimeStart}]]>
		</if> 
		<if test="createTimeEnd != null and createTimeEnd != ''">
			<![CDATA[and date_format(a.createTime,'%Y-%m-%d') <= #{createTimeEnd}]]>
		</if> 
  	 </where>
  	    <!-- ORDER BY b.willingTraceDate desc, a.customerId desc -->
  	    <!-- short代表按某字段排序，shortmain 1：升序，2：降序 -->
  	    <if test="short==null and shortmain==null">ORDER BY b.willingTraceDate DESC, a.customerId DESC</if>
  	    <if test="short==2 and shortmain==1">ORDER BY a.principal ASC</if>
  	    <if test="short==2 and shortmain==2">ORDER BY a.principal DESC</if>
  	    <if test="short==3 and shortmain==1">ORDER BY a.clerk ASC</if>
  	    <if test="short==3 and shortmain==2">ORDER BY a.clerk DESC</if>
  	    <if test="short==4 and shortmain==1">ORDER BY a.contact ASC</if>
  	    <if test="short==4 and shortmain==2">ORDER BY a.contact DESC</if>
  	    <if test="short==5 and shortmain==1">ORDER BY a.contactWay ASC</if>
  	    <if test="short==5 and shortmain==2">ORDER BY a.contactWay DESC</if>
  	    <if test="short==6 and shortmain==1">ORDER BY a.chassisNumber ASC</if>
  	    <if test="short==6 and shortmain==2">ORDER BY a.chassisNumber DESC</if>
  	    <if test="short==7 and shortmain==1">ORDER BY a.carLicenseNumber ASC</if>
  	    <if test="short==7 and shortmain==2">ORDER BY a.carLicenseNumber DESC</if>
  	    <if test="short==8 and shortmain==1">ORDER BY ct.coverTypeName ASC</if>
  	    <if test="short==8 and shortmain==2">ORDER BY ct.coverTypeName DESC</if>
  	    <if test="short==9 and shortmain==1">ORDER BY DATE_FORMAT(a.insuranceEndDate,'%m-%d') ASC</if>
  	    <if test="short==9 and shortmain==2">ORDER BY DATE_FORMAT(a.insuranceEndDate,'%m-%d') DESC</if>
  	    <if test="short==10 and shortmain==1">ORDER BY a.bhUpdateTime ASC</if>
  	    <if test="short==10 and shortmain==2">ORDER BY a.bhUpdateTime DESC</if>
  	    <if test="short==11 and shortmain==1"> ORDER BY b.customerLevel ASC</if>
  	    <if test="short==11 and shortmain==2"> ORDER BY b.customerLevel DESC</if>
  	    <if test="short==12 and shortmain==1">ORDER BY a.gotThroughNum ASC</if>
  	    <if test="short==12 and shortmain==2">ORDER BY a.gotThroughNum DESC</if>
  	    <if test="short==13 and shortmain==1">ORDER BY b.willingTraceDate ASC</if>
  	    <if test="short==13 and shortmain==2">ORDER BY b.willingTraceDate DESC</if>
  	    <if test="short==14 and shortmain==1">ORDER BY b.lastTraceDate ASC</if>
  	    <if test="short==14 and shortmain==2">ORDER BY b.lastTraceDate DESC</if>
  	    <if test="short==15 and shortmain==1">ORDER BY b.lastTraceResult ASC</if>
  	    <if test="short==15 and shortmain==2">ORDER BY b.lastTraceResult DESC</if>
  	    <if test="short==16 and shortmain==1">ORDER BY ca.delayDate ASC</if>
  	    <if test="short==16 and shortmain==2">ORDER BY ca.delayDate DESC</if>
  	    <if test="short==17 and shortmain==1">ORDER BY b.virtualJqxdqr ASC</if>
  	    <if test="short==17 and shortmain==2">ORDER BY b.virtualJqxdqr DESC</if>
  	    <if test="short==18 and shortmain==1">ORDER BY ca.assignDate ASC</if>
  	    <if test="short==18 and shortmain==2">ORDER BY ca.assignDate DESC</if>
  	    <if test="short==19 and shortmain==1">ORDER BY holder ASC</if>
  	    <if test="short==19 and shortmain==2">ORDER BY holder DESC</if>
  	    
  	 LIMIT #{start,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}
  </select>
  
    <!-- 统计上一条查询数量 -->
  <select id="countFindCustByCondition" resultType="java.lang.Integer" parameterType="java.util.HashMap">
  	select  
  		count(*)
	from bf_bip_customer a LEFT JOIN bf_bip_renewaling_customer b on (a.customerId = b.customerId)
	left join bf_bip_cover_type ct on ct.coverType = a.renewalType 
	left join  bf_bip_customer_assign ca on (a.customerId = ca.customerId) and ifnull(ca.traceStatu,0) != 3
	left JOIN bf_bip_user u ON ca.userId = u.id 
    <where>
    	<if test="fourSStoreId != null and fourSStoreId != ''">
  			and a.fourSStoreId = #{fourSStoreId,jdbcType=INTEGER}
  		</if>
  		<if test="carBrand != null and carBrand != ''">
  			and a.carBrand = #{carBrand,jdbcType=VARCHAR}
  		</if>
  		<if test="vehicleModel != null and vehicleModel != ''">
  			and a.vehicleModel = #{vehicleModel,jdbcType=VARCHAR}
  		</if>
  		<if test="chassisNumber != null and chassisNumber != ''">
  			and a.chassisNumber like '%${chassisNumber}%'
  		</if>
  		<if test="carLicenseNumber != null and carLicenseNumber != ''">
  			and a.carLicenseNumber like '%${carLicenseNumber}%'
  		</if>
  		<if test="insured != null and insured != ''">
  			and a.insured = #{insured,jdbcType=VARCHAR}
  		</if>
  		<if test="contact != null and contact != ''">
  			and a.contact = #{contact,jdbcType=VARCHAR}
  		</if>
  		<if test="contactWay != null and contactWay != ''">
  			and (a.contactWay like '%${contactWay}%'
	 		        or a.contactWayReserve like '%${contactWay}%'
	 		    )
  		</if>
  		<!-- 投保类型可以多选 -->
	 	<if test="renewalTypes != null and renewalTypes.size() > 0">
  			and a.renewalType in
  			<foreach collection="renewalTypes" item="renewalType" open="(" separator="," close=")">
  				#{renewalType}
  			</foreach> 
  		</if>
  		<if test="insuranceCompLY != null and insuranceCompLY != ''">
  			and a.insuranceCompLY = #{insuranceCompLY,jdbcType=VARCHAR}
  		</if>
  		<if test="renewalWay != null and renewalWay != ''">
  			and a.renewalWay = #{renewalWay,jdbcType=VARCHAR}
  		</if>
  		<if test="customerLevel != null and customerLevel.size() > 0">
  			and a.customerLevel in 
  			<foreach collection="customerLevel" item="level" open="(" separator="," close=")">
  				#{level}
  			</foreach>
  		</if>
  		<if test="comeStoreNumber != null and comeStoreNumber != '' ">
  			and b.comeStoreNumber = #{comeStoreNumber,jdbcType=INTEGER}
  		</if> 
  		<if test="principalId != null and principalId != ''">
  			and b.principalId = #{principalId,jdbcType=INTEGER}
  		</if>
  		<if test="insurNumber != null and insurNumber != ''">
  			and b.insurNumber = #{insurNumber,jdbcType=INTEGER}
  		</if> 
		<if test="quoteStartTime != null and quoteStartTime !=''">
			<![CDATA[and  b.quoteDate  >=  #{quoteStartTime,jdbcType=DATE} ]]>
		</if>
		<if test="quoteEndTime != null and quoteEndTime !=''">
			<![CDATA[and  b.quoteDate  <=  #{quoteEndTime,jdbcType=DATE} ]]>
		</if>
  		<if test="insuDateStartTime != null and insuDateStartTime != ''">
  			<![CDATA[and a.insurDateLY >= #{insuDateStartTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="insuDateEndTime != null and insuDateEndTime != ''">
  			<![CDATA[and a.insurDateLY <= #{insuDateEndTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="insuEndStartTime != null and insuEndStartTime != ''">
  			<![CDATA[and DATE_FORMAT(a.insuranceEndDate,'%m-%d') >= #{insuEndStartTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="insuEndEndTime != null and insuEndEndTime != ''">
  			<![CDATA[and DATE_FORMAT(a.insuranceEndDate,'%m-%d') <= #{insuEndEndTime,jdbcType=DATE}]]>
  		</if> 
  		 <if test="isInvite != null">
  			and IFNULL(b.isInvite,0) = #{isInvite,jdbcType=INTEGER}
  		</if>  
  		<if test="syxrqDateStart != null and syxrqDateStart !=''">
	 		<![CDATA[and  DATE_FORMAT(a.syxrqEnd,'%m-%d') >=  #{syxrqDateStart,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="syxrqDateEnd != null and syxrqDateEnd !=''">
	 		<![CDATA[and  DATE_FORMAT(a.syxrqEnd,'%m-%d') <=  #{syxrqDateEnd,jdbcType=DATE} ]]>
	 	</if>
  		<if test="inviteStartTime != null and inviteStartTime != ''">
  			<![CDATA[and b.inviteDate >= #{inviteStartTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="inviteEndTime != null and inviteEndTime != ''">
  			<![CDATA[and b.inviteDate <= #{inviteEndTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="isComeStore != null">
  			and b.isComeStore = #{isComeStore,jdbcType=INTEGER}
  		</if> 
  		<if test="isQuote != null">
  			and b.isQuote = #{isQuote,jdbcType=INTEGER}
  		</if> 
  		<if test="comeStoreStartTime != null and comeStoreStartTime != ''">
  			<![CDATA[and b.comeStoreDate >= #{comeStoreStartTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="comeStoreEndTime != null and comeStoreEndTime != ''">
  			<![CDATA[and b.comeStoreDate <= #{comeStoreEndTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="lastTraceStartTime != null and lastTraceStartTime != ''">
  			<![CDATA[and DATE_FORMAT(b.lastTraceDate,'%Y-%m-%d') >= #{lastTraceStartTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="lastTraceEndTime != null and lastTraceEndTime != ''">
  			<![CDATA[and DATE_FORMAT(b.lastTraceDate,'%Y-%m-%d') <= #{lastTraceEndTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="traceStartTime != null and traceStartTime != ''">
  			<![CDATA[and b.willingTraceDate >= #{traceStartTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="traceEndTime != null and traceEndTime != ''">
  			<![CDATA[and b.willingTraceDate <= #{traceEndTime,jdbcType=DATE}]]>
  		</if>  
  		<!-- 添加车主,持有人查询条件 -->
	 	<if test="carOwner != null and carOwner !=''">
	 		and a.carOwner like '%${carOwner}%'
	 	</if>
	 	<if test="holder != null and holder !=''">
	 		and u.userName = #{holder}
	 	</if>
	 	<if test="roleId != null and roleId !=''">
	 		and u.roleId = #{roleId}
	 	</if>
	 	<if test="remainLostInsurDayStart != null and remainLostInsurDayStart !=''">
	 		<![CDATA[and  a.virtualJqxdqr  >=  #{remainLostInsurDayStart,jdbcType=DATE}]]>
	 	</if>
	 	<if test="remainLostInsurDayEnd != null and remainLostInsurDayEnd !=''">
	 		<![CDATA[and  a.virtualJqxdqr  <=  #{remainLostInsurDayEnd,jdbcType=DATE}]]>
	 	</if>
	 	<if test="remainLostInsurDayEnd != null and remainLostInsurDayEnd !='' and remainLostInsurDayStart != null and remainLostInsurDayStart !=''">
	 		and  a.customerLevel not in('F','S','O') and a.status=2
	 	</if>
	 	<if test="sfgyx != null">
	 		and a.sfgyx = #{sfgyx}
	 	</if>
	 	<if test="ifLoan != null">
	 		and a.ifLoan = #{ifLoan}
	 	</if>
	 	<if test="registrationDateStart != null and registrationDateStart !=''">
	 		<![CDATA[and  a.registrationDate >=  #{registrationDateStart,jdbcType=DATE}]]>
	 	</if>
	 	<if test="registrationDateEnd != null and registrationDateEnd !=''">
	 		<![CDATA[and  a.registrationDate <=  #{registrationDateEnd,jdbcType=DATE}]]>
	 	</if>
	 	<if test="defeatFlag != null and defeatFlag != ''">
  			and a.defeatFlag = #{defeatFlag,jdbcType=INTEGER}
  		</if>
  		<if test="createrId != null and createrId != ''">
  			and a.createrId = #{createrId}
  		</if>
  		<if test="createTimeStart != null and createTimeStart != ''">
			<![CDATA[and date_format(a.createTime,'%Y-%m-%d') >= #{createTimeStart}]]>
		</if> 
		<if test="createTimeEnd != null and createTimeEnd != ''">
			<![CDATA[and date_format(a.createTime,'%Y-%m-%d') <= #{createTimeEnd}]]>
		</if> 
  	 </where>
  </select>
  <!-- 统计"根据多条件查询潜客信息跟踪记录"总数-->
  <select id="countFindCustByConditionGzjl" resultType="java.lang.Integer" parameterType="java.util.HashMap">
  select  
   	count(1)
  from bf_bip_customer_trace_recode
    	where customerId in(
  	select  
  		a.customerId
	from bf_bip_customer a LEFT JOIN bf_bip_renewaling_customer b on (a.customerId = b.customerId)
	left join bf_bip_cover_type ct on ct.coverType = a.renewalType 
	left join  bf_bip_customer_assign ca on (a.customerId = ca.customerId) and ca.traceStatu != 3
	left JOIN bf_bip_user u ON ca.userId = u.id 
    <where>
    	<if test="fourSStoreId != null and fourSStoreId != ''">
  			and a.fourSStoreId = #{fourSStoreId,jdbcType=INTEGER}
  		</if>
  		<if test="carBrand != null and carBrand != ''">
  			and a.carBrand = #{carBrand,jdbcType=VARCHAR}
  		</if>
  		<if test="vehicleModel != null and vehicleModel != ''">
  			and a.vehicleModel = #{vehicleModel,jdbcType=VARCHAR}
  		</if>
  		<if test="chassisNumber != null and chassisNumber != ''">
  			and a.chassisNumber like '%${chassisNumber}%'
  		</if>
  		<if test="carLicenseNumber != null and carLicenseNumber != ''">
  			and a.carLicenseNumber like '%${carLicenseNumber}%'
  		</if>
  		<if test="insured != null and insured != ''">
  			and a.insured = #{insured,jdbcType=VARCHAR}
  		</if>
  		<if test="contact != null and contact != ''">
  			and a.contact = #{contact,jdbcType=VARCHAR}
  		</if>
  		<if test="contactWay != null and contactWay != ''">
  			and (a.contactWay like '%${contactWay}%'
	 		        or a.contactWayReserve like '%${contactWay}%'
	 		    )
  		</if>
  		<!-- 投保类型可以多选 -->
	 	<if test="renewalTypes != null and renewalTypes.size() > 0">
  			and a.renewalType in
  			<foreach collection="renewalTypes" item="renewalType" open="(" separator="," close=")">
  				#{renewalType}
  			</foreach> 
  		</if>
  		<if test="insuranceCompLY != null and insuranceCompLY != ''">
  			and a.insuranceCompLY = #{insuranceCompLY,jdbcType=VARCHAR}
  		</if>
  		<if test="renewalWay != null and renewalWay != ''">
  			and a.renewalWay = #{renewalWay,jdbcType=VARCHAR}
  		</if>
  		<if test="customerLevel != null and customerLevel.size() > 0">
  			and a.customerLevel in 
  			<foreach collection="customerLevel" item="level" open="(" separator="," close=")">
  				#{level}
  			</foreach>
  		</if>
  		<if test="comeStoreNumber != null and comeStoreNumber != '' ">
  			and b.comeStoreNumber = #{comeStoreNumber,jdbcType=INTEGER}
  		</if> 
  		<if test="principalId != null and principalId != ''">
  			and b.principalId = #{principalId,jdbcType=INTEGER}
  		</if>
  		<if test="insurNumber != null and insurNumber != ''">
  			and b.insurNumber = #{insurNumber,jdbcType=INTEGER}
  		</if> 
  		<if test="insuDateStartTime != null and insuDateStartTime != ''">
  			<![CDATA[and a.insurDateLY >= #{insuDateStartTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="insuDateEndTime != null and insuDateEndTime != ''">
  			<![CDATA[and a.insurDateLY <= #{insuDateEndTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="insuEndStartTime != null and insuEndStartTime != ''">
  			<![CDATA[and a.insuranceEndDate >= #{insuEndStartTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="insuEndEndTime != null and insuEndEndTime != ''">
  			<![CDATA[and a.insuranceEndDate <= #{insuEndEndTime,jdbcType=DATE}]]>
  		</if> 
  		 <if test="isInvite != null and isInvite != ''">
  			and b.isInvite = #{isInvite,jdbcType=INTEGER}
  		</if>  
  		<if test="inviteStartTime != null and inviteStartTime != ''">
  			<![CDATA[and b.inviteDate >= #{inviteStartTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="inviteEndTime != null and inviteEndTime != ''">
  			<![CDATA[and b.inviteDate <= #{inviteEndTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="isComeStore != null and isComeStore != ''">
  			and b.isComeStore = #{isComeStore,jdbcType=INTEGER}
  		</if> 
  		<if test="isQuote != null and isQuote != ''">
  			and b.isQuote = #{isQuote,jdbcType=INTEGER}
  		</if> 
  		<if test="comeStoreStartTime != null and comeStoreStartTime != ''">
  			<![CDATA[and b.comeStoreDate >= #{comeStoreStartTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="comeStoreEndTime != null and comeStoreEndTime != ''">
  			<![CDATA[and b.comeStoreDate <= #{comeStoreEndTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="lastTraceStartTime != null and lastTraceStartTime != ''">
  			<![CDATA[and DATE_FORMAT(b.lastTraceDate,'%Y-%m-%d') >= #{lastTraceStartTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="lastTraceEndTime != null and lastTraceEndTime != ''">
  			<![CDATA[and DATE_FORMAT(b.lastTraceDate,'%Y-%m-%d') <= #{lastTraceEndTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="traceStartTime != null and traceStartTime != ''">
  			<![CDATA[and b.willingTraceDate >= #{traceStartTime,jdbcType=DATE}]]>
  		</if> 
  		<if test="traceEndTime != null and traceEndTime != ''">
  			<![CDATA[and b.willingTraceDate <= #{traceEndTime,jdbcType=DATE}]]>
  		</if>  
  		<!-- 添加车主,持有人查询条件 -->
	 	<if test="carOwner != null and carOwner !=''">
	 		and a.carOwner like '%${carOwner}%'
	 	</if>
	 	<if test="holder != null and holder !=''">
	 		and u.userName = #{holder}
	 	</if>
	 	<if test="remainLostInsurDayStart != null and remainLostInsurDayStart !=''">
	 		<![CDATA[and  a.virtualJqxdqr  >=  #{remainLostInsurDayStart,jdbcType=DATE}]]>
	 	</if>
	 	<if test="remainLostInsurDayEnd != null and remainLostInsurDayEnd !=''">
	 		<![CDATA[and  a.virtualJqxdqr  <=  #{remainLostInsurDayEnd,jdbcType=DATE}]]>
	 	</if>
	 	<if test="remainLostInsurDayEnd != null and remainLostInsurDayEnd !='' and remainLostInsurDayStart != null and remainLostInsurDayStart !=''">
	 		and  a.customerLevel not in('F','S','O') and a.status=2
	 	</if>
	 	<if test="sfgyx != null">
	 		and a.sfgyx = #{sfgyx}
	 	</if>
	 	<if test="ifLoan != null">
	 		and a.ifLoan = #{ifLoan}
	 	</if>
	 	<if test="registrationDateStart != null and registrationDateStart !=''">
	 		<![CDATA[and  a.registrationDate >=  #{registrationDateStart,jdbcType=DATE}]]>
	 	</if>
	 	<if test="registrationDateEnd != null and registrationDateEnd !=''">
	 		<![CDATA[and  a.registrationDate <=  #{registrationDateEnd,jdbcType=DATE}]]>
	 	</if>
	 	<if test="defeatFlag != null and defeatFlag != ''">
  			and a.defeatFlag = #{defeatFlag,jdbcType=INTEGER}
  		</if>
  		<if test="createrId != null and createrId != ''">
  			and a.createrId = #{createrId}
  		</if>
  		<if test="createTimeStart != null and createTimeStart != ''">
			<![CDATA[and date_format(a.createTime,'%Y-%m-%d') >= #{createTimeStart}]]>
		</if> 
		<if test="createTimeEnd != null and createTimeEnd != ''">
			<![CDATA[and date_format(a.createTime,'%Y-%m-%d') <= #{createTimeEnd}]]>
		</if>
  	 </where>)
  </select>
  
  <select id="findFirstAcceptDate" resultType="java.lang.String" >
    select firstAcceptDate
    from bf_bip_renewaling_customer
    where customerId = #{customerId,jdbcType=INTEGER}
  </select>
  <update id="updateFirstAcceptDate" >
    update bf_bip_renewaling_customer
    set firstAcceptDate = CURDATE()
    where customerId = #{customerId,jdbcType=INTEGER}
  </update>
  <update id="updateWillingTraceDate" >
    update bf_bip_renewaling_customer
    set willingTraceDate = #{willingTraceDate,jdbcType=DATE}
    where customerId = #{customerId,jdbcType=INTEGER}
  </update>
  <!-- 更新当前负责人 -->
  <update id="updatePrincipal" >
    update bf_bip_renewaling_customer
    set principalId = #{principalId,jdbcType=INTEGER},principal = #{principal,jdbcType=VARCHAR}
    where customerId = #{customerId,jdbcType=INTEGER}
  </update>
  <!-- 更新当前业务员 -->
  <update id="updateClerk" >
    update bf_bip_renewaling_customer
    set clerkId = #{clerkId,jdbcType=INTEGER},clerk = #{clerk,jdbcType=VARCHAR}
    where customerId = #{customerId,jdbcType=INTEGER}
  </update>
  
  <!-- 批量删除已存在的潜客 -->
  <delete id="deleteExist" parameterType="java.util.ArrayList">
  	delete from bf_bip_renewaling_customer where customerId in 
  	<foreach collection="list" item="customer" open="(" separator="," close=")">
  		#{customer.customerId}
  	</foreach>
  </delete>
  
  <!-- 批量添加潜客  -->
  <insert id="insertUnAssignCustomer" parameterType="com.bofide.bip.po.Customer">

  	insert into bf_bip_renewaling_customer ( customerId, fourSStore, fourSStoreId, carOwner, insured, contact, contactWay, address, chassisNumber, engineNumber, 
    insuranceCompLY,  syxrqEnd,insuranceEndDate, carBrand, vehicleModel, carLicenseNumber, registrationDate, renewalType, 
    solicitMemberLY, insuranceTypeLY, renewalWay, insurNumber, insurDateLY, insuranceCoverageLY, isMaintainAgain, maintainNumberLY, 
    accidentNumberLY, accidentOutputValueLY, serviceConsultantId,serviceConsultant, customerLevel, remark, principal, principalId, privilegeProLY, 
    insuranceNumber, certificateNumber,  customerSource, customerCharacter, sfgyx, virtualJqxdqr,clerk,clerkId,lastYearIsDeal,cusLostInsurStatu,status,
    factoryLicenseType,carAnnualCheckUpDate,insuredLY,buyfromThisStore,gotThroughNum,contactWayReserve,ifLoan,createrId
   )
  	values 
   ( #{customerId},#{fourSStore}, #{fourSStoreId}, #{carOwner}, #{insured}, #{contact}, 
   	#{contactWay}, #{address}, #{chassisNumber}, #{engineNumber},#{insuranceCompLY}, 
   	#{syxrqEnd}, #{jqxrqEnd}, #{carBrand}, #{vehicleModel}, #{carLicenseNumber}, #{registrationDate},
   	#{renewalType}, #{solicitMemberLY}, #{insuranceTypeLY}, #{renewalWay}, #{insurNumber},
   	#{insurDateLY},#{insuranceCoverageLY}, #{isMaintainAgain}, #{maintainNumberLY}, 
   	#{accidentNumberLY}, #{accidentOutputValueLY},#{serviceConsultantId}, #{serviceConsultant},#{customerLevel}, 
   	#{remark},#{principal},#{principalId}, #{privilegeProLY},#{insuranceNumber}, #{certificateNumber},
   	#{customerSource},#{customerCharacter},#{sfgyx},#{virtualJqxdqr},#{clerk},#{clerkId},#{lastYearIsDeal},
   	#{cusLostInsurStatu},#{status}, #{factoryLicenseType},#{carAnnualCheckUpDate},#{insuredLY},#{buyfromThisStore},
   	#{gotThroughNum},#{contactWayReserve},#{ifLoan},#{createrId}
   )
  </insert>
  
  <!-- find刚才分配的潜客 -->
  <select id="findAssignCustomer" parameterType="java.util.ArrayList" resultMap="BaseResultMap">
  	select * from bf_bip_renewaling_customer where customerId in 
  	<foreach collection="list" item="customer" open="(" separator="," close=")">
  		#{customer.customerId}
  	</foreach>
  </select>
  <!-- 查询符合更新潜客脱保状态的潜客 -->
  <select id="findUpdateCustomerLostStatu" resultMap="BaseResultMap">
  	SELECT
	*
	FROM
		bf_bip_renewaling_customer rc,
		bf_bip_customer_assign ca
	<where>
		rc.customerId = ca.customerId 
		AND ifnull(rc.cusLostInsurStatu,0) != 2
		<if test="storeId != null and storeId !=''">
			AND rc.fourSStoreId = #{storeId}
		</if>
		<![CDATA[
			AND	DATE_ADD(CURDATE(), INTERVAL 7 DAY) >= rc.virtualJqxdqr
		]]>
	
	</where>
  </select>
  
  
  
  
  
  <!-- 根据符合在该时间段的所有成交的保单数 -->
  <select id="findAllDealInsurance" parameterType="java.util.HashMap" resultType="java.lang.Integer">	
	select count(1) from bf_bip_renewaling_customer rc, bf_bip_insurance_bill ib
		<where>
			rc.chassisNumber = ib.chassisNumber
			<if test="renewalType != null and renewalType != ''">
				 and rc.renewalType = #{renewalType}
			</if>
			<if test="userId != -1">
				and ib.principalId = #{userId}
			</if>	
			<if test="startTime != null and startTime != ''">
				<![CDATA[and rc.virtualJqxdqr >= #{startTime}]]>
			</if>	
			<if test="endTime != null and endTime != ''">
				<![CDATA[and rc.virtualJqxdqr <= #{endTime}]]>
			</if>			
		</where>  
  </select>
  
 
  
 
  <select id="findAllDealCustomer" parameterType="java.util.HashMap" resultType="java.lang.Integer">
  	select count(1) from (
		select b.customerId from bf_bip_renewaling_customer a , bf_bip_customer_assign b, bf_bip_insurance_bill c 
			<where>
				a.customerId = b.customerId and a.chassisNumber = c.chassisNumber
				<if test="userId != -1">
					and b.userId = #{userId}
				</if>
				<if test="renewalType != null and renewalType != ''">
					and a.renewalType=#{renewalType}
				</if>
				<if test="startTime != null and startTime != ''">
					<![CDATA[ and a.insuranceEndDate >= #{startTime} ]]>
				</if>
				<if test="endTime != null and endTime != ''">
					<![CDATA[ and a.insuranceEndDate <= #{endTime} ]]>
				</if>
			</where>   
			 group by b.customerId)t
  </select>
  
  <select id="findAllDealInsuranceNoTime" parameterType="java.util.HashMap" resultType="java.lang.Integer">
		select count(1) from bf_bip_insurance_bill
		<where>
			syxrqStart is not null 
			<if test="storeId != null ">
				and fourSStoreId = #{storeId}
			</if>
			<if test="renewalType != null and renewalType != ''">
				and coverType = #{renewalType}
			</if>	
			<if test="userId != null">
				and principalId = #{userId}
			</if>
			<if test="startTime != null and startTime != ''">
				<![CDATA[ and insurDate >= #{startTime} ]]>
			</if>
			<if test="endTime != null and endTime != ''">
				<![CDATA[ and insurDate <= #{endTime} ]]>
			</if>
			<if test="statisticTime != null">
					and DATE_FORMAT(insurDate,'%Y-%m') = #{statisticTime} 
			</if>
		</where>		
  </select>
  
  
  <!-- 修改本店投保次数 -->
  <update id="updateInsurNumber">
  	UPDATE bf_bip_renewaling_customer c
	SET c.insurNumber = #{insurNumber},
		c.renewalType = #{renewalType}
	WHERE
		c.fourSStoreId = #{storeId}
	AND c.chassisNumber = #{chassisNumber};
  </update>
  
  <!-- 更新虚拟保险到期日 -->
   <update id="updateVirtualJqxdqr" parameterType="java.util.HashMap" >
   	update bf_bip_renewaling_customer set virtualJqxdqr = #{newVirtualJqxdqr} where customerId = #{customerId}
   </update>
   
	<update id="updateRenewalingCustomerInfo" parameterType="java.util.Map">
		update bf_bip_renewaling_customer
		<set>
			<if test="comeStoreNumber != null">comeStoreNumber = #{comeStoreNumber},</if>
			<if test="customerDescription != null">customerDescription = #{customerDescription},</if>
			<if test="sfgyx != null">sfgyx = #{sfgyx},</if>
			<if test="customerCharacter != null">customerCharacter = #{customerCharacter},</if>
			<if test="customerSource != null">customerSource = #{customerSource},</if>
			<if test="certificateNumber != null">certificateNumber = #{certificateNumber},</if>
			<if test="privilegeProLY != null">privilegeProLY = #{privilegeProLY},</if>
			<if test="syxrqEnd != null">syxrqEnd = #{syxrqEnd},</if>
			<if test="carOwner != null">carOwner = #{carOwner},</if>
			<if test="insured != null">insured = #{insured},</if>
			<if test="contact != null">contact = #{contact},</if>
			<if test="contactWay != null">contactWay = #{contactWay},</if>
			<if test="address != null">address = #{address},</if>
			<if test="chassisNumber != null">chassisNumber = #{chassisNumber},</if>
			<if test="engineNumber != null">engineNumber = #{engineNumber},</if>
			<if test="insuranceCompLY != null">insuranceCompLY = #{insuranceCompLY},</if>
			<if test="jqxrqEnd != null">insuranceEndDate = #{jqxrqEnd},</if>
			<if test="zdZheKou != null" >zdZheKou = #{zdZheKou},</if>
			<if test="carBrand != null">carBrand = #{carBrand},</if>
			<if test="vehicleModel != null">vehicleModel = #{vehicleModel},</if>
			<if test="carLicenseNumber != null">carLicenseNumber = #{carLicenseNumber},</if>
			<if test="registrationDate != null">
				<if test="registrationDate.trim() != ''">registrationDate = #{registrationDate},</if>
				<if test="registrationDate.trim() == ''">registrationDate = null,</if>
			</if>
			<if test="renewalType != null">renewalType = #{renewalType},</if>
			<if test="solicitMemberLY != null">solicitMemberLY = #{solicitMemberLY},</if>
			<if test="insuranceTypeLY != null">insuranceTypeLY = #{insuranceTypeLY},</if>
			<if test="renewalWay != null">renewalWay = #{renewalWay},</if>
			<if test="insurNumber != null">insurNumber = #{insurNumber},</if>
			<if test="insurDateLY != null">
				<if test="insurDateLY.trim() != ''">insurDateLY = #{insurDateLY},</if>
				<if test="insurDateLY.trim() == ''">insurDateLY = null,</if>
			</if>
			<if test="insuranceCoverageLY != null">insuranceCoverageLY = #{insuranceCoverageLY},</if>
			<if test="isMaintainAgain != null">isMaintainAgain = #{isMaintainAgain},</if>
			<if test="maintainNumberLY != null">maintainNumberLY = #{maintainNumberLY},</if>
			<if test="accidentNumberLY != null">accidentNumberLY = #{accidentNumberLY},</if>
			<if test="accidentOutputValueLY != null">accidentOutputValueLY = #{accidentOutputValueLY},</if>
			<if test="serviceConsultantId != null">serviceConsultantId = #{serviceConsultantId},</if>
			<if test="serviceConsultant != null">serviceConsultant = #{serviceConsultant},</if>
			<if test="customerLevel != null">customerLevel = #{customerLevel},</if>
			<if test="remark != null">remark = #{remark},</if>
			<if test="isInvite != null">isInvite = #{isInvite},</if>
			<if test="inviteDate != null">inviteDate = #{inviteDate},</if>
			<if test="isComeStore != null">isComeStore = #{isComeStore},</if>
			<if test="comeStoreDate != null">comeStoreDate = #{comeStoreDate},</if>
			<if test="lastTraceDate != null">lastTraceDate = #{lastTraceDate},</if>
			<if test="fourSStoreId != null">fourSStoreId = #{fourSStoreId},</if>
			<if test="fourSStore != null">fourSStore = #{fourSStore},</if>
<!-- 			<if test="principalId != null">principalId = #{principalId},</if>
			<if test="principal != null">principal = #{principal},</if> -->
			principalId = #{principalId},
			principal = #{principal},
			<if test="clerkId != null">clerkId = #{clerkId},</if>
			<if test="clerk != null">clerk = #{clerk},</if>
			<if test="lastYearIsDeal != null">lastYearIsDeal = #{lastYearIsDeal},</if>
			<if test="cusLostInsurStatu != null">cusLostInsurStatu = #{cusLostInsurStatu},</if>
			<if test="newVirtualJqxdqr != null">virtualJqxdqr = #{newVirtualJqxdqr},</if>
			<if test="status != null">status = #{status},</if>
			<if test="bhInsuranceEndDate != null">bhInsuranceEndDate = #{bhInsuranceEndDate},</if>
      		<if test="ifUpdate != null">ifUpdate = #{ifUpdate},</if>
      		<if test="factoryLicenseType != null">factoryLicenseType = #{factoryLicenseType},</if>
			<if test="carAnnualCheckUpDate != null and carAnnualCheckUpDate != ''">carAnnualCheckUpDate = #{carAnnualCheckUpDate},</if>
			<if test="insuredLY != null">insuredLY = #{insuredLY},</if>
			<if test="buyfromThisStore != null">buyfromThisStore = #{buyfromThisStore},</if>
			<if test="gotThroughNum != null">gotThroughNum = #{gotThroughNum},</if>
			<if test="contactWayReserve != null">contactWayReserve = #{contactWayReserve}, </if>
			<if test="ifLoan != null">ifLoan = #{ifLoan},</if>
			<if test="bhUpdateTime != null">bhUpdateTime = now(),</if>
			<if test="nicheng != null">nicheng = #{nicheng},</if>
		</set>
		where customerId = #{customerId,jdbcType=INTEGER}
	</update>
	 <!-- 定时更新潜客脱保状态 -->
  <update id="updateInsuracneDateStatuOnTime" parameterType="java.util.HashMap">
  	update bf_bip_renewaling_customer set cusLostInsurStatu = #{cusLostInsurStatu} where customerId = #{customerId}
  </update>
  
    <!-- 根据潜客脱保状态查询用户对应状态的潜客的数量  -->
  <select id="selectWillOutAndOutNum" parameterType="java.util.HashMap" resultType="java.lang.Integer">
    select 
    	count(*)
	from bf_bip_renewaling_customer rc,bf_bip_customer_assign ca
	where rc.customerId = ca.customerId 
	and cusLostInsurStatu = #{cusLostInsurStatu}
	and userId = #{userId,jdbcType=INTEGER}
  </select>
  <!-- 更新小池子里面的是否邀约 -->
  <update id="updateIsInvite">
  	update bf_bip_renewaling_customer set isInvite = 1 where customerId = #{customerId}
  </update>
	<!-- 根据主键查询潜客 -->
	<select id="selectByPrimaryKey" resultMap="BaseResultMap">
		select * from bf_bip_renewaling_customer 
		where
		customerId = #{customerId}
		and fourSStoreId = #{storeId}
	</select>
	<!-- 更新客户级别 -->
	<update id="updateCustomerLevel" parameterType="java.util.HashMap">
		update bf_bip_renewaling_customer set customerLevel = #{customerLevel} where customerId = #{customerId}
	</update>
	
	<!-- 查询将要更新跟踪状态为应跟踪的潜客 -->
	<select id="findWillTraceCustomer" resultMap="BaseResultMap">
		select * from bf_bip_renewaling_customer rc,bf_bip_customer_assign ca
		where rc.customerId = ca.customerId
		and rc.customerLevel != 'S'
		and rc.fourSStoreId = #{storeId}
		and ca.traceStatu not in (3,1,0)
		<![CDATA[and willingTraceDate  <= CURDATE()]]>
		and (ifnull(cusLostInsurStatu,0) != 2
		or (ca.delayDate is not null
		and ca.delayDate >= CURDATE()))
	</select>
	<!-- 更新负责人信息为null -->
   <update id="updatePrincipalInfo" parameterType="java.util.HashMap" >
   	update bf_bip_renewaling_customer 
   	set 
		principalId = #{principalId,jdbcType=INTEGER},
	 	principal = #{principal,jdbcType=VARCHAR}
   	where customerId = #{customerId,jdbcType=INTEGER}
   </update>
   
   <update id="updateToUnAssignStatu" parameterType="java.util.HashMap">
	update bf_bip_customer set status = #{status} where customerId = #{customerId} 
  </update>
  
  <select id="findRCByStoreId" resultMap="BaseResultMap">
  	SELECT
		*
	FROM
		bf_bip_renewaling_customer
	WHERE
		fourSStoreId = #{fourSStoreId}
  </select>
  <select id="findRCBycustomerId" resultMap="BaseResultMap">
  	SELECT
		*
	FROM
		bf_bip_renewaling_customer
	WHERE
		customerId = #{customerId}
  </select>
  <delete id="deleteByStoreId" parameterType="java.lang.Integer">
  	DELETE
	FROM
		bf_bip_renewaling_customer
	WHERE
	fourSStoreId = #{storeId}
  </delete>
  <select id="findCustomerByStoreIdAndChassisNumber"  resultMap="BaseResultMap" parameterType="java.util.HashMap">
	select *
	from bf_bip_customer a 
	LEFT JOIN bf_bip_renewaling_customer b on (a.customerId = b.customerId)
	left join bf_bip_cover_type ct on ct.coverType = a.renewalType 
	left join  bf_bip_customer_assign ca on (a.customerId = ca.customerId) and ca.traceStatu != 3
	WHERE a.fourSStoreId = #{fourSStoreId,jdbcType=INTEGER} 
	AND a.chassisNumber = #{chassisNumber}
	ORDER BY b.willingTraceDate desc ,a.customerId desc
  </select>
  
  <select id="findActivateCustomer"  resultMap="BaseResultMap" parameterType="java.util.HashMap">
  		SELECT
			distinct rc.*,ct.*
		FROM
			bf_bip_renewaling_customer rc
		LEFT JOIN bf_bip_cover_type ct ON ct.coverType = rc.renewalType,
		bf_bip_customer_assign ca
		<where>
			rc.customerId = ca.customerId
			and ca.returnStatu = #{returnStatu}
			and rc.customerLevel != 'O'
			<if test="startTime != null and startTime != ''">
	  			<![CDATA[and ca.returnDate >= #{startTime,jdbcType=DATE}]]>
	  		</if> 
	  		<if test="endTime != null and endTime != ''">
	  			<![CDATA[and ca.returnDate <= #{endTime,jdbcType=DATE}]]>
	  		</if> 
	  		<if test="storeId != null and storeId != ''">
	  			and rc.fourSStoreId = #{storeId}
	  		</if>
	  		<!-- 添加查询条件过滤 -->
	  		<if test="renewalType != null and renewalType != ''">
	  			and rc.renewalType = #{renewalType}
	  		</if>
	  		<if test="chassisNumber != null and chassisNumber != ''">
	  			and rc.chassisNumber like '%${chassisNumber}%'
	  		</if>
	  		<if test="contact != null and contact != ''">
	  			and rc.contact = #{contact}
	  		</if>
	  		<if test="contactWay != null and contactWay != ''">
	  			and (rc.contactWay like '%${contactWay}%'
	 		        or rc.contactWayReserve like '%${contactWay}%'
	 		    )
	  		</if>
	  		<if test="carLicenseNumber != null and carLicenseNumber != ''">
	  			and rc.carLicenseNumber like '%${carLicenseNumber}%'
	  		</if>
  	 	</where>
  	 	<!-- short代表按某字段排序，shortmain 1：升序，2：降序 -->
  	 	        <if test="short==2 and shortmain==1"> ORDER BY  rc.principal ASC</if>
		  	    <if test="short==2 and shortmain==2"> ORDER BY  rc.principal DESC</if>
		  	    <if test="short==3 and shortmain==1"> ORDER BY  rc.clerk ASC</if>
		  	    <if test="short==3 and shortmain==2"> ORDER BY  rc.clerk DESC</if>
		  	    <if test="short==4 and shortmain==1"> ORDER BY  rc.contact ASC</if>
		  	    <if test="short==4 and shortmain==2"> ORDER BY  rc.contact DESC</if>
		  	    <if test="short==5 and shortmain==1"> ORDER BY  rc.contactWay ASC</if>
		  	    <if test="short==5 and shortmain==2"> ORDER BY  rc.contactWay DESC</if>
		  	    <if test="short==6 and shortmain==1"> ORDER BY  rc.chassisNumber ASC</if>
		  	    <if test="short==6 and shortmain==2"> ORDER BY  rc.chassisNumber DESC</if>
		  	    <if test="short==7 and shortmain==1"> ORDER BY  rc.carLicenseNumber ASC</if>
		  	    <if test="short==7 and shortmain==2"> ORDER BY  rc.carLicenseNumber DESC</if>
		  	    <if test="short==8 and shortmain==1"> ORDER BY  ct.coverTypeName ASC</if>
		  	    <if test="short==8 and shortmain==2"> ORDER BY  ct.coverTypeName DESC</if>
		  	    <if test="short==9 and shortmain==1"> ORDER BY  DATE_FORMAT(rc.insuranceEndDate,'%m-%d') ASC</if>
		  	    <if test="short==9 and shortmain==2"> ORDER BY  DATE_FORMAT(rc.insuranceEndDate,'%m-%d') DESC</if>
		  	    <if test="short==10 and shortmain==1"> ORDER BY  rc.bhUpdateTime ASC</if>
		  	    <if test="short==10 and shortmain==2"> ORDER BY  rc.bhUpdateTime DESC</if>
		  	    <if test="short==11 and shortmain==1"> ORDER BY rc.customerLevel ASC</if>
  	            <if test="short==11 and shortmain==2"> ORDER BY rc.customerLevel DESC</if>
		  	    <if test="short==12 and shortmain==1"> ORDER BY  rc.gotThroughNum ASC</if>
		  	    <if test="short==12 and shortmain==2"> ORDER BY  rc.gotThroughNum DESC</if>
		  	    <if test="short==13 and shortmain==1"> ORDER BY  rc.willingTraceDate ASC</if>
		  	    <if test="short==13 and shortmain==2"> ORDER BY  rc.willingTraceDate DESC</if>
		  	    <if test="short==14 and shortmain==1"> ORDER BY  rc.lastTraceDate ASC</if>
		  	    <if test="short==14 and shortmain==2"> ORDER BY  rc.lastTraceDate DESC</if>
		  	    <if test="short==15 and shortmain==1"> ORDER BY  rc.lastTraceResult ASC</if>
		  	    <if test="short==15 and shortmain==2"> ORDER BY  rc.lastTraceResult DESC</if>
		  	    <if test="short==16 and shortmain==1"> ORDER BY  ca.delayDate ASC</if>
		  	    <if test="short==16 and shortmain==2"> ORDER BY  ca.delayDate DESC</if>
		  	    <if test="short==17 and shortmain==1"> ORDER BY  rc.virtualJqxdqr ASC</if>
		  	    <if test="short==17 and shortmain==2"> ORDER BY  rc.virtualJqxdqr DESC</if>
		  	    <if test="short==18 and shortmain==1"> ORDER BY  ca.assignDate ASC</if>
		  	    <if test="short==18 and shortmain==2"> ORDER BY  ca.assignDate DESC</if>
		  	    <!-- <if test="short==19 and shortmain==1"> ORDER BY  holder ASC</if>
		  	    <if test="short==19 and shortmain==2"> ORDER BY  holder DESC</if> -->
  	 	LIMIT #{start,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}
  </select>
  <!-- 查询已唤醒总记录数 -->
  <select id="findCountActivateCustomer"  resultType="java.lang.Integer" parameterType="java.util.HashMap">
  		select count(1) from (
  			SELECT
			distinct rc.id
		FROM
			bf_bip_renewaling_customer rc
		LEFT JOIN bf_bip_cover_type ct ON ct.coverType = rc.renewalType,
		bf_bip_customer_assign ca
		<where>
			rc.customerId = ca.customerId
			and ca.returnStatu = #{returnStatu}
			and rc.customerLevel != 'O' 
		  	<if test="startTime != null and startTime != ''">
	  			<![CDATA[and ca.returnDate >= #{startTime,jdbcType=DATE}]]>
	  		</if> 
	  		<if test="endTime != null and endTime != ''">
	  			<![CDATA[and ca.returnDate <= #{endTime,jdbcType=DATE}]]>
	  		</if> 
	  		<if test="storeId != null and storeId != ''">
	  			and rc.fourSStoreId = #{storeId}
	  		</if>
	  		<!-- 添加查询条件过滤 -->
	  		<if test="renewalType != null and renewalType != ''">
	  			and rc.renewalType = #{renewalType}
	  		</if>
	  		<if test="chassisNumber != null and chassisNumber != ''">
	  			and rc.chassisNumber like '%${chassisNumber}%'
	  		</if>
	  		<if test="contact != null and contact != ''">
	  			and rc.contact = #{contact}
	  		</if>
	  		<if test="contactWay != null and contactWay != ''">
	  			and (rc.contactWay like '%${contactWay}%'
	 		        or rc.contactWayReserve like '%${contactWay}%'
	 		    )
	  		</if>
	  		<if test="carLicenseNumber != null and carLicenseNumber != ''">
	  			and rc.carLicenseNumber like '%${carLicenseNumber}%'
	  		</if>
	  	 </where>
  		) t
  </select>
	<!-- 查询已唤醒潜客跟踪记录总数 -->
	<select id="countFindActivateCustomerGzjl"  resultType="java.lang.Integer" parameterType="java.util.HashMap">
		select count(1)
		from bf_bip_customer_trace_recode
		where customerId in(
			SELECT t.customerId FROM (
				SELECT DISTINCT rc.*
				FROM bf_bip_renewaling_customer rc
				LEFT JOIN bf_bip_cover_type ct ON ct.coverType = rc.renewalType,
				bf_bip_customer_assign ca
				<where>
					rc.customerId = ca.customerId
					and ca.returnStatu = #{returnStatu}
					and rc.customerLevel != 'O'
					<if test="storeId != null and storeId != ''">
						and rc.fourSStoreId = #{storeId}
					</if>
				</where>
			) t
		)
	</select>
  
  <select id="findBeenLostCus" resultMap="BaseResultMap" parameterType="java.util.HashMap">
  	SELECT
		rc.*,ct.*, ca.acceptStatu,
		ca.assignDate,
		ca.customerId,
		ca.customerTraceId,
		ca.delayDate,
		ca.id,
		ca.inviteDate,
		ca.inviteStatu,
		ca.returnDate,
		ca.returnStatu,
		ca.traceDate,
		ca.traceStatu,
		ca.userId
	FROM
		bf_bip_renewaling_customer rc
		LEFT JOIN bf_bip_cover_type ct ON ct.coverType = rc.renewalType
		left join (SELECT * FROM (SELECT * FROM bf_bip_customer_assign where userId in 
		(SELECT id from bf_bip_user where storeId = #{storeId}  and (roleId=5 or roleId=2)) and 
		returnStatu = 5 ORDER BY returnDate DESC) a GROUP BY a.customerId ORDER BY returnDate DESC
		) ca on rc.customerId = ca.customerId 
	<where>
		rc.customerLevel = 'F'
		AND rc.fourSStoreId = #{storeId} 
		<if test="startTime != null and startTime != ''">
			<![CDATA[and ca.returnDate >= #{startTime}]]>
		</if>
		<if test="endTime != null and endTime != ''">
			<![CDATA[and ca.returnDate <= #{endTime}]]>
		</if>
		<!-- 添加查询条件过滤 -->
  		<if test="renewalType != null and renewalType != ''">
  			and rc.renewalType = #{renewalType}
  		</if>
  		
  		<if test="chassisNumber != null and chassisNumber != ''">
  			and rc.chassisNumber like '%${chassisNumber}%'
  		</if>
  		<if test="contact != null and contact != ''">
  			and rc.contact = #{contact}
  		</if>
  		<if test="contactWay != null and contactWay != ''">
  			and (rc.contactWay like '%${contactWay}%'
	 		        or rc.contactWayReserve like '%${contactWay}%'
	 		    )
  		</if>
  		<if test="carLicenseNumber != null and carLicenseNumber != ''">
  			and rc.carLicenseNumber like '%${carLicenseNumber}%'
  		</if>
  		<if test="insuranceEndDateStart != null and insuranceEndDateStart !=''">
	 		<![CDATA[and  DATE_FORMAT(rc.insuranceEndDate,'%m-%d')  >=  #{insuranceEndDateStart,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="insuranceEndDateEnd != null and insuranceEndDateEnd !=''">
	 		<![CDATA[and  DATE_FORMAT(rc.insuranceEndDate,'%m-%d')  <=  #{insuranceEndDateEnd,jdbcType=DATE} ]]>
	 	</if>
	</where>
	 <!-- ORDER BY rc.id  -->
	  <!-- short代表按某字段排序，shortmain 1：升序，2：降序 -->
	            <if test="short==null and shortmain==null"> ORDER BY rc.id</if>
	            <if test="short==2 and shortmain==1"> ORDER BY  rc.principal ASC</if>
		  	    <if test="short==2 and shortmain==2"> ORDER BY  rc.principal DESC</if>
		  	    <if test="short==3 and shortmain==1"> ORDER BY  rc.clerk ASC</if>
		  	    <if test="short==3 and shortmain==2"> ORDER BY  rc.clerk DESC</if>
		  	    <if test="short==4 and shortmain==1"> ORDER BY  rc.contact ASC</if>
		  	    <if test="short==4 and shortmain==2"> ORDER BY  rc.contact DESC</if>
		  	    <if test="short==5 and shortmain==1"> ORDER BY  rc.contactWay ASC</if>
		  	    <if test="short==5 and shortmain==2"> ORDER BY  rc.contactWay DESC</if>
		  	    <if test="short==6 and shortmain==1"> ORDER BY  rc.chassisNumber ASC</if>
		  	    <if test="short==6 and shortmain==2"> ORDER BY  rc.chassisNumber DESC</if>
		  	    <if test="short==7 and shortmain==1"> ORDER BY  rc.carLicenseNumber ASC</if>
		  	    <if test="short==7 and shortmain==2"> ORDER BY  rc.carLicenseNumber DESC</if>
		  	    <if test="short==8 and shortmain==1"> ORDER BY  ct.coverTypeName ASC</if>
		  	    <if test="short==8 and shortmain==2"> ORDER BY  ct.coverTypeName DESC</if>
		  	    <if test="short==9 and shortmain==1"> ORDER BY  DATE_FORMAT(rc.insuranceEndDate,'%m-%d') ASC</if>
		  	    <if test="short==9 and shortmain==2"> ORDER BY  DATE_FORMAT(rc.insuranceEndDate,'%m-%d') DESC</if>
		  	    <if test="short==10 and shortmain==1"> ORDER BY  rc.bhUpdateTime ASC</if>
		  	    <if test="short==10 and shortmain==2"> ORDER BY  rc.bhUpdateTime DESC</if>
		  	    <if test="short==11 and shortmain==1"> ORDER BY rc.customerLevel ASC</if>
  	            <if test="short==11 and shortmain==2"> ORDER BY rc.customerLevel DESC</if>
		  	    <if test="short==12 and shortmain==1"> ORDER BY  rc.gotThroughNum ASC</if>
		  	    <if test="short==12 and shortmain==2"> ORDER BY  rc.gotThroughNum DESC</if>
		  	    <if test="short==13 and shortmain==1"> ORDER BY  rc.willingTraceDate ASC</if>
		  	    <if test="short==13 and shortmain==2"> ORDER BY  rc.willingTraceDate DESC</if>
		  	    <if test="short==14 and shortmain==1"> ORDER BY  rc.lastTraceDate ASC</if>
		  	    <if test="short==14 and shortmain==2"> ORDER BY  rc.lastTraceDate DESC</if>
		  	    <if test="short==15 and shortmain==1"> ORDER BY  rc.lastTraceResult ASC</if>
		  	    <if test="short==15 and shortmain==2"> ORDER BY  rc.lastTraceResult DESC</if>
		  	    <if test="short==16 and shortmain==1"> ORDER BY  ca.delayDate ASC</if>
		  	    <if test="short==16 and shortmain==2"> ORDER BY  ca.delayDate DESC</if>
		  	    <if test="short==17 and shortmain==1"> ORDER BY  rc.virtualJqxdqr ASC</if>
		  	    <if test="short==17 and shortmain==2"> ORDER BY  rc.virtualJqxdqr DESC</if>
		  	    <if test="short==18 and shortmain==1"> ORDER BY  ca.assignDate ASC</if>
		  	    <if test="short==18 and shortmain==2"> ORDER BY  ca.assignDate DESC</if>
		  	    <if test="short==19 and shortmain==1"> ORDER BY  #{userName} ASC</if>
		  	    <if test="short==19 and shortmain==2"> ORDER BY  #{userName} DESC</if>
	 LIMIT #{start,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}
  </select>
  
  <select id="findCountBeenLostCus" resultType="int" parameterType="java.util.HashMap">
  	SELECT
		count(1)
	FROM
		bf_bip_renewaling_customer rc
		LEFT JOIN bf_bip_cover_type ct ON ct.coverType = rc.renewalType
		left join (SELECT * FROM (SELECT * FROM bf_bip_customer_assign where userId in 
		(SELECT id from bf_bip_user where storeId = #{storeId}  and (roleId=5 or roleId=2) ) and 
		returnStatu = 5 ORDER BY returnDate DESC) a GROUP BY a.customerId ORDER BY returnDate DESC
		) ca on rc.customerId = ca.customerId 
	<where>
		rc.customerLevel = 'F'
		AND rc.fourSStoreId = #{storeId} 
		<if test="startTime != null and startTime != ''">
			<![CDATA[and ca.returnDate >= #{startTime}]]>
		</if>
		<if test="endTime != null and endTime != ''">
			<![CDATA[and ca.returnDate <= #{endTime}]]>
		</if>
		<!-- 添加查询条件过滤 -->
  		<if test="renewalType != null and renewalType != ''">
  			and rc.renewalType = #{renewalType}
  		</if>
  		<if test="chassisNumber != null and chassisNumber != ''">
  			and rc.chassisNumber like '%${chassisNumber}%'
  		</if>
  		<if test="contact != null and contact != ''">
  			and rc.contact = #{contact}
  		</if>
  		<if test="contactWay != null and contactWay != ''">
  			and (rc.contactWay like '%${contactWay}%'
	 		        or rc.contactWayReserve like '%${contactWay}%'
	 		    )
  		</if>
  		<if test="carLicenseNumber != null and carLicenseNumber != ''">
  			and rc.carLicenseNumber like '%${carLicenseNumber}%'
  		</if>
  		<if test="insuranceEndDateStart != null and insuranceEndDateStart !=''">
	 		<![CDATA[and  DATE_FORMAT(rc.insuranceEndDate,'%m-%d')  >=  #{insuranceEndDateStart,jdbcType=DATE} ]]>
	 	</if>
	 	<if test="insuranceEndDateEnd != null and insuranceEndDateEnd !=''">
	 		<![CDATA[and  DATE_FORMAT(rc.insuranceEndDate,'%m-%d')  <=  #{insuranceEndDateEnd,jdbcType=DATE} ]]>
	 	</if>
	</where>
  </select>
  
  <!-- 按回退状态查询潜客跟踪记录<管理> -->
  <select id="findCountBeenLostCusGzjl" resultType="int" parameterType="java.util.HashMap">
  select  
   	count(1)
  from bf_bip_customer_trace_recode
    	where customerId in(
  	SELECT
		rc.customerId
	FROM
		bf_bip_renewaling_customer rc
		LEFT JOIN bf_bip_cover_type ct ON ct.coverType = rc.renewalType
		left join (SELECT * FROM (SELECT * FROM bf_bip_customer_assign where userId in 
		(SELECT id from bf_bip_user where storeId = #{storeId}  and roleId=5) and 
		returnStatu = 5 ORDER BY returnDate DESC) a GROUP BY a.customerId ORDER BY returnDate DESC
		) ca on rc.customerId = ca.customerId 
	<where>
		rc.customerLevel = 'F'
		AND rc.fourSStoreId = #{storeId} 
		<if test="startTime != null and startTime != ''">
			<![CDATA[and ca.returnDate >= #{startTime}]]>
		</if>
		<if test="endTime != null and endTime != ''">
			<![CDATA[and ca.returnDate <= #{endTime}]]>
		</if>
		<!-- 添加查询条件过滤 -->
  		<if test="renewalType != null and renewalType != ''">
  			and rc.renewalType = #{renewalType}
  		</if>
  		<if test="chassisNumber != null and chassisNumber != ''">
  			and rc.chassisNumber like '%${chassisNumber}%'
  		</if>
  		<if test="contact != null and contact != ''">
  			and rc.contact = #{contact}
  		</if>
  		<if test="contactWay != null and contactWay != ''">
  			and (rc.contactWay like '%${contactWay}%'
	 		        or rc.contactWayReserve like '%${contactWay}%'
	 		    )
  		</if>
  		<if test="carLicenseNumber != null and carLicenseNumber != ''">
  			and rc.carLicenseNumber like '%${carLicenseNumber}%'
  		</if>
	</where>)
  </select>
  
   <select id="fixData" resultMap="BaseResultMap">
  	select * from bf_bip_renewaling_customer where principalId is null and principal is not null
  </select>
  <update id="updateData" parameterType="java.util.Map" >
  	update bf_bip_renewaling_customer 
  	set
  	principalId = #{principalId} where customerId = #{customerId}
  </update>

	<update id="updateRenewalingCustomerByImport" parameterType="com.bofide.bip.po.Customer">
		update bf_bip_renewaling_customer
		<set>
			customerCharacter = #{customerCharacter},
			certificateNumber = #{certificateNumber},
			syxrqEnd = #{syxrqEnd},
			carOwner = #{carOwner},
			insured = #{insured},
			contact = #{contact},
			contactWay = #{contactWay},
			chassisNumber = #{chassisNumber},
			engineNumber = #{engineNumber},
			insuranceCompLY = #{insuranceCompLY},
			insuranceEndDate = #{jqxrqEnd},
			carBrand = #{carBrand},
			vehicleModel = #{vehicleModel},
			carLicenseNumber = #{carLicenseNumber},
			registrationDate = #{registrationDate},
			renewalType = #{renewalType},
			insurNumber = #{insurNumber},
			insurDateLY = #{insurDateLY},
			maintainNumberLY = #{maintainNumberLY},
			accidentNumberLY = #{accidentNumberLY},
			accidentOutputValueLY = #{accidentOutputValueLY},
			remark = #{remark},
			principalId = #{principalId},
			principal = #{principal},
			clerkId = #{clerkId},
			clerk = #{clerk},
			factoryLicenseType = #{factoryLicenseType},
			ifLoan = #{ifLoan},
			serviceConsultantId = #{serviceConsultantId},
			serviceConsultant = #{serviceConsultant},
			lastYearIsDeal = #{lastYearIsDeal},
			virtualJqxdqr = #{virtualJqxdqr},
			<if test="status != null">status = #{status},</if>
		</set>
		where customerId = #{customerId,jdbcType=INTEGER}
	</update>
	
	<!-- 这里本来是rc.principalId,rc.principal没有bf_bip_customer表的连接，
	但bf_bip_renewaling_customer部分负责人为空，所以改为  cu.principalId,cu.principal -->
	<select id="findInviteRecord" resultType="java.util.Map" parameterType="java.util.HashMap">
		SELECT rc.customerId,rc.cusLostInsurStatu,rc.carLicenseNumber,
			cu.principalId,cu.principal,rc.clerkId,rc.clerk,rc.contactWay,rc.contact,rc.chassisNumber,
			rc.insuranceEndDate as jqxrqEnd,rc.customerLevel,rc.willingTraceDate,rc.isComeStore,rc.lastTraceDate,
			rc.lastTraceResult,rc.firstAcceptDate,rc.status,rc.virtualJqxdqr,rc.sfgyx,
			ct.coverTypeName,
			ca.delayDate,ca.acceptStatu,ca.traceStatu,ca.returnStatu,ca.inviteStatu,ca.userId as assign_userId,ca.assignDate,
			u.userName holder,u.id holderId,u.roleId holderRoleId,
			tr.inviteDate inviteDate,
			u1.userName yyr
		FROM
			bf_bip_renewaling_customer rc
		LEFT JOIN bf_bip_customer cu on cu.customerId = rc.customerId
		LEFT JOIN bf_bip_customer_trace_recode tr on tr.customerId = rc.customerId 
		INNER JOIN bf_bip_user u1 on u1.id = tr.operatorID
		LEFT JOIN bf_bip_cover_type ct ON ct.coverType = rc.renewalType
		LEFT JOIN bf_bip_customer_assign ca on rc.customerId = ca.customerId 
		<if test="roleId != null and roleId != ''">and ifnull(traceStatu,0) != 3</if>
		LEFT JOIN bf_bip_user u ON ca.userId = u.id 
		<where>
			tr.inviteDate is not null
			<if test="userId != null and userId != ''">and ca.userId = #{userId} and tr.principalId = #{userId}</if>
			<!-- <if test="roleId != null and roleId != ''">and u.roleId = #{roleId}</if> -->
			<if test="roleId1 != null and roleId1 != ''">and u.roleId = #{roleId1}</if>
			<!-- <if test="inviteStatu != null and inviteStatu != ''">and ca.inviteStatu = #{inviteStatu}</if> --> 
			<if test="startTime != null and startTime != ''">
				<![CDATA[and tr.inviteDate >= #{startTime,jdbcType=DATE}]]>
			</if> 
			<if test="endTime != null and endTime != ''">
				<![CDATA[and tr.inviteDate <= #{endTime,jdbcType=DATE}]]>
			</if>
			<if test="storeId != null and storeId != ''">and rc.fourSStoreId = #{storeId}</if> 
			<!-- 添加查询条件过滤 -->
			<if test="renewalType != null and renewalType != ''">and rc.renewalType = #{renewalType}</if>
			<if test="holder != null and holder != ''">and u.userName = #{holder}</if>
			<if test="chassisNumber != null and chassisNumber != ''">
				and rc.chassisNumber like '%${chassisNumber}%'
			</if>
			<if test="contact != null and contact != ''">and rc.contact = #{contact}</if>
			<if test="contactWay != null and contactWay != ''">
				and (rc.contactWay like '%${contactWay}%'
	 		        or rc.contactWayReserve like '%${contactWay}%'
	 		    )
			</if>
			<if test="carLicenseNumber != null and carLicenseNumber != ''">
				and rc.carLicenseNumber like '%${carLicenseNumber}%'
			</if>
			<if test="inviteHappenTimeStart != null and inviteHappenTimeStart !=''">
				<![CDATA[and DATE_FORMAT(tr.currentTraceDate, '%Y-%m-%d') >=  #{inviteHappenTimeStart} ]]>
			</if>
			<if test="inviteHappenTimeEnd != null and inviteHappenTimeEnd !=''">
				<![CDATA[and DATE_FORMAT(tr.currentTraceDate, '%Y-%m-%d') <= #{inviteHappenTimeEnd} ]]>
			</if>
			<if test="inviteHappenTimeStart != null and inviteHappenTimeStart !='' and inviteHappenTimeEnd != null and inviteHappenTimeEnd !=''">
				and DATE_FORMAT(tr.currentTraceDate, '%Y-%m-%d') BETWEEN #{inviteHappenTimeStart} AND #{inviteHappenTimeEnd} 
			</if>
			<if test="operatorID != null and operatorID != ''">
				and tr.operatorID = #{operatorID}
			</if>
		</where>
		<!-- ORDER BY rc.id --> 
		<!-- short代表按某字段排序，shortmain 1：升序，2：降序 -->
		        <if test="short==null and shortmain==null"> ORDER BY rc.id</if>
  	            <if test="short==2 and shortmain==1"> ORDER BY  rc.principal ASC</if>
		  	    <if test="short==2 and shortmain==2"> ORDER BY  rc.principal DESC</if>
		  	    <if test="short==3 and shortmain==1"> ORDER BY  rc.clerk ASC</if>
		  	    <if test="short==3 and shortmain==2"> ORDER BY  rc.clerk DESC</if>
		  	    <if test="short==4 and shortmain==1"> ORDER BY  rc.contact ASC</if>
		  	    <if test="short==4 and shortmain==2"> ORDER BY  rc.contact DESC</if>
		  	    <if test="short==5 and shortmain==1"> ORDER BY  rc.contactWay ASC</if>
		  	    <if test="short==5 and shortmain==2"> ORDER BY  rc.contactWay DESC</if>
		  	    <if test="short==6 and shortmain==1"> ORDER BY  rc.chassisNumber ASC</if>
		  	    <if test="short==6 and shortmain==2"> ORDER BY  rc.chassisNumber DESC</if>
		  	    <if test="short==7 and shortmain==1"> ORDER BY  rc.carLicenseNumber ASC</if>
		  	    <if test="short==7 and shortmain==2"> ORDER BY  rc.carLicenseNumber DESC</if>
		  	    <if test="short==8 and shortmain==1"> ORDER BY  ct.coverTypeName ASC</if>
		  	    <if test="short==8 and shortmain==2"> ORDER BY  ct.coverTypeName DESC</if>
		  	    <if test="short==9 and shortmain==1"> ORDER BY  DATE_FORMAT(rc.insuranceEndDate,'%m-%d') ASC</if>
		  	    <if test="short==9 and shortmain==2"> ORDER BY  DATE_FORMAT(rc.insuranceEndDate,'%m-%d') DESC</if>
		  	    <if test="short==11 and shortmain==1"> ORDER BY rc.customerLevel ASC</if>
  	            <if test="short==11 and shortmain==2"> ORDER BY rc.customerLevel DESC</if>
		  	    <if test="short==13 and shortmain==1"> ORDER BY  rc.willingTraceDate ASC</if>
		  	    <if test="short==13 and shortmain==2"> ORDER BY  rc.willingTraceDate DESC</if>
		  	    <if test="short==14 and shortmain==1"> ORDER BY  rc.lastTraceDate ASC</if>
		  	    <if test="short==14 and shortmain==2"> ORDER BY  rc.lastTraceDate DESC</if>
		  	    <if test="short==15 and shortmain==1"> ORDER BY  rc.lastTraceResult ASC</if>
		  	    <if test="short==15 and shortmain==2"> ORDER BY  rc.lastTraceResult DESC</if>
		  	    <if test="short==16 and shortmain==1"> ORDER BY  ca.delayDate ASC</if>
		  	    <if test="short==16 and shortmain==2"> ORDER BY  ca.delayDate DESC</if>
		  	    <if test="short==17 and shortmain==1"> ORDER BY  rc.virtualJqxdqr ASC</if>
		  	    <if test="short==17 and shortmain==2"> ORDER BY  rc.virtualJqxdqr DESC</if>
		  	    <if test="short==18 and shortmain==1"> ORDER BY  ca.assignDate ASC</if>
		  	    <if test="short==18 and shortmain==2"> ORDER BY  ca.assignDate DESC</if>
		  	    <if test="short==19 and shortmain==1"> ORDER BY  holder ASC</if>
		  	    <if test="short==19 and shortmain==2"> ORDER BY  holder DESC</if>
		  	    <if test="short==21 and shortmain==1"> ORDER BY  inviteDate ASC</if>
		  	    <if test="short==21 and shortmain==2"> ORDER BY  inviteDate DESC</if>
		  	    <if test="short==22 and shortmain==1"> ORDER BY  rc.isComeStore ASC</if>
		  	    <if test="short==22 and shortmain==2"> ORDER BY  rc.isComeStore DESC</if>
		  	    <if test="short==23 and shortmain==1"> ORDER BY  yyr ASC</if>
		  	    <if test="short==24 and shortmain==2"> ORDER BY  yyr DESC</if>
		LIMIT #{start,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}
	</select>
	
	<select id="findInviteRecordCount" resultType="java.lang.Integer" parameterType="java.util.HashMap">
		SELECT count(*)
		FROM
			bf_bip_renewaling_customer rc
		LEFT JOIN bf_bip_customer cu on cu.customerId = rc.customerId
		LEFT JOIN bf_bip_customer_trace_recode tr on tr.customerId = rc.customerId 
		INNER JOIN bf_bip_user u1 ON u1.id = tr.operatorID
		LEFT JOIN bf_bip_cover_type ct ON ct.coverType = rc.renewalType
		LEFT JOIN bf_bip_customer_assign ca on rc.customerId = ca.customerId 
		<if test="roleId != null and roleId != ''">and ifnull(traceStatu,0) != 3</if>
		LEFT JOIN bf_bip_user u ON ca.userId = u.id
		<where>
			tr.inviteDate is not null
			<if test="userId != null and userId != ''">and ca.userId = #{userId} and tr.principalId = #{userId}</if>
			<!-- <if test="roleId != null and roleId != ''">and u.roleId = #{roleId}</if> -->
			<if test="roleId1 != null and roleId1 != ''">and u.roleId = #{roleId1}</if>
			<!-- <if test="inviteStatu != null and inviteStatu != ''">and ca.inviteStatu = #{inviteStatu}</if>  -->
			<if test="startTime != null and startTime != ''">
				<![CDATA[and tr.inviteDate >= #{startTime,jdbcType=DATE}]]>
			</if> 
			<if test="endTime != null and endTime != ''">
				<![CDATA[and tr.inviteDate <= #{endTime,jdbcType=DATE}]]>
			</if>
			<if test="storeId != null and storeId != ''">and rc.fourSStoreId = #{storeId}</if> 
			<!-- 添加查询条件过滤 -->
			<if test="renewalType != null and renewalType != ''">and rc.renewalType = #{renewalType}</if>
			<if test="holder != null and holder != ''">and u.userName = #{holder}</if>
			<if test="chassisNumber != null and chassisNumber != ''">
				and rc.chassisNumber like '%${chassisNumber}%'
			</if>
			<if test="contact != null and contact != ''">and rc.contact = #{contact}</if>
			<if test="contactWay != null and contactWay != ''">
				and (rc.contactWay like '%${contactWay}%'
	 		        or rc.contactWayReserve like '%${contactWay}%'
	 		    )
			</if>
			<if test="carLicenseNumber != null and carLicenseNumber != ''">
				and rc.carLicenseNumber like '%${carLicenseNumber}%'
			</if>
			<if test="inviteHappenTimeStart != null and inviteHappenTimeStart !=''">
				<![CDATA[and DATE_FORMAT(tr.currentTraceDate, '%Y-%m-%d') >=  #{inviteHappenTimeStart} ]]>
			</if>
			<if test="inviteHappenTimeEnd != null and inviteHappenTimeEnd !=''">
				<![CDATA[and DATE_FORMAT(tr.currentTraceDate, '%Y-%m-%d') <= #{inviteHappenTimeEnd} ]]>
			</if>
			<if test="inviteHappenTimeStart != null and inviteHappenTimeStart !='' and inviteHappenTimeEnd != null and inviteHappenTimeEnd !=''">
				and DATE_FORMAT(tr.currentTraceDate, '%Y-%m-%d') BETWEEN #{inviteHappenTimeStart} AND #{inviteHappenTimeEnd} 
			</if>
			<if test="operatorID != null and operatorID != ''">
				and tr.operatorID = #{operatorID}
			</if>
		</where>
	</select>
	
	<!-- 根据建档人查询潜客 -->
	<select id="findCustomerByCreater" parameterType="java.util.Map" resultMap="BaseResultMap">
  		SELECT c.*,ct.* from bf_bip_customer c LEFT JOIN bf_bip_cover_type ct on c.renewalType = ct.coverType
  	<where>
  		<!-- 添加查询条件过滤 -->
  		<if test="storeId != null and storeId != ''">
  			c.fourSStoreId = #{storeId}
  		</if>
  		<if test="renewalType != null and renewalType != ''">
  			and c.renewalType = #{renewalType}
  		</if>
  		<if test="carLicenseNumber != null and carLicenseNumber != ''">
  			and c.carLicenseNumber like '%${carLicenseNumber}%'
  		</if>
  		<if test="chassisNumber != null and chassisNumber != ''">
  			and c.chassisNumber like '%${chassisNumber}%'
  		</if>
  		<if test="contact != null and contact != ''">
  			and c.contact = #{contact}
  		</if>
  		<if test="contactWay != null and contactWay != ''">
  			and (c.contactWay like '%${contactWay}%'
	 		        or c.contactWayReserve like '%${contactWay}%'
	 		    )
  		</if>
  		<if test="createrId != null and createrId != ''">
  			and c.createrId = #{createrId}
  		</if>
  		<if test="defeatFlag != null and defeatFlag != ''">
  			and c.defeatFlag = #{defeatFlag}
  		</if>
  		<if test="startDate != null and startDate != ''">
			<![CDATA[and date_format(c.createTime,'%Y-%m-%d') >= #{startDate}]]>
		</if> 
		<if test="endDate != null and endDate != ''">
			<![CDATA[and date_format(c.createTime,'%Y-%m-%d') <= #{endDate}]]>
		</if> 
  	</where>
  		<!-- ORDER BY c.insuranceEndDate --> 
  		 <!-- short代表按某字段排序，shortmain 1：升序，2：降序 -->
  		<if test="short==null and shortmain==null"> ORDER BY c.insuranceEndDate</if>
	    <if test="shortJdr==6 and shortmain==1">ORDER BY c.chassisNumber ASC</if>
  	    <if test="shortJdr==6 and shortmain==2">ORDER BY c.chassisNumber DESC</if>
		<if test="shortJdr==7 and shortmain==1">ORDER BY c.carLicenseNumber ASC</if>
  	    <if test="shortJdr==7 and shortmain==2">ORDER BY c.carLicenseNumber DESC</if>
		<if test="shortJdr==8 and shortmain==1">ORDER BY ct.coverTypeName ASC</if>
  	    <if test="shortJdr==8 and shortmain==2">ORDER BY ct.coverTypeName DESC</if>
  	    <if test="shortJdr==9 and shortmain==1">ORDER BY DATE_FORMAT(c.insuranceEndDate,'%m-%d') ASC</if>
  	    <if test="shortJdr==9 and shortmain==2">ORDER BY DATE_FORMAT(c.insuranceEndDate,'%m-%d') DESC</if>
  	    <if test="shortJdr==11 and shortmain==1">ORDER BY c.customerLevel ASC</if>
  	    <if test="shortJdr==11 and shortmain==2">ORDER BY c.customerLevel DESC</if>
  	    <if test="shortJdr==20 and shortmain==1">ORDER BY c.createTime ASC</if>
  	    <if test="shortJdr==20 and shortmain==2">ORDER BY c.createTime DESC</if>
  	    <if test="shortJdr==5 and shortmain==1">ORDER BY c.contactWay ASC</if>
  	    <if test="shortJdr==5 and shortmain==2">ORDER BY c.contactWay DESC</if>
  	    <if test="shortJdr==4 and shortmain==1">ORDER BY c.contact ASC</if>
  	    <if test="shortJdr==4 and shortmain==2">ORDER BY c.contact DESC</if>
  		LIMIT #{start,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}
  </select>
  <!-- 根据建档人查询潜客数量 -->
   <select id="findCustomerByCreaterCount" parameterType="java.util.Map" resultType="java.lang.Integer">
  		SELECT count(1) from bf_bip_customer c
  	<where>
  		<!-- 添加查询条件过滤 -->
  		<if test="storeId != null and storeId != ''">
  			c.fourSStoreId = #{storeId}
  		</if>
  		<if test="renewalType != null and renewalType != ''">
  			and c.renewalType = #{renewalType}
  		</if>
  		<if test="carLicenseNumber != null and carLicenseNumber != ''">
  			and c.carLicenseNumber like '%${carLicenseNumber}%'
  		</if>
  		<if test="chassisNumber != null and chassisNumber != ''">
  			and c.chassisNumber like '%${chassisNumber}%'
  		</if>
  		<if test="contact != null and contact != ''">
  			and c.contact = #{contact}
  		</if>
  		<if test="contactWay != null and contactWay != ''">
  			and (c.contactWay like '%${contactWay}%'
	 		        or c.contactWayReserve like '%${contactWay}%'
	 		    )
  		</if>
  		<if test="createrId != null and createrId != ''">
  			and c.createrId = #{createrId}
  		</if>
  		<if test="defeatFlag != null and defeatFlag != ''">
  			and c.defeatFlag = #{defeatFlag}
  		</if>
  		<if test="startDate != null and startDate != ''">
			<![CDATA[and date_format(c.createTime,'%Y-%m-%d') >= #{startDate}]]>
		</if> 
		<if test="endDate != null and endDate != ''">
			<![CDATA[and date_format(c.createTime,'%Y-%m-%d') <= #{endDate}]]>
		</if> 
  	</where>
  </select>
	<!-- 按审批的类别查询待审批(回退待审批,延期待审批) -->
	<select id="findCountByApprovalCategory" resultType="java.lang.Integer" parameterType="java.util.HashMap">
		SELECT count(*) FROM bf_bip_renewaling_customer rc
		LEFT JOIN bf_bip_customer_assign ca ON rc.customerId = ca.customerId
		LEFT JOIN bf_bip_user u ON ca.userId = u.id
		<where>
			ifnull(ca.traceStatu,0) != 3 
			<if test="users != null and users.size() > 0">
				and ca.userId in
				<foreach collection="users" item="user" open="(" separator="," close=")">
					#{user.id}
				</foreach> 
			</if>
			<if test="returnStatu != null and returnStatu != ''">
				and ca.returnStatu = #{returnStatu,jdbcType=INTEGER} 
			</if>
			<if test="applyStatu != null">AND ca.applyStatu = #{applyStatu}</if>
			<if test="storeId != null and storeId != ''">
				and rc.fourSStoreId = #{storeId}
			</if>
			<if test="roleId != null and roleId != ''">
				and u.roleId = #{roleId}
			</if>
		</where>
	</select>
	<select id="findComeStoreCountToday" resultType="java.lang.Integer" parameterType="java.util.HashMap">
		SELECT count(1) FROM bf_bip_renewaling_customer rc WHERE rc.fourSStoreId = #{storeId} 
		AND rc.comeStoreDate = DATE_FORMAT(now(),'%Y-%m-%d')
	</select>
	<select id="findComeStoreNoBillCountToday" resultType="java.lang.Integer" parameterType="java.util.HashMap">
		SELECT count(1) FROM bf_bip_renewaling_customer rc WHERE rc.fourSStoreId = #{storeId} 
		AND rc.comeStoreDate = DATE_FORMAT(now(),'%Y-%m-%d') AND rc.customerLevel != 'O'
	</select>
	
	<!-- 按状态和用户id查询潜客列表信息 -->
	<select id="findByStatuAndUserId" resultType="java.util.Map" parameterType="java.util.HashMap">
		SELECT rc.contact, rc.contactWay,rc.sfgyx,rc.insuranceEndDate,rc.customerLevel,rc.carLicenseNumber,rc.customerId,
			ca.assignDate,rc.insuranceCoverageLY,rc.willingTraceDate,ca.userId holderId,ca.returnStatu,ca.delayDate,
			rc.principalId,rc.principal,rc.chassisNumber,rc.clerkId,rc.clerk
		FROM bf_bip_renewaling_customer rc
		LEFT JOIN bf_bip_customer_assign ca ON rc.customerId = ca.customerId
		LEFT JOIN bf_bip_user u ON ca.userId = u.id
		<where>
			ifnull(ca.traceStatu,0) != 3 
			<if test="returnStatu != null and returnStatu != ''">
				and ca.returnStatu = #{returnStatu} 
			</if>
			<if test="applyStatu != null">AND ca.applyStatu = #{applyStatu}</if>
			<if test="returnStatu1 != null and returnStatu1 != '' or returnStatu2 != null and returnStatu2 != ''">
  				and (ca.returnStatu = #{returnStatu1,jdbcType=INTEGER} or ca.returnStatu = #{returnStatu2,jdbcType=INTEGER})
  			</if>
			<if test="acceptStatu != null and acceptStatu != ''">
				and ca.acceptStatu = #{acceptStatu} 
			</if>
			<if test="traceStatu != null and traceStatu != ''">
				and (ca.traceStatu = #{traceStatu} or ca.traceStatu = 4)
				and (IFNULL(rc.cusLostInsurStatu,0) != 2 or (ca.delayDate is not null and ca.delayDate >= CURDATE()))
				AND u.roleId != 5
				<if test="traceStatu == 2">
					AND ca.traceDate =  CURDATE()
				</if> 
			</if>
			<if test="cusLostInsurStatu != null and cusLostInsurStatu != ''">
				and rc.cusLostInsurStatu = #{cusLostInsurStatu}
				AND u.roleId != 5
			</if> 
			<if test="storeId != null and storeId != ''">
				and rc.fourSStoreId = #{storeId}
			</if>
			<if test="userId != null and userId != ''">
				and u.id = #{userId}
			</if>
			<if test="roleId != null and roleId != ''">
				and u.roleId = #{roleId}
			</if>
			<if test="renewalType != null and renewalType != ''">
					and rc.renewalType = #{renewalType}
			</if>
			<if test="insuranceCompLY != null and insuranceCompLY !=''">
				and rc.insuranceCompLY = #{insuranceCompLY}
			</if>
			<if test="customerLevel != null and customerLevel !=''">
				and rc.customerLevel = #{customerLevel}
			</if>
			<if test="insuranceEndDateStart != null and insuranceEndDateStart !=''">
				<![CDATA[and rc.insuranceEndDate >=  #{insuranceEndDateStart}]]>
			</if>
			<if test="insuranceEndDateEnd != null and insuranceEndDateEnd !=''">
				<![CDATA[and rc.insuranceEndDate <=  #{insuranceEndDateEnd}]]>
			</if>
			<if test="contact != null and contact !=''">
				and rc.contact = #{contact}
			</if>
			<if test="contactWay != null and contactWay !=''">
				and rc.contactWay like '%${contactWay}%'
			</if>
			<if test="carBrand != null and carBrand !=''">
				and rc.carBrand = #{carBrand}
			</if>
			<if test="vehicleModel != null and vehicleModel !=''">
				and rc.vehicleModel = #{vehicleModel}
			</if>
			<if test="chassisNumber != null and chassisNumber !=''">
				and rc.chassisNumber like '%${chassisNumber}%'
			</if>
			<if test="carLicenseNumber != null and carLicenseNumber !=''">
				and rc.carLicenseNumber like '%${carLicenseNumber}%'
			</if>
			<if test="insured != null and insured != ''">
				and rc.insured = #{insured}
			</if>
			<if test="carOwner != null and carOwner !=''">
				and rc.carOwner like '%${carOwner}%' 
			</if>
			<if test="ifLoan != null and ifLoan !=''">
				and rc.ifLoan = #{ifLoan}
			</if>
			
			<if test="boo==null or !boo">
				<if test="traceStatu != null and traceStatu != ''">
					ORDER BY rc.virtualJqxdqr,rc.customerId 
				</if>
				<if test="traceStatu == null">
					ORDER BY rc.insuranceEndDate 
				</if>
			</if>
			<!-- APP顾问查询时勾选按去年保费排序 -->
			<if test="boo!=null and boo">
				ORDER BY rc.insuranceCoverageLY DESC
			</if>
			LIMIT #{start,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}
		</where>
	</select>
	<select id="findCountByStatuAndUserId" resultType="Integer" parameterType="java.util.HashMap">
		SELECT count(1) 
		FROM bf_bip_renewaling_customer rc
		LEFT JOIN bf_bip_customer_assign ca ON rc.customerId = ca.customerId
		LEFT JOIN bf_bip_user u ON ca.userId = u.id
		<where>
			ifnull(ca.traceStatu,0) != 3 
			<if test="returnStatu != null and returnStatu != ''">
				and ca.returnStatu = #{returnStatu} 
			</if>
			<if test="applyStatu != null">AND ca.applyStatu = #{applyStatu}</if>
			<if test="returnStatu1 != null and returnStatu1 != '' or returnStatu2 != null and returnStatu2 != ''">
  				and (ca.returnStatu = #{returnStatu1,jdbcType=INTEGER} or ca.returnStatu = #{returnStatu2,jdbcType=INTEGER})
  			</if>
			<if test="acceptStatu != null and acceptStatu != ''">
				and ca.acceptStatu = #{acceptStatu} 
			</if>
			<if test="traceStatu != null and traceStatu != ''">
				and (ca.traceStatu = #{traceStatu} or ca.traceStatu = 4)
				and (IFNULL(rc.cusLostInsurStatu,0) != 2 or (ca.delayDate is not null and ca.delayDate >= CURDATE()))
				and u.roleId != 5
				<if test="traceStatu == 2">
					AND ca.traceDate =  CURDATE()
				</if> 
			</if>
			<if test="cusLostInsurStatu != null and cusLostInsurStatu != ''">
				and rc.cusLostInsurStatu = #{cusLostInsurStatu}
				and u.roleId != 5
			</if> 
			<if test="storeId != null and storeId != ''">
				and rc.fourSStoreId = #{storeId}
			</if>
			<if test="userId != null and userId != ''">
				and u.id = #{userId}
			</if>
			<if test="roleId != null and roleId != ''">
				and u.roleId = #{roleId}
			</if>
			<if test="renewalType != null and renewalType != ''">
					and rc.renewalType = #{renewalType}
			</if>
			<if test="insuranceCompLY != null and insuranceCompLY !=''">
				and rc.insuranceCompLY = #{insuranceCompLY}
			</if>
			<if test="customerLevel != null and customerLevel !=''">
				and rc.customerLevel = #{customerLevel}
			</if>
			<if test="insuranceEndDateStart != null and insuranceEndDateStart !=''">
				<![CDATA[and rc.insuranceEndDate >=  #{insuranceEndDateStart}]]>
			</if>
			<if test="insuranceEndDateEnd != null and insuranceEndDateEnd !=''">
				<![CDATA[and rc.insuranceEndDate <=  #{insuranceEndDateEnd}]]>
			</if>
			<if test="contact != null and contact !=''">
				and rc.contact = #{contact}
			</if>
			<if test="contactWay != null and contactWay !=''">
				and rc.contactWay like '%${contactWay}%'
			</if>
			<if test="carBrand != null and carBrand !=''">
				and rc.carBrand = #{carBrand}
			</if>
			<if test="vehicleModel != null and vehicleModel !=''">
				and rc.vehicleModel = #{vehicleModel}
			</if>
			<if test="chassisNumber != null and chassisNumber !=''">
				and rc.chassisNumber like '%${chassisNumber}%'
			</if>
			<if test="carLicenseNumber != null and carLicenseNumber !=''">
				and rc.carLicenseNumber like '%${carLicenseNumber}%'
			</if>
			<if test="insured != null and insured != ''">
				and rc.insured = #{insured}
			</if>
			<if test="carOwner != null and carOwner !=''">
				and rc.carOwner like '%${carOwner}%' 
			</if>
			<if test="ifLoan != null and ifLoan !=''">
				and rc.ifLoan = #{ifLoan}
			</if>
		</where>
	</select>
	<!-- 查询今日发起邀约潜客数 -->
	<select id="findInviteToday" resultType="java.lang.Integer" parameterType="java.util.HashMap">
		SELECT count(1)
		FROM bf_bip_renewaling_customer a
		LEFT JOIN bf_bip_customer_assign b ON b.customerId = a.customerId
		WHERE b.inviteStatu = 2
			AND b.inviteDate = CURDATE()
			AND a.fourSStoreId = #{storeId}
	</select>
	
	<select id="findJRYYCustomerListByUserId" resultType="java.util.Map" parameterType="java.util.HashMap">
		SELECT
			a.contact,a.contactWay,a.customerLevel,a.sfgyx,a.lastTraceResult,a.carLicenseNumber,a.customerId,a.inviteDate,b.userId holderId,
			b.returnStatu,b.delayDate,a.chassisNumber
		FROM
			bf_bip_renewaling_customer a,
			bf_bip_customer_assign b
			inner join bf_bip_user u on u.id = b.userId
		<where>
				a.customerId = b.customerId
			AND b.inviteStatu = 2
			AND b.inviteDate = CURDATE()
			<if test="userId != null">
				AND b.userId = #{userId}
			</if>
			<if test="roleId != null">
				AND u.roleId = #{roleId}
			</if>
			<if test="storeId != null">
				AND a.fourSStoreId = #{storeId}
			</if>
			<if test="renewalType != null and renewalType != ''">
					and a.renewalType = #{renewalType}
			</if>
			<if test="insuranceCompLY != null and insuranceCompLY !=''">
				and a.insuranceCompLY = #{insuranceCompLY}
			</if>
			<if test="customerLevel != null and customerLevel !=''">
				and a.customerLevel = #{customerLevel}
			</if>
			<if test="insuranceEndDateStart != null and insuranceEndDateStart !=''">
				<![CDATA[and a.insuranceEndDate >=  #{insuranceEndDateStart}]]>
			</if>
			<if test="insuranceEndDateEnd != null and insuranceEndDateEnd !=''">
				<![CDATA[and a.insuranceEndDate <=  #{insuranceEndDateEnd}]]>
			</if>
			<if test="contact != null and contact !=''">
				and a.contact = #{contact}
			</if>
			<if test="contactWay != null and contactWay !=''">
				and a.contactWay like '%${contactWay}%'
			</if>
			<if test="carBrand != null and carBrand !=''">
				and a.carBrand = #{carBrand}
			</if>
			<if test="vehicleModel != null and vehicleModel !=''">
				and a.vehicleModel = #{vehicleModel}
			</if>
			<if test="chassisNumber != null and chassisNumber !=''">
				and a.chassisNumber like '%${chassisNumber}%'
			</if>
			<if test="carLicenseNumber != null and carLicenseNumber !=''">
				and a.carLicenseNumber like '%${carLicenseNumber}%'
			</if>
			<if test="insured != null and insured != ''">
				and a.insured = #{insured}
			</if>
			<if test="carOwner != null and carOwner !=''">
				and a.carOwner like '%${carOwner}%' 
			</if>
			ORDER BY a.insuranceEndDate LIMIT #{start,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}
		</where>
	</select>
	
	<select id="findJRYYCustomerListCountByUserId" resultType="Integer" parameterType="java.util.HashMap">
		SELECT
			count(1)
		FROM
			bf_bip_renewaling_customer a,
			bf_bip_customer_assign b
			inner join bf_bip_user u on u.id = b.userId
		<where>
				a.customerId = b.customerId
			AND b.inviteStatu = 2
			AND b.inviteDate = CURDATE()
			<if test="userId != null">
				AND b.userId = #{userId}
			</if>
			<if test="roleId != null">
				AND u.roleId = #{roleId}
			</if>
			<if test="storeId != null">
				AND a.fourSStoreId = #{storeId}
			</if>
			<if test="renewalType != null and renewalType != ''">
					and a.renewalType = #{renewalType}
			</if>
			<if test="insuranceCompLY != null and insuranceCompLY !=''">
				and a.insuranceCompLY = #{insuranceCompLY}
			</if>
			<if test="customerLevel != null and customerLevel !=''">
				and a.customerLevel = #{customerLevel}
			</if>
			<if test="insuranceEndDateStart != null and insuranceEndDateStart !=''">
				<![CDATA[and a.insuranceEndDate >=  #{insuranceEndDateStart}]]>
			</if>
			<if test="insuranceEndDateEnd != null and insuranceEndDateEnd !=''">
				<![CDATA[and a.insuranceEndDate <=  #{insuranceEndDateEnd}]]>
			</if>
			<if test="contact != null and contact !=''">
				and a.contact = #{contact}
			</if>
			<if test="contactWay != null and contactWay !=''">
				and a.contactWay like '%${contactWay}%'
			</if>
			<if test="carBrand != null and carBrand !=''">
				and a.carBrand = #{carBrand}
			</if>
			<if test="vehicleModel != null and vehicleModel !=''">
				and a.vehicleModel = #{vehicleModel}
			</if>
			<if test="chassisNumber != null and chassisNumber !=''">
				and a.chassisNumber like '%${chassisNumber}%'
			</if>
			<if test="carLicenseNumber != null and carLicenseNumber !=''">
				and a.carLicenseNumber like '%${carLicenseNumber}%'
			</if>
			<if test="insured != null and insured != ''">
				and a.insured = #{insured}
			</if>
			<if test="carOwner != null and carOwner !=''">
				and a.carOwner like '%${carOwner}%' 
			</if>
		</where>
	</select>
	
	<!-- 已激活查询 -->
	<select id="findByJiHuo" resultMap="BaseResultMap" parameterType="java.util.HashMap">
		SELECT
			a.fourSStoreId,
			a.insuranceEndDate,
			a.renewalType,
			a.customerLevel,
			a.contact,
			a.contactWay,
			a.principalId,
			a.principal,
			a.clerkId,
			a.clerk,
			a.status,
			a.cusLostInsurStatu,
			a.carLicenseNumber,
			a.virtualJqxdqr,
			f.lastTraceDate,
			f.willingTraceDate,
			f.lastTraceResult,
			a.lastYearIsDeal,
			a.chassisNumber,
			f.firstAcceptDate,
			a.factoryLicenseType,
			a.carAnnualCheckUpDate,
			a.insuredLY,
			a.buyfromThisStore,
			a.gotThroughNum,
			a.contactWayReserve,
			a.sfgyx,
			b.coverTypeName,
			a.customerId,
			e.traceStatu,
			e.traceDate,
			e.inviteStatu,
			e.inviteDate,
			e.acceptStatu,
			e.acceptDate,
			e.returnStatu,
			e.returnDate,
			e.customerTraceId,
			e.assignDate,
			e.delayDate,
			d.userName holder,
			d.id holderId,
			d.roleId holderRoleId
		FROM
			bf_bip_cover_type b,
			bf_bip_operation_record c,
			bf_bip_customer a
		LEFT JOIN bf_bip_renewaling_customer f ON a.customerId = f.customerId
		LEFT JOIN bf_bip_customer_assign e ON a.customerId = e.customerId AND IFNULL(e.traceStatu, 0) != 3
		LEFT JOIN bf_bip_user d ON d.id = e.userId
		 <where>
	  	 	a.renewalType = b.coverType
			AND a.customerId = c.customerId
			AND c.operationFlag = 3
		  	<if test="storeId != null and storeId != ''">
		  		and a.fourSStoreId = #{storeId}
		  	</if>
		  	<if test="userId != null and userId != ''">
		  		and c.userId = #{userId}
		  	</if>
		  	<if test="startTime != null and startTime != ''">
		  		<![CDATA[and c.operationDate >= #{startTime,jdbcType=DATE}]]>
		  	</if> 
		  	<if test="endTime != null and endTime != ''">
		  		<![CDATA[and c.operationDate <= #{endTime,jdbcType=DATE}]]>
		  	</if>
		  	<if test="renewalType != null and renewalType != ''">
		  		and a.renewalType = #{renewalType}
		  	</if>
		  	<if test="holder != null and holder != ''">
		  		and d.userName = #{holder}
		  	</if>
		  	<if test="roleId != null and roleId != ''">
		  		and d.roleId = #{roleId}
		  	</if>
		  	<if test="chassisNumber != null and chassisNumber != ''">
		  		and a.chassisNumber like '%${chassisNumber}%'
		  	</if>
		  	<if test="contact != null and contact != ''">
		  		and a.contact = #{contact}
		  	</if>
		  	<if test="contactWay != null and contactWay != ''">
		  		and (a.contactWay like '%${contactWay}%'
	 		        or a.contactWayReserve like '%${contactWay}%'
	 		    )
		  	</if>
		  	<if test="carLicenseNumber != null and carLicenseNumber != ''">
		  		and a.carLicenseNumber like '%${carLicenseNumber}%'
		  	</if>
	  	 </where>
	  	 <!-- short代表按某字段排序，shortmain 1：升序，2：降序 -->
  	    <if test="short==2 and shortmain==1">ORDER BY a.principal ASC</if>
  	    <if test="short==2 and shortmain==2">ORDER BY a.principal DESC</if>
  	    <if test="short==3 and shortmain==1">ORDER BY a.clerk ASC</if>
  	    <if test="short==3 and shortmain==2">ORDER BY a.clerk DESC</if>
  	    <if test="short==4 and shortmain==1">ORDER BY a.contact ASC</if>
  	    <if test="short==4 and shortmain==2">ORDER BY a.contact DESC</if>
  	    <if test="short==5 and shortmain==1">ORDER BY a.contactWay ASC</if>
  	    <if test="short==5 and shortmain==2">ORDER BY a.contactWay DESC</if>
  	    <if test="short==6 and shortmain==1">ORDER BY a.chassisNumber ASC</if>
  	    <if test="short==6 and shortmain==2">ORDER BY a.chassisNumber DESC</if>
  	    <if test="short==7 and shortmain==1">ORDER BY a.carLicenseNumber ASC</if>
  	    <if test="short==7 and shortmain==2">ORDER BY a.carLicenseNumber DESC</if>
  	    <if test="short==8 and shortmain==1">ORDER BY b.coverTypeName ASC</if>
  	    <if test="short==8 and shortmain==2">ORDER BY b.coverTypeName DESC</if>
  	    <if test="short==9 and shortmain==1">ORDER BY DATE_FORMAT(a.insuranceEndDate,'%m-%d') ASC</if>
  	    <if test="short==9 and shortmain==2">ORDER BY DATE_FORMAT(a.insuranceEndDate,'%m-%d') DESC</if>
  	    <if test="short==10 and shortmain==1">ORDER BY a.bhUpdateTime ASC</if>
  	    <if test="short==10 and shortmain==2">ORDER BY a.bhUpdateTime DESC</if>
  	    <if test="short==11 and shortmain==1"> ORDER BY f.customerLevel ASC</if>
  	    <if test="short==11 and shortmain==2"> ORDER BY f.customerLevel DESC</if>
  	    <if test="short==12 and shortmain==1">ORDER BY a.gotThroughNum ASC</if>
  	    <if test="short==12 and shortmain==2">ORDER BY a.gotThroughNum DESC</if>
  	    <if test="short==13 and shortmain==1">ORDER BY f.willingTraceDate ASC</if>
  	    <if test="short==13 and shortmain==2">ORDER BY f.willingTraceDate DESC</if>
  	    <if test="short==14 and shortmain==1">ORDER BY f.lastTraceDate ASC</if>
  	    <if test="short==14 and shortmain==2">ORDER BY f.lastTraceDate DESC</if>
  	    <if test="short==15 and shortmain==1">ORDER BY f.lastTraceResult ASC</if>
  	    <if test="short==15 and shortmain==2">ORDER BY f.lastTraceResult DESC</if>
  	    <if test="short==16 and shortmain==1">ORDER BY e.delayDate ASC</if>
  	    <if test="short==16 and shortmain==2">ORDER BY e.delayDate DESC</if>
  	    <if test="short==17 and shortmain==1">ORDER BY f.virtualJqxdqr ASC</if>
  	    <if test="short==17 and shortmain==2">ORDER BY f.virtualJqxdqr DESC</if>
  	    <if test="short==18 and shortmain==1">ORDER BY e.assignDate ASC</if>
  	    <if test="short==18 and shortmain==2">ORDER BY e.assignDate DESC</if>
  	    <if test="short==19 and shortmain==1">ORDER BY holder ASC</if>
  	    <if test="short==19 and shortmain==2">ORDER BY holder DESC</if>
	  	 LIMIT #{start,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}
  	</select>
  	<!-- 已激活查询总数 -->
	<select id="countFindByJiHuo" resultType="java.lang.Integer" parameterType="java.util.HashMap">
  	 	SELECT
			count(a.customerId)
		FROM
			bf_bip_cover_type b,
			bf_bip_operation_record c,
			bf_bip_customer a
		LEFT JOIN bf_bip_renewaling_customer f ON a.customerId = f.customerId
		LEFT JOIN bf_bip_customer_assign e ON a.customerId = e.customerId AND IFNULL(e.traceStatu, 0) != 3
		LEFT JOIN bf_bip_user d ON d.id = e.userId
		 	<where>
	  	 		a.renewalType = b.coverType
				AND a.customerId = c.customerId
				AND c.operationFlag = 3
	  		<if test="storeId != null and storeId != ''">
	  			and a.fourSStoreId = #{storeId}
	  		</if>
	  		<if test="userId != null and userId != ''">
	  			and c.userId = #{userId}
	  		</if>
	  		<if test="startTime != null and startTime != ''">
	  			<![CDATA[and c.operationDate >= #{startTime,jdbcType=DATE}]]>
	  		</if> 
	  		<if test="endTime != null and endTime != ''">
	  			<![CDATA[and c.operationDate <= #{endTime,jdbcType=DATE}]]>
	  		</if>
	  		<if test="renewalType != null and renewalType != ''">
	  			and a.renewalType = #{renewalType}
	  		</if>
	  		<if test="holder != null and holder != ''">
	  			and d.userName = #{holder}
	  		</if>
	  		<if test="roleId != null and roleId != ''">
		  		and d.roleId = #{roleId}
		  	</if>
	  		<if test="chassisNumber != null and chassisNumber != ''">
	  			and a.chassisNumber like '%${chassisNumber}%'
	  		</if>
	  		<if test="contact != null and contact != ''">
	  			and a.contact = #{contact}
	  		</if>
	  		<if test="contactWay != null and contactWay != ''">
	  			and (a.contactWay like '%${contactWay}%'
	 		        or a.contactWayReserve like '%${contactWay}%'
	 		    )
	  		</if>
	  		<if test="carLicenseNumber != null and carLicenseNumber != ''">
	  			and a.carLicenseNumber like '%${carLicenseNumber}%'
	  		</if>
  	 	</where>
  	</select>
  	
  	<!-- 查询到店未出单潜客 -->
  	<select id="findDdwcdCus" resultMap="BaseResultMap" parameterType="java.util.HashMap">
		SELECT
			t.*, u.userName holder,u.id holderId,u.roleId holderRoleId
		FROM(
	  	 	SELECT
				a.fourSStoreId,
				a.insuranceEndDate,
				a.renewalType,
				a.customerLevel,
				a.contact,
				a.contactWay,
				a.principalId,
				a.principal,
				a.clerkId,
				a.clerk,
				a.status,
				a.cusLostInsurStatu,
				a.carLicenseNumber,
				a.virtualJqxdqr,
				a.lastTraceDate,
				a.willingTraceDate,
				a.lastTraceResult,
				a.lastYearIsDeal,
				a.chassisNumber,
				a.firstAcceptDate,
				a.factoryLicenseType,
				a.carAnnualCheckUpDate,
				a.insuredLY,
				a.buyfromThisStore,
				a.gotThroughNum,
				a.contactWayReserve,
				a.sfgyx,
				b.coverTypeName,
				a.customerId,
				e.userId,
				e.traceStatu,
				e.traceDate,
				e.inviteStatu,
				e.inviteDate,
				e.acceptStatu,
				e.acceptDate,
				e.returnStatu,
				e.returnDate,
				e.customerTraceId,
				e.assignDate,
				e.delayDate
			FROM
				bf_bip_cover_type b,
				bf_bip_user d,
				bf_bip_renewaling_customer a,
				bf_bip_customer_assign e
			<where>
	  	 		a.renewalType = b.coverType
				AND a.customerId = e.customerId
				AND e.userId = d.id
				AND a.customerLevel !='O'
				AND IFNULL(a.comeStoreDate, 0) !=0
				AND IFNULL(e.traceStatu,0) != 3
		  		<if test="storeId != null and storeId != ''">
		  			and a.fourSStoreId = #{storeId}
		  		</if>
		  		<if test="userId != null and userId != ''">
		  			and d.id = #{userId}
		  		</if>
		  		<if test="startTime != null and startTime != ''">
		  			<![CDATA[and a.comeStoreDate >= #{startTime,jdbcType=DATE}]]>
		  		</if> 
		  		<if test="endTime != null and endTime != ''">
		  			<![CDATA[and a.comeStoreDate <= #{endTime,jdbcType=DATE}]]>
		  		</if>
		  		<if test="renewalType != null and renewalType != ''">
		  			and a.renewalType = #{renewalType}
		  		</if>
		  		<if test="holder != null and holder != ''">
		  			and d.userName = #{holder}
		  		</if>
		  		<if test="roleId != null and roleId != ''">
		  			and d.roleId = #{roleId}
		  		</if>
		  		<if test="chassisNumber != null and chassisNumber != ''">
		  			and a.chassisNumber like '%${chassisNumber}%'
		  		</if>
		  		<if test="contact != null and contact != ''">
		  			and a.contact = #{contact}
		  		</if>
		  		<if test="contactWay != null and contactWay != ''">
		  			and (a.contactWay like '%${contactWay}%'
	 		        or a.contactWayReserve like '%${contactWay}%'
	 		    )
		  		</if>
		  		<if test="carLicenseNumber != null and carLicenseNumber != ''">
		  			and a.carLicenseNumber like '%${carLicenseNumber}%'
		  		</if>
	  	 	</where>
	  	 	<!-- short代表按某字段排序，shortmain 1：升序，2：降序 -->
		  	 	<if test="short==2 and shortmain==1">ORDER BY a.principal ASC</if>
		  	    <if test="short==2 and shortmain==2">ORDER BY a.principal DESC</if>
		  	    <if test="short==3 and shortmain==1">ORDER BY a.clerk ASC</if>
		  	    <if test="short==3 and shortmain==2">ORDER BY a.clerk DESC</if>
		  	    <if test="short==4 and shortmain==1">ORDER BY a.contact ASC</if>
		  	    <if test="short==4 and shortmain==2">ORDER BY a.contact DESC</if>
		  	    <if test="short==5 and shortmain==1">ORDER BY a.contactWay ASC</if>
		  	    <if test="short==5 and shortmain==2">ORDER BY a.contactWay DESC</if>
		  	    <if test="short==6 and shortmain==1">ORDER BY a.chassisNumber ASC</if>
		  	    <if test="short==6 and shortmain==2">ORDER BY a.chassisNumber DESC</if>
		  	    <if test="short==7 and shortmain==1">ORDER BY a.carLicenseNumber ASC</if>
		  	    <if test="short==7 and shortmain==2">ORDER BY a.carLicenseNumber DESC</if>
		  	    <if test="short==8 and shortmain==1">ORDER BY b.coverTypeName ASC</if>
		  	    <if test="short==8 and shortmain==2">ORDER BY b.coverTypeName DESC</if>
		  	    <if test="short==9 and shortmain==1">ORDER BY DATE_FORMAT(a.insuranceEndDate,'%m-%d') ASC</if>
		  	    <if test="short==9 and shortmain==2">ORDER BY DATE_FORMAT(a.insuranceEndDate,'%m-%d') DESC</if>
		  	    <if test="short==10 and shortmain==1">ORDER BY a.bhUpdateTime ASC</if>
		  	    <if test="short==10 and shortmain==2">ORDER BY a.bhUpdateTime DESC</if>
		  	    <if test="short==11 and shortmain==1"> ORDER BY a.customerLevel ASC</if>
  	            <if test="short==11 and shortmain==2"> ORDER BY a.customerLevel DESC</if>
		  	    <if test="short==12 and shortmain==1">ORDER BY a.gotThroughNum ASC</if>
		  	    <if test="short==12 and shortmain==2">ORDER BY a.gotThroughNum DESC</if>
		  	    <if test="short==13 and shortmain==1">ORDER BY a.willingTraceDate ASC</if>
		  	    <if test="short==13 and shortmain==2">ORDER BY a.willingTraceDate DESC</if>
		  	    <if test="short==14 and shortmain==1">ORDER BY a.lastTraceDate ASC</if>
		  	    <if test="short==14 and shortmain==2">ORDER BY a.lastTraceDate DESC</if>
		  	    <if test="short==15 and shortmain==1">ORDER BY a.lastTraceResult ASC</if>
		  	    <if test="short==15 and shortmain==2">ORDER BY a.lastTraceResult DESC</if>
		  	    <if test="short==16 and shortmain==1">ORDER BY e.delayDate ASC</if>
		  	    <if test="short==16 and shortmain==2">ORDER BY e.delayDate DESC</if>
		  	    <if test="short==17 and shortmain==1">ORDER BY a.virtualJqxdqr ASC</if>
		  	    <if test="short==17 and shortmain==2">ORDER BY a.virtualJqxdqr DESC</if>
		  	    <if test="short==18 and shortmain==1">ORDER BY e.assignDate ASC</if>
		  	    <if test="short==18 and shortmain==2">ORDER BY e.assignDate DESC</if>
		  	    <if test="short==19 and shortmain==1">ORDER BY d.userName ASC</if>
		  	    <if test="short==19 and shortmain==2">ORDER BY d.userName DESC</if>
	  	 	LIMIT #{start,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}
	  	 	)AS t
		LEFT JOIN bf_bip_user u ON t.userId = u.id
	</select>
	
	<!-- 上个查询的总数 -->
  	<select id="countDdwcdCus" resultType="java.lang.Integer" parameterType="java.util.HashMap">
		SELECT
			count(a.customerId)
		FROM
			bf_bip_cover_type b,
			bf_bip_user d,
			bf_bip_renewaling_customer a,
			bf_bip_customer_assign e
		<where>
	  	 	a.renewalType = b.coverType
			AND a.customerId = e.customerId
			AND e.userId = d.id
			AND a.customerLevel !='O'
			AND IFNULL(a.comeStoreDate, 0) !=0
			AND IFNULL(e.traceStatu,0) != 3
		  	<if test="storeId != null and storeId != ''">
		  		and a.fourSStoreId = #{storeId}
		  	</if>
		  	<if test="userId != null and userId != ''">
		  		and d.id = #{userId}
		  	</if>
		  	<if test="startTime != null and startTime != ''">
		  		<![CDATA[and a.comeStoreDate >= #{startTime,jdbcType=DATE}]]>
		  	</if> 
		  	<if test="endTime != null and endTime != ''">
		  		<![CDATA[and a.comeStoreDate <= #{endTime,jdbcType=DATE}]]>
		  	</if>
		  	<if test="renewalType != null and renewalType != ''">
		  		and a.renewalType = #{renewalType}
		  	</if>
		  	<if test="holder != null and holder != ''">
		  		and d.userName = #{holder}
		  	</if>
		  	<if test="roleId != null and roleId != ''">
		  		and d.roleId = #{roleId}
		  	</if>
		  	<if test="chassisNumber != null and chassisNumber != ''">
		  		and a.chassisNumber like '%${chassisNumber}%'
		  	</if>
		  	<if test="contact != null and contact != ''">
		  		and a.contact = #{contact}
		  	</if>
		  	<if test="contactWay != null and contactWay != ''">
		  		and (a.contactWay like '%${contactWay}%'
	 		        or a.contactWayReserve like '%${contactWay}%'
	 		    )
		  	</if>
		  	<if test="carLicenseNumber != null and carLicenseNumber != ''">
		  		and a.carLicenseNumber like '%${carLicenseNumber}%'
		  	</if>
	  	 </where>
	</select>
	
	<!-- 前台主管按不同状态查询潜客 -->
	<select id="findByStatusQtzg" resultMap="BaseResultMap" parameterType="java.util.HashMap">
		SELECT rc.*,ct.coverTypeName,
		<choose>
			<when test="returnStatu != null and returnStatu == 2 or returnStatu ==11">
				ca1.*,u1.userName holder,u1.id holderId,u1.roleId holderRoleId 
			</when>
			<otherwise>
				ca.*,u.userName holder,u.id holderId,u.roleId holderRoleId 
			</otherwise>
		</choose>
		FROM bf_bip_renewaling_customer rc 
		LEFT JOIN bf_bip_cover_type ct ON ct.coverType = rc.renewalType 
		LEFT JOIN bf_bip_customer_assign ca ON ca.customerId = rc.customerId 
		INNER JOIN bf_bip_user u ON u.id = ca.userId 
		<if test="returnStatu != null and returnStatu == 2 or returnStatu ==11">
			LEFT JOIN bf_bip_customer_assign ca1 ON ca1.customerId = rc.customerId and ifnull(ca1.traceStatu, 0) != 3
			INNER JOIN bf_bip_user u1 ON u1.id = ca1.userId 
		</if> 
		WHERE rc.fourSStoreId = #{storeId} AND u.roleId = 8
			<if test="traceStatu != null and traceStatu != ''">
				AND (ifnull(rc.cusLostInsurStatu,0) != 2 or (ca.delayDate is not null and ca.delayDate >= CURDATE()))
				AND (ca.traceStatu = #{traceStatu,jdbcType=INTEGER} or ca.traceStatu = 4)
				AND rc.customerLevel not in ('S','F','O')
			</if> 
			<if test="cusLostInsurStatu != null and cusLostInsurStatu != ''">
				AND ifnull(traceStatu, 0) != 3
				AND rc.cusLostInsurStatu = #{cusLostInsurStatu,jdbcType=INTEGER}
			</if> 
			<if test="acceptStatu != null and acceptStatu != ''">
				AND ifnull(traceStatu, 0) != 3
				AND ca.acceptStatu = #{acceptStatu,jdbcType=INTEGER}
			</if>
			<if test="returnStatu != null and returnStatu != ''">
				<if test="returnStatu == 3">
					AND ifnull(traceStatu, 0) != 3
					AND ca.returnStatu = #{returnStatu,jdbcType=INTEGER}
				</if>
				<if test="returnStatu == 2 or returnStatu ==11">
					AND ca.returnStatu = #{returnStatu,jdbcType=INTEGER}
				</if>
			</if> 
			<if test="startTime != null and startTime != ''">
				<![CDATA[and ca.traceDate >= #{startTime,jdbcType=DATE}]]>
			</if> 
			<if test="endTime != null and endTime != ''">
				<![CDATA[and ca.traceDate <= #{endTime,jdbcType=DATE}]]>
			</if>
			<!-- 添加查询条件过滤 -->
			<if test="renewalType != null and renewalType != ''">
				and rc.renewalType = #{renewalType}
			</if>
			<if test="holder != null and holder != ''">
				and u.userName = #{holder}
			</if>
			<if test="chassisNumber != null and chassisNumber != ''">
				and rc.chassisNumber like '%${chassisNumber}%'
			</if>
			<if test="contact != null and contact != ''">
				and rc.contact = #{contact}
			</if>
			<if test="contactWay != null and contactWay != ''">
				and (rc.contactWay like '%${contactWay}%'
	 		        or rc.contactWayReserve like '%${contactWay}%'
	 		    )
			</if>
			<if test="carLicenseNumber != null and carLicenseNumber != ''">
				and rc.carLicenseNumber like '%${carLicenseNumber}%'
			</if>
			<if test="ifLoan != null">
				and rc.ifLoan = #{ifLoan}
			</if>
			<if test="qnbfSort != null and qnbfSort == 1">
				ORDER BY rc.insuranceCoverageLY DESC
			</if>
			<!-- <if test="qnbfSort == null or qnbfSort == 0 ">
				ORDER BY rc.virtualJqxdqr
			</if> -->
			<!-- short代表按某字段排序，shortmain 1：升序，2：降序 -->
			<if test="(qnbfSort==null or qnbfSort == 0) and short==null and shortmain==null"> ORDER BY rc.virtualJqxdqr</if>
	  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==2 and shortmain==1"> ORDER BY rc.principal ASC</if>
	  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==2 and shortmain==2"> ORDER BY rc.principal DESC</if>
	  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==3 and shortmain==1"> ORDER BY rc.clerk ASC</if>
	  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==3 and shortmain==2"> ORDER BY rc.clerk DESC</if>
	  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==4 and shortmain==1"> ORDER BY rc.contact ASC</if>
	  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==4 and shortmain==2"> ORDER BY rc.contact DESC</if>
	  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==5 and shortmain==1"> ORDER BY rc.contactWay ASC</if>
	  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==5 and shortmain==2"> ORDER BY rc.contactWay DESC</if>
	  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==6 and shortmain==1"> ORDER BY rc.chassisNumber ASC</if>
	  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==6 and shortmain==2"> ORDER BY rc.chassisNumber DESC</if>
	  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==7 and shortmain==1"> ORDER BY rc.carLicenseNumber ASC</if>
	  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==7 and shortmain==2"> ORDER BY rc.carLicenseNumber DESC</if>
	  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==8 and shortmain==1"> ORDER BY ct.coverTypeName ASC</if>
	  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==8 and shortmain==2"> ORDER BY ct.coverTypeName DESC</if>
	  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==9 and shortmain==1"> ORDER BY DATE_FORMAT(rc.insuranceEndDate,'%m-%d') ASC</if>
	  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==9 and shortmain==2"> ORDER BY DATE_FORMAT(rc.insuranceEndDate,'%m-%d') DESC</if>
	  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==10 and shortmain==1"> ORDER BY rc.bhUpdateTime ASC</if>
	  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==10 and shortmain==2"> ORDER BY rc.bhUpdateTime DESC</if>
	  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==11 and shortmain==1"> ORDER BY rc.customerLevel ASC</if>
	  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==11 and shortmain==2"> ORDER BY rc.customerLevel DESC</if> 
	  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==12 and shortmain==1"> ORDER BY rc.gotThroughNum ASC</if>
	  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==12 and shortmain==2"> ORDER BY rc.gotThroughNum DESC</if>
	  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==13 and shortmain==1"> ORDER BY rc.willingTraceDate ASC</if>
	  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==13 and shortmain==2"> ORDER BY rc.willingTraceDate DESC</if>
	  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==14 and shortmain==1"> ORDER BY rc.lastTraceDate ASC</if>
	  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==14 and shortmain==2"> ORDER BY rc.lastTraceDate DESC</if>
	  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==15 and shortmain==1"> ORDER BY rc.lastTraceResult ASC</if>
	  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==15 and shortmain==2"> ORDER BY rc.lastTraceResult DESC</if>
	  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==16 and shortmain==1"> ORDER BY ca.delayDate ASC</if>
	  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==16 and shortmain==2"> ORDER BY ca.delayDate DESC</if>
	  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==17 and shortmain==1"> ORDER BY rc.virtualJqxdqr ASC</if>
	  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==17 and shortmain==2"> ORDER BY rc.virtualJqxdqr DESC</if>
	  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==18 and shortmain==1"> ORDER BY ca.assignDate ASC</if>
	  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==18 and shortmain==2"> ORDER BY ca.assignDate DESC</if>
	  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==19 and shortmain==1"> ORDER BY holder ASC</if>
	  	    <if test="(qnbfSort==null or qnbfSort == 0) and short==19 and shortmain==2"> ORDER BY holder DESC</if>
	  	    <if test="qnbfSort != null and qnbfSort == 1 and short==null and shortmain==null"> , rc.virtualJqxdqr</if>
	  	    <if test="qnbfSort != null and qnbfSort == 1 and short==2 and shortmain==1"> , rc.principal ASC</if>
	  	    <if test="qnbfSort != null and qnbfSort == 1 and short==2 and shortmain==2"> , rc.principal DESC</if>
	  	    <if test="qnbfSort != null and qnbfSort == 1 and short==3 and shortmain==1"> , rc.clerk ASC</if>
	  	    <if test="qnbfSort != null and qnbfSort == 1 and short==3 and shortmain==2"> , rc.clerk DESC</if>
	  	    <if test="qnbfSort != null and qnbfSort == 1 and short==4 and shortmain==1"> , rc.contact ASC</if>
	  	    <if test="qnbfSort != null and qnbfSort == 1 and short==4 and shortmain==2"> , rc.contact DESC</if>
	  	    <if test="qnbfSort != null and qnbfSort == 1 and short==5 and shortmain==1"> , rc.contactWay ASC</if>
	  	    <if test="qnbfSort != null and qnbfSort == 1 and short==5 and shortmain==2"> , rc.contactWay DESC</if>
	  	    <if test="qnbfSort != null and qnbfSort == 1 and short==6 and shortmain==1"> , rc.chassisNumber ASC</if>
	  	    <if test="qnbfSort != null and qnbfSort == 1 and short==6 and shortmain==2"> , rc.chassisNumber DESC</if>
	  	    <if test="qnbfSort != null and qnbfSort == 1 and short==7 and shortmain==1"> , rc.carLicenseNumber ASC</if>
	  	    <if test="qnbfSort != null and qnbfSort == 1 and short==7 and shortmain==2"> , rc.carLicenseNumber DESC</if>
	  	    <if test="qnbfSort != null and qnbfSort == 1 and short==8 and shortmain==1"> , ct.coverTypeName ASC</if>
	  	    <if test="qnbfSort != null and qnbfSort == 1 and short==8 and shortmain==2"> , ct.coverTypeName DESC</if>
	  	    <if test="qnbfSort != null and qnbfSort == 1 and short==9 and shortmain==1"> , DATE_FORMAT(rc.insuranceEndDate,'%m-%d') ASC</if>
	  	    <if test="qnbfSort != null and qnbfSort == 1 and short==9 and shortmain==2"> , DATE_FORMAT(rc.insuranceEndDate,'%m-%d') DESC</if>
	  	    <if test="qnbfSort != null and qnbfSort == 1 and short==10 and shortmain==1"> , rc.bhUpdateTime ASC</if>
	  	    <if test="qnbfSort != null and qnbfSort == 1 and short==10 and shortmain==2"> , rc.bhUpdateTime DESC</if>
	  	    <if test="qnbfSort != null and qnbfSort == 1 and short==11 and shortmain==1"> , rc.customerLevel ASC</if>
	  	    <if test="qnbfSort != null and qnbfSort == 1 and short==11 and shortmain==2"> , rc.customerLevel DESC</if>
	  	    <if test="qnbfSort != null and qnbfSort == 1 and short==12 and shortmain==1"> , rc.gotThroughNum ASC</if>
	  	    <if test="qnbfSort != null and qnbfSort == 1 and short==12 and shortmain==2"> , rc.gotThroughNum DESC</if>
	  	    <if test="qnbfSort != null and qnbfSort == 1 and short==13 and shortmain==1"> , rc.willingTraceDate ASC</if>
	  	    <if test="qnbfSort != null and qnbfSort == 1 and short==13 and shortmain==2"> , rc.willingTraceDate DESC</if>
	  	    <if test="qnbfSort != null and qnbfSort == 1 and short==14 and shortmain==1"> , rc.lastTraceDate ASC</if>
	  	    <if test="qnbfSort != null and qnbfSort == 1 and short==14 and shortmain==2"> , rc.lastTraceDate DESC</if>
	  	    <if test="qnbfSort != null and qnbfSort == 1 and short==15 and shortmain==1"> , rc.lastTraceResult ASC</if>
	  	    <if test="qnbfSort != null and qnbfSort == 1 and short==15 and shortmain==2"> , rc.lastTraceResult DESC</if>
	  	    <if test="qnbfSort != null and qnbfSort == 1 and short==16 and shortmain==1"> , ca.delayDate ASC</if>
	  	    <if test="qnbfSort != null and qnbfSort == 1 and short==16 and shortmain==2"> , ca.delayDate DESC</if>
	  	    <if test="qnbfSort != null and qnbfSort == 1 and short==17 and shortmain==1"> , rc.virtualJqxdqr ASC</if>
	  	    <if test="qnbfSort != null and qnbfSort == 1 and short==17 and shortmain==2"> , rc.virtualJqxdqr DESC</if>
	  	    <if test="qnbfSort != null and qnbfSort == 1 and short==18 and shortmain==1"> , ca.assignDate ASC</if>
	  	    <if test="qnbfSort != null and qnbfSort == 1 and short==18 and shortmain==2"> , ca.assignDate DESC</if>
	  	    <if test="qnbfSort != null and qnbfSort == 1 and short==19 and shortmain==1"> , holder ASC</if>
	  	    <if test="qnbfSort != null and qnbfSort == 1 and short==19 and shortmain==2"> , holder DESC</if>
		LIMIT #{start,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}
	</select>
	<!-- 前台主管按不同状态查询潜客总数 -->
	<select id="findByStatusQtzgCount" resultType="Integer" parameterType="java.util.HashMap">
		SELECT count(1)
		FROM bf_bip_renewaling_customer rc 
		LEFT JOIN bf_bip_cover_type ct ON ct.coverType = rc.renewalType 
		LEFT JOIN bf_bip_customer_assign ca ON ca.customerId = rc.customerId 
		INNER JOIN bf_bip_user u ON u.id = ca.userId 
		<if test="returnStatu != null and returnStatu == 2 or returnStatu ==11">
			LEFT JOIN bf_bip_customer_assign ca1 ON ca1.customerId = rc.customerId and ifnull(ca1.traceStatu, 0) != 3
			INNER JOIN bf_bip_user u1 ON u1.id = ca1.userId 
		</if> 
		WHERE rc.fourSStoreId = #{storeId} AND u.roleId = 8
			<if test="traceStatu != null and traceStatu != ''">
				AND (ifnull(rc.cusLostInsurStatu,0) != 2 or (ca.delayDate is not null and ca.delayDate >= CURDATE()))
				AND (ca.traceStatu = #{traceStatu,jdbcType=INTEGER} or ca.traceStatu = 4)
				AND rc.customerLevel not in ('S','F','O')
			</if> 
			<if test="cusLostInsurStatu != null and cusLostInsurStatu != ''">
				AND ifnull(traceStatu, 0) != 3
				AND rc.cusLostInsurStatu = #{cusLostInsurStatu,jdbcType=INTEGER}
			</if> 
			<if test="acceptStatu != null and acceptStatu != ''">
				AND ifnull(traceStatu, 0) != 3
				AND ca.acceptStatu = #{acceptStatu,jdbcType=INTEGER}
			</if>
			<if test="returnStatu != null and returnStatu != ''">
				<if test="returnStatu == 3">
					AND ifnull(traceStatu, 0) != 3
					AND ca.returnStatu = #{returnStatu,jdbcType=INTEGER}
				</if>
				<if test="returnStatu == 2 or returnStatu ==11">
					AND ca.returnStatu = #{returnStatu,jdbcType=INTEGER}
				</if>
			</if> 
			<if test="startTime != null and startTime != ''">
				<![CDATA[and ca.traceDate >= #{startTime,jdbcType=DATE}]]>
			</if> 
			<if test="endTime != null and endTime != ''">
				<![CDATA[and ca.traceDate <= #{endTime,jdbcType=DATE}]]>
			</if>
			<!-- 添加查询条件过滤 -->
			<if test="renewalType != null and renewalType != ''">
				and rc.renewalType = #{renewalType}
			</if>
			<if test="holder != null and holder != ''">
				and u.userName = #{holder}
			</if>
			<if test="chassisNumber != null and chassisNumber != ''">
				and rc.chassisNumber like '%${chassisNumber}%'
			</if>
			<if test="contact != null and contact != ''">
				and rc.contact = #{contact}
			</if>
			<if test="contactWay != null and contactWay != ''">
				and (rc.contactWay like '%${contactWay}%'
	 		        or rc.contactWayReserve like '%${contactWay}%'
	 		    )
			</if>
			<if test="carLicenseNumber != null and carLicenseNumber != ''">
				and rc.carLicenseNumber like '%${carLicenseNumber}%'
			</if>
			<if test="ifLoan != null">
				and rc.ifLoan = #{ifLoan}
			</if>
	</select>
	<!-- 前台主管的潜客查询 -->
	<select id="findByConditionQtzg" resultMap="BaseResultMap" parameterType="java.util.HashMap" >
		SELECT rc.*,ct.coverTypeName,ca.*,u.userName holder
		FROM bf_bip_renewaling_customer rc
		LEFT JOIN bf_bip_cover_type ct ON ct.coverType = rc.renewalType
		LEFT JOIN bf_bip_customer_assign ca ON ca.customerId = rc.customerId 
		INNER JOIN bf_bip_user u ON u.id = ca.userId 
		<where>
			fourSStoreId = #{fourSStoreId}
			and traceStatu != 3
			and acceptStatu != 1
			and ifnull(returnStatu,0) not in (2,5) 
			and u.roleId = 8 
			<if test="condition.carBrand != null and condition.carBrand !=''">
				and rc.carBrand = #{condition.carBrand}
			</if>
			<if test="condition.vehicleModel != null and condition.vehicleModel !=''">
				and rc.vehicleModel = #{condition.vehicleModel}
			</if>
			<if test="condition.chassisNumber != null and condition.chassisNumber !=''">
				and rc.chassisNumber like '%${condition.chassisNumber}%'
			</if>
			<if test="condition.carLicenseNumber != null and condition.carLicenseNumber !=''">
				and rc.carLicenseNumber like '%${condition.carLicenseNumber}%'
			</if>
			<if test="condition.insured != null and condition.insured !=''">
				and rc.insured = #{condition.insured}
			</if>
			<if test="condition.contact != null and condition.contact !=''">
				and rc.contact = #{condition.contact}
			</if>
			<if test="condition.contactWay != null and condition.contactWay !=''">
				and rc.contactWay like '%${condition.contactWay}%'
			</if>
			<if test="condition.insuranceCompLY != null and condition.insuranceCompLY !=''">
				and rc.insuranceCompLY = #{condition.insuranceCompLY}
			</if>
			<!-- 投保类型可以多选 -->
			<if test="condition.renewalTypes != null and condition.renewalTypes.size() > 0">
				and rc.renewalType in
				<foreach collection="condition.renewalTypes" item="renewalType" open="(" separator="," close=")">
					#{renewalType}
				</foreach> 
			</if>
			<if test="condition.customerLevel != null and condition.customerLevel.size() > 0">
	  			and rc.customerLevel in 
	  			<foreach collection="condition.customerLevel" item="level" open="(" separator="," close=")">
	  				#{level}
	  			</foreach>
  		    </if>
			<if test="condition.comeStoreNumber != null and condition.comeStoreNumber !=''">
				and rc.comeStoreNumber = #{condition.comeStoreNumber}
			</if>
			<if test="condition.principalId != null and condition.principalId !=''">
				and rc.principalId = #{condition.principalId}
			</if>
			<if test="condition.insurNumber != null and condition.insurNumber !=''">
				and rc.insurNumber = #{condition.insurNumber}
			</if>
			<if test="insurDateLYStart != null and insurDateLYStart !=''">
				<![CDATA[and  rc.insurDateLY  >=  #{insurDateLYStart,jdbcType=DATE} ]]>
			</if>
			<if test="insurDateLYEnd != null and insurDateLYEnd !=''">
				<![CDATA[and  rc.insurDateLY  <=  #{insurDateLYEnd,jdbcType=DATE} ]]>
			</if>
			<if test="insuranceEndDateStart != null and insuranceEndDateStart !=''">
				<![CDATA[and  rc.insuranceEndDate  >=  #{insuranceEndDateStart,jdbcType=DATE} ]]>
			</if>
			<if test="insuranceEndDateEnd != null and insuranceEndDateEnd !=''">
				<![CDATA[and  rc.insuranceEndDate  <=  #{insuranceEndDateEnd,jdbcType=DATE} ]]>
			</if>
			<if test="condition.isInvite != null ">
				and IFNULL(rc.isInvite,0) = #{condition.isInvite}
			</if>
			<if test="inviteDateStart != null and inviteDateStart !=''">
				<![CDATA[and  ca.inviteDate  >=  #{inviteDateStart,jdbcType=DATE} ]]>
			</if>
			<if test="inviteDateEnd != null and inviteDateEnd !=''">
				<![CDATA[and  ca.inviteDate  <=  #{inviteDateEnd,jdbcType=DATE} ]]>
			</if>
			<if test="condition.isComeStore != null">
				and rc.isComeStore = #{condition.isComeStore}
			</if>
			<if test="comeStoreDateStart != null and comeStoreDateStart !=''">
				<![CDATA[and  rc.comeStoreDate  >=  #{comeStoreDateStart,jdbcType=DATE} ]]>
			</if>
			<if test="comeStoreDateEnd != null and comeStoreDateEnd !=''">
				<![CDATA[and  rc.comeStoreDate  <=  #{comeStoreDateEnd,jdbcType=DATE} ]]>
			</if>
			<if test="lastTraceDateStart != null and lastTraceDateStart !=''">
				<![CDATA[and  DATE_FORMAT(rc.lastTraceDate,'%Y-%m-%d')  >=  #{lastTraceDateStart,jdbcType=DATE} ]]>
			</if>
			<if test="lastTraceDateEnd != null and lastTraceDateEnd !=''">
				<![CDATA[and  DATE_FORMAT(rc.lastTraceDate,'%Y-%m-%d')  <=  #{lastTraceDateEnd,jdbcType=DATE} ]]>
			</if>
			<if test="condition.isQuote != null ">
				and rc.isQuote = #{condition.isQuote}
			</if>
			<if test="quoteDateStart != null and quoteDateStart !=''">
				<![CDATA[and  rc.quoteDate  >=  #{quoteDateStart,jdbcType=DATE} ]]>
			</if>
			<if test="quoteDateEnd != null and quoteDateEnd !=''">
				<![CDATA[and  rc.quoteDate  <=  #{quoteDateEnd,jdbcType=DATE} ]]>
			</if>
			<if test="traceDateStart != null and traceDateStart !=''">
				<![CDATA[and  rc.willingTraceDate  >=  #{traceDateStart,jdbcType=DATE} ]]>
			</if>
			<if test="traceDateEnd != null and traceDateEnd !=''">
				<![CDATA[and  rc.willingTraceDate  <=  #{traceDateEnd,jdbcType=DATE} ]]>
			</if>
			<if test="zdZheKouStart != null and zdZheKouStart !=''">
	             <![CDATA[and  rc.zdZheKou  >=  #{zdZheKouStart} ]]>
	        </if>
	        <if test="zdZheKouEnd != null and zdZheKouEnd !=''">
	             <![CDATA[and  rc.zdZheKou  <=  #{zdZheKouEnd} ]]>
	        </if>
			<if test="remainLostInsurDayStart != null and remainLostInsurDayStart !=''">
				<![CDATA[and  rc.virtualJqxdqr  >=  #{remainLostInsurDayStart,jdbcType=DATE}]]>
			</if>
			<if test="remainLostInsurDayEnd != null and remainLostInsurDayEnd !=''">
				<![CDATA[and  rc.virtualJqxdqr  <=  #{remainLostInsurDayEnd,jdbcType=DATE}]]>
			</if>
			<if test="remainLostInsurDayEnd != null and remainLostInsurDayEnd !='' and remainLostInsurDayStart != null and remainLostInsurDayStart !=''">
				and  rc.customerLevel not in('F','S','O') and rc.status=2
			</if>
			<!-- 添加车主,持有人查询条件 -->
			<if test="condition.carOwner != null and condition.carOwner !=''">
				and rc.carOwner like '%${condition.carOwner}%'
			</if>
			<if test="condition.holder != null and condition.holder !=''">
				and u.userName = #{condition.holder}
			</if>
			<if test="condition.sfgyx != null">
				and rc.sfgyx = #{condition.sfgyx}
			</if>
			<if test="condition.ifLoan != null">
				and rc.ifLoan = #{condition.ifLoan}
			</if>
			<if test="registrationDateStart != null and registrationDateStart !=''">
	 			<![CDATA[and  rc.registrationDate >=  #{registrationDateStart,jdbcType=DATE}]]>
	 		</if>
	 		<if test="registrationDateEnd != null and registrationDateEnd !=''">
	 			<![CDATA[and  rc.registrationDate <=  #{registrationDateEnd,jdbcType=DATE}]]>
	 		</if>
		</where>
		<!-- ORDER BY rc.id  -->
		<!-- short代表按某字段排序，shortmain 1：升序，2：降序 -->
	    <if test="short==null and shortmain==null">ORDER BY rc.id</if>
  	    <if test="short==2 and shortmain==1">ORDER BY rc.principal ASC</if>
  	    <if test="short==2 and shortmain==2">ORDER BY rc.principal DESC</if>
  	    <if test="short==3 and shortmain==1">ORDER BY rc.clerk ASC</if>
  	    <if test="short==3 and shortmain==2">ORDER BY rc.clerk DESC</if>
  	    <if test="short==4 and shortmain==1">ORDER BY rc.contact ASC</if>
  	    <if test="short==4 and shortmain==2">ORDER BY rc.contact DESC</if>
  	    <if test="short==5 and shortmain==1">ORDER BY rc.contactWay ASC</if>
  	    <if test="short==5 and shortmain==2">ORDER BY rc.contactWay DESC</if>
		<if test="short==6 and shortmain==1">ORDER BY rc.chassisNumber ASC</if>
  	    <if test="short==6 and shortmain==2">ORDER BY rc.chassisNumber DESC</if>
		<if test="short==7 and shortmain==1">ORDER BY rc.carLicenseNumber ASC</if>
  	    <if test="short==7 and shortmain==2">ORDER BY rc.carLicenseNumber DESC</if>
		<if test="short==8 and shortmain==1">ORDER BY ct.coverTypeName ASC</if>
  	    <if test="short==8 and shortmain==2">ORDER BY ct.coverTypeName DESC</if>
  	    <if test="short==9 and shortmain==1">ORDER BY DATE_FORMAT(rc.insuranceEndDate,'%m-%d') ASC</if>
  	    <if test="short==9 and shortmain==2">ORDER BY DATE_FORMAT(rc.insuranceEndDate,'%m-%d') DESC</if>
  	    <if test="short==10 and shortmain==1">ORDER BY rc.bhUpdateTime ASC</if>
  	    <if test="short==10 and shortmain==2">ORDER BY rc.bhUpdateTime DESC</if>
  	    <if test="short==11 and shortmain==1"> ORDER BY rc.customerLevel ASC</if>
  	    <if test="short==11 and shortmain==2"> ORDER BY rc.customerLevel DESC</if>
  	    <if test="short==12 and shortmain==1">ORDER BY rc.gotThroughNum ASC</if>
  	    <if test="short==12 and shortmain==2">ORDER BY rc.gotThroughNum DESC</if>
  	    <if test="short==13 and shortmain==1">ORDER BY rc.willingTraceDate ASC</if>
  	    <if test="short==13 and shortmain==2">ORDER BY rc.willingTraceDate DESC</if>
  	    <if test="short==14 and shortmain==1">ORDER BY rc.lastTraceDate ASC</if>
  	    <if test="short==14 and shortmain==2">ORDER BY rc.lastTraceDate DESC</if>
  	    <if test="short==15 and shortmain==1">ORDER BY rc.lastTraceResult ASC</if>
  	    <if test="short==15 and shortmain==2">ORDER BY rc.lastTraceResult DESC</if>
  	    <if test="short==16 and shortmain==1">ORDER BY ca.delayDate ASC</if>
  	    <if test="short==16 and shortmain==2">ORDER BY ca.delayDate DESC</if>
  	    <if test="short==17 and shortmain==1">ORDER BY rc.virtualJqxdqr ASC</if>
  	    <if test="short==17 and shortmain==2">ORDER BY rc.virtualJqxdqr DESC</if>
  	    <if test="short==18 and shortmain==1">ORDER BY ca.assignDate ASC</if>
  	    <if test="short==18 and shortmain==2">ORDER BY ca.assignDate DESC</if>
  	    <if test="short==19 and shortmain==1">ORDER BY holder ASC</if>
  	    <if test="short==19 and shortmain==2">ORDER BY holder DESC</if>
		LIMIT #{start,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}
	</select>
	<!-- 前台主管的潜客查询总数 -->
	<select id="findByConditionQtzgCount" resultType="Integer" parameterType="java.util.HashMap" >
		SELECT count(1)
		FROM bf_bip_renewaling_customer rc
		LEFT JOIN bf_bip_cover_type ct ON ct.coverType = rc.renewalType
		LEFT JOIN bf_bip_customer_assign ca ON ca.customerId = rc.customerId 
		INNER JOIN bf_bip_user u ON u.id = ca.userId 
		<where>
			fourSStoreId = #{fourSStoreId}
			and traceStatu != 3
			and acceptStatu != 1
			and ifnull(returnStatu,0) not in (2,5) 
			and u.roleId = 8 
			<if test="condition.carBrand != null and condition.carBrand !=''">
				and rc.carBrand = #{condition.carBrand}
			</if>
			<if test="condition.vehicleModel != null and condition.vehicleModel !=''">
				and rc.vehicleModel = #{condition.vehicleModel}
			</if>
			<if test="condition.chassisNumber != null and condition.chassisNumber !=''">
				and rc.chassisNumber like '%${condition.chassisNumber}%'
			</if>
			<if test="condition.carLicenseNumber != null and condition.carLicenseNumber !=''">
				and rc.carLicenseNumber like '%${condition.carLicenseNumber}%'
			</if>
			<if test="condition.insured != null and condition.insured !=''">
				and rc.insured = #{condition.insured}
			</if>
			<if test="condition.contact != null and condition.contact !=''">
				and rc.contact = #{condition.contact}
			</if>
			<if test="condition.contactWay != null and condition.contactWay !=''">
				and rc.contactWay like '%${condition.contactWay}%'
			</if>
			<if test="condition.insuranceCompLY != null and condition.insuranceCompLY !=''">
				and rc.insuranceCompLY = #{condition.insuranceCompLY}
			</if>
			<!-- 投保类型可以多选 -->
			<if test="condition.renewalTypes != null and condition.renewalTypes.size() > 0">
				and rc.renewalType in
				<foreach collection="condition.renewalTypes" item="renewalType" open="(" separator="," close=")">
					#{renewalType}
				</foreach> 
			</if>
			<if test="condition.customerLevel != null and condition.customerLevel.size() > 0">
	  			and rc.customerLevel in 
	  			<foreach collection="condition.customerLevel" item="level" open="(" separator="," close=")">
	  				#{level}
	  			</foreach>
  		    </if>
			<if test="condition.comeStoreNumber != null and condition.comeStoreNumber !=''">
				and rc.comeStoreNumber = #{condition.comeStoreNumber}
			</if>
			<if test="condition.principalId != null and condition.principalId !=''">
				and rc.principalId = #{condition.principalId}
			</if>
			<if test="condition.insurNumber != null and condition.insurNumber !=''">
				and rc.insurNumber = #{condition.insurNumber}
			</if>
			<if test="insurDateLYStart != null and insurDateLYStart !=''">
				<![CDATA[and  rc.insurDateLY  >=  #{insurDateLYStart,jdbcType=DATE} ]]>
			</if>
			<if test="insurDateLYEnd != null and insurDateLYEnd !=''">
				<![CDATA[and  rc.insurDateLY  <=  #{insurDateLYEnd,jdbcType=DATE} ]]>
			</if>
			<if test="insuranceEndDateStart != null and insuranceEndDateStart !=''">
				<![CDATA[and  rc.insuranceEndDate  >=  #{insuranceEndDateStart,jdbcType=DATE} ]]>
			</if>
			<if test="insuranceEndDateEnd != null and insuranceEndDateEnd !=''">
				<![CDATA[and  rc.insuranceEndDate  <=  #{insuranceEndDateEnd,jdbcType=DATE} ]]>
			</if>
			<if test="condition.isInvite != null">
				and IFNULL(rc.isInvite,0) = #{condition.isInvite}
			</if>
			<if test="inviteDateStart != null and inviteDateStart !=''">
				<![CDATA[and  ca.inviteDate  >=  #{inviteDateStart,jdbcType=DATE} ]]>
			</if>
			<if test="inviteDateEnd != null and inviteDateEnd !=''">
				<![CDATA[and  ca.inviteDate  <=  #{inviteDateEnd,jdbcType=DATE} ]]>
			</if>
			<if test="condition.isComeStore != null">
				and rc.isComeStore = #{condition.isComeStore}
			</if>
			<if test="comeStoreDateStart != null and comeStoreDateStart !=''">
				<![CDATA[and  rc.comeStoreDate  >=  #{comeStoreDateStart,jdbcType=DATE} ]]>
			</if>
			<if test="comeStoreDateEnd != null and comeStoreDateEnd !=''">
				<![CDATA[and  rc.comeStoreDate  <=  #{comeStoreDateEnd,jdbcType=DATE} ]]>
			</if>
			<if test="lastTraceDateStart != null and lastTraceDateStart !=''">
				<![CDATA[and  DATE_FORMAT(rc.lastTraceDate,'%Y-%m-%d')  >=  #{lastTraceDateStart,jdbcType=DATE} ]]>
			</if>
			<if test="lastTraceDateEnd != null and lastTraceDateEnd !=''">
				<![CDATA[and  DATE_FORMAT(rc.lastTraceDate,'%Y-%m-%d')  <=  #{lastTraceDateEnd,jdbcType=DATE} ]]>
			</if>
			<if test="condition.isQuote != null ">
				and rc.isQuote = #{condition.isQuote}
			</if>
			<if test="quoteDateStart != null and quoteDateStart !=''">
				<![CDATA[and  rc.quoteDate  >=  #{quoteDateStart,jdbcType=DATE} ]]>
			</if>
			<if test="quoteDateEnd != null and quoteDateEnd !=''">
				<![CDATA[and  rc.quoteDate  <=  #{quoteDateEnd,jdbcType=DATE} ]]>
			</if>
			<if test="traceDateStart != null and traceDateStart !=''">
				<![CDATA[and  rc.willingTraceDate  >=  #{traceDateStart,jdbcType=DATE} ]]>
			</if>
			<if test="traceDateEnd != null and traceDateEnd !=''">
				<![CDATA[and  rc.willingTraceDate  <=  #{traceDateEnd,jdbcType=DATE} ]]>
			</if>
			<if test="remainLostInsurDayStart != null and remainLostInsurDayStart !=''">
				<![CDATA[and  rc.virtualJqxdqr  >=  #{remainLostInsurDayStart,jdbcType=DATE}]]>
			</if>
			<if test="remainLostInsurDayEnd != null and remainLostInsurDayEnd !=''">
				<![CDATA[and  rc.virtualJqxdqr  <=  #{remainLostInsurDayEnd,jdbcType=DATE}]]>
			</if>
			<if test="remainLostInsurDayEnd != null and remainLostInsurDayEnd !='' and remainLostInsurDayStart != null and remainLostInsurDayStart !=''">
				and  rc.customerLevel not in('F','S','O') and rc.status=2
			</if>
			<!-- 添加车主,持有人查询条件 -->
			<if test="condition.carOwner != null and condition.carOwner !=''">
				and rc.carOwner like '%${condition.carOwner}%'
			</if>
			<if test="condition.holder != null and condition.holder !=''">
				and u.userName = #{condition.holder}
			</if>
			<if test="condition.sfgyx != null">
				and rc.sfgyx = #{condition.sfgyx}
			</if>
			<if test="condition.ifLoan != null">
				and rc.ifLoan = #{condition.ifLoan}
			</if>
			<if test="registrationDateStart != null and registrationDateStart !=''">
	 			<![CDATA[and  rc.registrationDate >=  #{registrationDateStart,jdbcType=DATE}]]>
	 		</if>
	 		<if test="registrationDateEnd != null and registrationDateEnd !=''">
	 			<![CDATA[and  rc.registrationDate <=  #{registrationDateEnd,jdbcType=DATE}]]>
	 		</if>
		</where>
	</select>
	<!-- APP已回退查询 -->
	<select id="findYHTCustomerAPP" resultType="java.util.Map" parameterType="java.util.HashMap">
		SELECT t.*, u.userName holder
		FROM(
			SELECT rc.fourSStoreId,rc.insuranceEndDate,rc.renewalType,rc.customerLevel,rc.contact,rc.contactWay,
				rc.principalId,rc.principal,rc.clerkId,rc.clerk,rc.status,rc.cusLostInsurStatu,rc.carLicenseNumber,
				rc.virtualJqxdqr,rc.lastTraceDate,rc.willingTraceDate,rc.lastTraceResult,rc.lastYearIsDeal,rc.chassisNumber,
				rc.firstAcceptDate,rc.factoryLicenseType,rc.carAnnualCheckUpDate,rc.insuredLY,rc.buyfromThisStore,
				rc.gotThroughNum,rc.contactWayReserve,ct.coverTypeName,ca.customerId,ca.userId,ca.traceStatu,
				ca.traceDate,ca.inviteStatu,ca.inviteDate,ca.acceptStatu,ca.acceptDate,ca.returnStatu,
				ca.returnDate,ca.customerTraceId,ca.assignDate,ca.delayDate
			FROM
				bf_bip_renewaling_customer rc
			LEFT JOIN bf_bip_cover_type ct ON ct.coverType = rc.renewalType,
			bf_bip_customer_assign ca JOIN bf_bip_user u ON (ca.userId = u.id)
			<where>
				rc.customerId = ca.customerId
				and rc.customerLevel != "O"
				and ca.userId = #{userId}
				<if test="returnStatu != null and returnStatu != ''">
					and ca.returnStatu = #{returnStatu,jdbcType=INTEGER}
				</if> 
				<if test="storeId != null and storeId != ''">
					and rc.fourSStoreId = #{storeId}
				</if> 
				<if test="renewalType != null and renewalType != ''">
					and rc.renewalType = #{renewalType}
				</if>
				<if test="insuranceCompLY != null and insuranceCompLY !=''">
					and rc.insuranceCompLY = #{insuranceCompLY}
				</if>
				<if test="customerLevel != null and customerLevel !=''">
					and rc.customerLevel = #{customerLevel}
				</if>
				<if test="insuranceEndDateStart != null and insuranceEndDateStart !=''">
					<![CDATA[and rc.insuranceEndDate >=  #{insuranceEndDateStart}]]>
				</if>
				<if test="insuranceEndDateEnd != null and insuranceEndDateEnd !=''">
					<![CDATA[and rc.insuranceEndDate <=  #{insuranceEndDateEnd}]]>
				</if>
				<if test="contact != null and contact !=''">
					and rc.contact = #{contact}
				</if>
				<if test="contactWay != null and contactWay !=''">
					and (rc.contactWay like '%${contactWay}%'
	 		        or rc.contactWayReserve like '%${contactWay}%'
	 		    )
				</if>
				<if test="carBrand != null and carBrand !=''">
					and rc.carBrand = #{carBrand}
				</if>
				<if test="vehicleModel != null and vehicleModel !=''">
					and rc.vehicleModel = #{vehicleModel}
				</if>
				<if test="chassisNumber != null and chassisNumber !=''">
					and rc.chassisNumber like '%${chassisNumber}%'
				</if>
				<if test="carLicenseNumber != null and carLicenseNumber !=''">
					and rc.carLicenseNumber like '%${carLicenseNumber}%'
				</if>
				<if test="insured != null and insured != ''">
					and rc.insured = #{insured}
				</if>
				<if test="carOwner != null and carOwner !=''">
					and rc.carOwner like '%${carOwner}%' 
				</if>
			</where>
			ORDER BY rc.id LIMIT #{start,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}
		) AS t
		LEFT JOIN bf_bip_customer_assign ca2 ON t.customerId = ca2.customerId
		AND ifnull(ca2.traceStatu, 0) != 3
		LEFT JOIN bf_bip_user u ON ca2.userId = u.id
	</select>
	<select id="findYHTCustomerCountAPP" resultType="Integer" parameterType="java.util.HashMap">
			SELECT count(1)
			FROM
				bf_bip_renewaling_customer rc
			LEFT JOIN bf_bip_cover_type ct ON ct.coverType = rc.renewalType,
			bf_bip_customer_assign ca JOIN bf_bip_user u ON (ca.userId = u.id)
			<where>
				rc.customerId = ca.customerId
				and rc.customerLevel != "O"
				and ca.userId = #{userId}
				<if test="returnStatu != null and returnStatu != ''">
					and ca.returnStatu = #{returnStatu,jdbcType=INTEGER}
				</if> 
				<if test="storeId != null and storeId != ''">
					and rc.fourSStoreId = #{storeId}
				</if> 
				<if test="renewalType != null and renewalType != ''">
					and rc.renewalType = #{renewalType}
				</if>
				<if test="insuranceCompLY != null and insuranceCompLY !=''">
					and rc.insuranceCompLY = #{insuranceCompLY}
				</if>
				<if test="customerLevel != null and customerLevel !=''">
					and rc.customerLevel = #{customerLevel}
				</if>
				<if test="insuranceEndDateStart != null and insuranceEndDateStart !=''">
					<![CDATA[and rc.insuranceEndDate >=  #{insuranceEndDateStart}]]>
				</if>
				<if test="insuranceEndDateEnd != null and insuranceEndDateEnd !=''">
					<![CDATA[and rc.insuranceEndDate <=  #{insuranceEndDateEnd}]]>
				</if>
				<if test="contact != null and contact !=''">
					and rc.contact = #{contact}
				</if>
				<if test="contactWay != null and contactWay !=''">
					and (rc.contactWay like '%${contactWay}%'
	 		        or rc.contactWayReserve like '%${contactWay}%'
	 		    )
				</if>
				<if test="carBrand != null and carBrand !=''">
					and rc.carBrand = #{carBrand}
				</if>
				<if test="vehicleModel != null and vehicleModel !=''">
					and rc.vehicleModel = #{vehicleModel}
				</if>
				<if test="chassisNumber != null and chassisNumber !=''">
					and rc.chassisNumber like '%${chassisNumber}%'
				</if>
				<if test="carLicenseNumber != null and carLicenseNumber !=''">
					and rc.carLicenseNumber like '%${carLicenseNumber}%'
				</if>
				<if test="insured != null and insured != ''">
					and rc.insured = #{insured}
				</if>
				<if test="carOwner != null and carOwner !=''">
					and rc.carOwner like '%${carOwner}%' 
				</if>
			</where>
	</select>
	<!-- APP已失销查询 -->
	<select id="findYSXCustomerAPP" resultType="java.util.Map" parameterType="java.util.HashMap">
		SELECT t.*, u.userName holder
		FROM(
			SELECT rc.fourSStoreId,rc.insuranceEndDate,rc.renewalType,rc.customerLevel,rc.contact,rc.contactWay,
				rc.principalId,rc.principal,rc.clerkId,rc.clerk,rc.status,rc.cusLostInsurStatu,rc.carLicenseNumber,
				rc.virtualJqxdqr,rc.lastTraceDate,rc.willingTraceDate,rc.lastTraceResult,rc.lastYearIsDeal,rc.chassisNumber,
				rc.firstAcceptDate,rc.factoryLicenseType,rc.carAnnualCheckUpDate,rc.insuredLY,rc.buyfromThisStore,
				rc.gotThroughNum,rc.contactWayReserve,ct.coverTypeName,ca.customerId,ca.userId,ca.traceStatu,
				ca.traceDate,ca.inviteStatu,ca.inviteDate,ca.acceptStatu,ca.acceptDate,ca.returnStatu,
				ca.returnDate,ca.customerTraceId,ca.assignDate,ca.delayDate
			FROM
				bf_bip_renewaling_customer rc
			LEFT JOIN bf_bip_cover_type ct ON ct.coverType = rc.renewalType,
			bf_bip_customer_assign ca JOIN bf_bip_user u ON (ca.userId = u.id)
			<where>
				rc.customerId = ca.customerId
				and rc.customerLevel != "O"
				<if test="returnStatu != null and returnStatu != ''">
					and ca.returnStatu = #{returnStatu,jdbcType=INTEGER}
				</if> 
				<if test="storeId != null and storeId != ''">
					and rc.fourSStoreId = #{storeId}
				</if> 
				<if test="userId != null and userId != ''">
					and ca.userId = #{userId}
				</if>
				<if test="roleId != null and roleId != ''">
					and u.roleId = #{roleId}
				</if>
				<if test="renewalType != null and renewalType != ''">
					and rc.renewalType = #{renewalType}
				</if>
				<if test="insuranceCompLY != null and insuranceCompLY !=''">
					and rc.insuranceCompLY = #{insuranceCompLY}
				</if>
				<if test="customerLevel != null and customerLevel !=''">
					and rc.customerLevel = #{customerLevel}
				</if>
				<if test="insuranceEndDateStart != null and insuranceEndDateStart !=''">
					<![CDATA[and rc.insuranceEndDate >=  #{insuranceEndDateStart}]]>
				</if>
				<if test="insuranceEndDateEnd != null and insuranceEndDateEnd !=''">
					<![CDATA[and rc.insuranceEndDate <=  #{insuranceEndDateEnd}]]>
				</if>
				<if test="contact != null and contact !=''">
					and rc.contact = #{contact}
				</if>
				<if test="contactWay != null and contactWay !=''">
					and rc.contactWay like '%${contactWay}%'
				</if>
				<if test="carBrand != null and carBrand !=''">
					and rc.carBrand = #{carBrand}
				</if>
				<if test="vehicleModel != null and vehicleModel !=''">
					and rc.vehicleModel = #{vehicleModel}
				</if>
				<if test="chassisNumber != null and chassisNumber !=''">
					and rc.chassisNumber like '%${chassisNumber}%'
				</if>
				<if test="carLicenseNumber != null and carLicenseNumber !=''">
					and rc.carLicenseNumber like '%${carLicenseNumber}%'
				</if>
				<if test="insured != null and insured != ''">
					and rc.insured = #{insured}
				</if>
				<if test="carOwner != null and carOwner !=''">
					and rc.carOwner like '%${carOwner}%' 
				</if>
			</where>
			ORDER BY rc.id LIMIT #{start,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}
		) AS t
		LEFT JOIN bf_bip_customer_assign ca2 ON t.customerId = ca2.customerId
		AND ifnull(ca2.traceStatu, 0) != 3
		LEFT JOIN bf_bip_user u ON ca2.userId = u.id
	</select>
	<select id="findYSXCustomerCountAPP" resultType="Integer" parameterType="java.util.HashMap">
			SELECT count(1)
			FROM
				bf_bip_renewaling_customer rc
			LEFT JOIN bf_bip_cover_type ct ON ct.coverType = rc.renewalType,
			bf_bip_customer_assign ca JOIN bf_bip_user u ON (ca.userId = u.id)
			<where>
				rc.customerId = ca.customerId
				and rc.customerLevel != "O"
				<if test="returnStatu != null and returnStatu != ''">
					and ca.returnStatu = #{returnStatu,jdbcType=INTEGER}
				</if> 
				<if test="storeId != null and storeId != ''">
					and rc.fourSStoreId = #{storeId}
				</if> 
				<if test="userId != null and userId != ''">
					and ca.userId = #{userId}
				</if>
				<if test="roleId != null and roleId != ''">
					and u.roleId = #{roleId}
				</if>
				<if test="renewalType != null and renewalType != ''">
					and rc.renewalType = #{renewalType}
				</if>
				<if test="insuranceCompLY != null and insuranceCompLY !=''">
					and rc.insuranceCompLY = #{insuranceCompLY}
				</if>
				<if test="customerLevel != null and customerLevel !=''">
					and rc.customerLevel = #{customerLevel}
				</if>
				<if test="insuranceEndDateStart != null and insuranceEndDateStart !=''">
					<![CDATA[and rc.insuranceEndDate >=  #{insuranceEndDateStart}]]>
				</if>
				<if test="insuranceEndDateEnd != null and insuranceEndDateEnd !=''">
					<![CDATA[and rc.insuranceEndDate <=  #{insuranceEndDateEnd}]]>
				</if>
				<if test="contact != null and contact !=''">
					and rc.contact = #{contact}
				</if>
				<if test="contactWay != null and contactWay !=''">
					and rc.contactWay like '%${contactWay}%'
				</if>
				<if test="carBrand != null and carBrand !=''">
					and rc.carBrand = #{carBrand}
				</if>
				<if test="vehicleModel != null and vehicleModel !=''">
					and rc.vehicleModel = #{vehicleModel}
				</if>
				<if test="chassisNumber != null and chassisNumber !=''">
					and rc.chassisNumber like '%${chassisNumber}%'
				</if>
				<if test="carLicenseNumber != null and carLicenseNumber !=''">
					and rc.carLicenseNumber like '%${carLicenseNumber}%'
				</if>
				<if test="insured != null and insured != ''">
					and rc.insured = #{insured}
				</if>
				<if test="carOwner != null and carOwner !=''">
					and rc.carOwner like '%${carOwner}%' 
				</if>
			</where>
	</select>
	<!-- APP没有状态查询潜客 -->
	<select id="findByConditionAPP" resultType="java.util.HashMap" parameterType="java.util.HashMap" >
		SELECT
			c.*,ct.coverTypeName,ca.*,u.userName holder,u.roleId holderRoleId 
		from bf_bip_customer c 
		LEFT JOIN bf_bip_renewaling_customer rc on c.customerId = rc.customerId
		left join bf_bip_cover_type ct on ct.coverType = c.renewalType 
		left join  bf_bip_customer_assign ca on c.customerId = ca.customerId and ifnull(ca.traceStatu,0) != 3
		left JOIN bf_bip_user u ON ca.userId = u.id 
		<where>
			<if test="returnStatu != null and returnStatu != ''">
				and ca.returnStatu = #{returnStatu,jdbcType=INTEGER}
			</if> 
			<if test="storeId != null and storeId != ''">
				and c.fourSStoreId = #{storeId}
			</if> 
			<if test="userId != null and userId != ''">
				and ca.userId = #{userId}
			</if> 
			<if test="roleId != null and roleId != ''">
				and u.roleId = #{roleId}
			</if> 
			<if test="renewalType != null and renewalType != ''">
				and c.renewalType = #{renewalType}
			</if>
			<if test="insuranceCompLY != null and insuranceCompLY !=''">
				and c.insuranceCompLY = #{insuranceCompLY}
			</if>
			<if test="customerLevel != null and customerLevel !=''">
				and c.customerLevel = #{customerLevel}
			</if>
			<if test="insuranceEndDateStart != null and insuranceEndDateStart !=''">
				<![CDATA[and c.insuranceEndDate >=  #{insuranceEndDateStart}]]>
			</if>
			<if test="insuranceEndDateEnd != null and insuranceEndDateEnd !=''">
				<![CDATA[and c.insuranceEndDate <=  #{insuranceEndDateEnd}]]>
			</if>
			<if test="contact != null and contact !=''">
				and c.contact = #{contact}
			</if>
			<if test="contactWay != null and contactWay !=''">
				and c.contactWay like '%${contactWay}%'
			</if>
			<if test="carBrand != null and carBrand !=''">
				and c.carBrand = #{carBrand}
			</if>
			<if test="vehicleModel != null and vehicleModel !=''">
				and c.vehicleModel = #{vehicleModel}
			</if>
			<if test="chassisNumber != null and chassisNumber !=''">
				and c.chassisNumber like '%${chassisNumber}%'
			</if>
			<if test="carLicenseNumber != null and carLicenseNumber !=''">
				and c.carLicenseNumber like '%${carLicenseNumber}%'
			</if>
			<if test="insured != null and insured != ''">
				and c.insured = #{insured}
			</if>
			<if test="carOwner != null and carOwner !=''">
				and c.carOwner like '%${carOwner}%' 
			</if>
			<if test="principalId != null">
				and c.principalId = #{principalId} 
			</if>
			<if test="holderId != null">
				and ca.userId = #{holderId} 
			</if>
		</where>
		ORDER BY rc.id LIMIT #{start,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}
	</select>
	<select id="findByConditionCountAPP" resultType="Integer" parameterType="java.util.HashMap" >
		SELECT count(1)
		from bf_bip_customer c 
		LEFT JOIN bf_bip_renewaling_customer rc on c.customerId = rc.customerId
		left join bf_bip_cover_type ct on ct.coverType = c.renewalType 
		left join  bf_bip_customer_assign ca on c.customerId = ca.customerId and ifnull(ca.traceStatu,0) != 3
		left JOIN bf_bip_user u ON ca.userId = u.id 
		<where>
			<if test="returnStatu != null and returnStatu != ''">
				and ca.returnStatu = #{returnStatu,jdbcType=INTEGER}
			</if> 
			<if test="storeId != null and storeId != ''">
				and c.fourSStoreId = #{storeId}
			</if> 
			<if test="userId != null and userId != ''">
				and ca.userId = #{userId}
			</if> 
			<if test="roleId != null and roleId != ''">
				and u.roleId = #{roleId}
			</if> 
			<if test="renewalType != null and renewalType != ''">
				and c.renewalType = #{renewalType}
			</if>
			<if test="insuranceCompLY != null and insuranceCompLY !=''">
				and c.insuranceCompLY = #{insuranceCompLY}
			</if>
			<if test="customerLevel != null and customerLevel !=''">
				and c.customerLevel = #{customerLevel}
			</if>
			<if test="insuranceEndDateStart != null and insuranceEndDateStart !=''">
				<![CDATA[and c.insuranceEndDate >=  #{insuranceEndDateStart}]]>
			</if>
			<if test="insuranceEndDateEnd != null and insuranceEndDateEnd !=''">
				<![CDATA[and c.insuranceEndDate <=  #{insuranceEndDateEnd}]]>
			</if>
			<if test="contact != null and contact !=''">
				and c.contact = #{contact}
			</if>
			<if test="contactWay != null and contactWay !=''">
				and c.contactWay like '%${contactWay}%'
			</if>
			<if test="carBrand != null and carBrand !=''">
				and c.carBrand = #{carBrand}
			</if>
			<if test="vehicleModel != null and vehicleModel !=''">
				and c.vehicleModel = #{vehicleModel}
			</if>
			<if test="chassisNumber != null and chassisNumber !=''">
				and c.chassisNumber like '%${chassisNumber}%'
			</if>
			<if test="carLicenseNumber != null and carLicenseNumber !=''">
				and c.carLicenseNumber like '%${carLicenseNumber}%'
			</if>
			<if test="insured != null and insured != ''">
				and c.insured = #{insured}
			</if>
			<if test="carOwner != null and carOwner !=''">
				and c.carOwner like '%${carOwner}%' 
			</if>
			<if test="principalId != null">
				and c.principalId = #{principalId} 
			</if>
			<if test="holderId != null">
				and ca.userId = #{holderId} 
			</if>
		</where>
	</select>
	
	<!-- 已回退查询 -->
	<select id="findByYiHuiTui" resultMap="BaseResultMap" parameterType="java.util.HashMap">
		select 
			t.*,
			e.traceStatu,
			e.traceDate,
			e.inviteStatu,
			e.inviteDate,
			e.acceptStatu,
			e.acceptDate,
			e.returnStatu,
			e.returnDate,
			e.customerTraceId,
			e.assignDate,
			e.delayDate,
			d.userName holder,
			d.id holderId,
			d.roleId holderRoleId from (
				SELECT
				a.fourSStoreId,
				a.insuranceEndDate,
				a.renewalType,
				a.customerLevel,
				a.contact,
				a.contactWay,
				a.principalId,
				a.principal,
				a.clerkId,
				a.clerk,
				a. STATUS,
				a.cusLostInsurStatu,
				a.carLicenseNumber,
				a.virtualJqxdqr,
				a.lastTraceDate,
				a.willingTraceDate,
				a.lastTraceResult,
				a.lastYearIsDeal,
				a.chassisNumber,
				a.firstAcceptDate,
				a.factoryLicenseType,
				a.carAnnualCheckUpDate,
				a.insuredLY,
				a.buyfromThisStore,
				a.gotThroughNum,
				a.contactWayReserve,
				a.sfgyx,
				b.coverTypeName,
				a.customerId,
				d.userName htr
			FROM
				bf_bip_cover_type b,
				bf_bip_operation_record c,
				bf_bip_user d,
				bf_bip_renewaling_customer a
			LEFT JOIN bf_bip_customer_assign e ON a.customerId = e.customerId
			<where>
		  	 	a.renewalType = b.coverType
				AND a.customerId = c.customerId
				AND c.operationFlag = 2
				AND c.userId = d.id
				AND c.userId = e.userId
			  	<if test="storeId != null and storeId != ''">
			  		and a.fourSStoreId = #{storeId}
			  	</if>
			  	<if test="userId != null and userId != ''">
			  		and c.userId = #{userId}
			  	</if>
			  	<if test="roleId != null and roleId != ''">
			  		and d.roleId = #{roleId}
			  	</if>
			  	<if test="startTime != null and startTime != ''">
			  		<![CDATA[and c.operationDate >= #{startTime,jdbcType=DATE}]]>
			  	</if> 
			  	<if test="endTime != null and endTime != ''">
			  		<![CDATA[and c.operationDate <= #{endTime,jdbcType=DATE}]]>
			  	</if>
			  	<if test="renewalType != null and renewalType != ''">
						and a.renewalType = #{renewalType}
				</if>
				<if test="insuranceCompLY != null and insuranceCompLY !=''">
					and a.insuranceCompLY = #{insuranceCompLY}
				</if>
				<if test="customerLevel != null and customerLevel !=''">
					and a.customerLevel = #{customerLevel}
				</if>
				<if test="insuranceEndDateStart != null and insuranceEndDateStart !=''">
					<![CDATA[and a.insuranceEndDate >=  #{insuranceEndDateStart}]]>
				</if>
				<if test="insuranceEndDateEnd != null and insuranceEndDateEnd !=''">
					<![CDATA[and a.insuranceEndDate <=  #{insuranceEndDateEnd}]]>
				</if>
				<if test="contact != null and contact !=''">
					and a.contact = #{contact}
				</if>
				<if test="contactWay != null and contactWay !=''">
					and (a.contactWay like '%${contactWay}%'
	 		        or a.contactWayReserve like '%${contactWay}%'
	 		    )
				</if>
				<if test="carBrand != null and carBrand !=''">
					and a.carBrand = #{carBrand}
				</if>
				<if test="vehicleModel != null and vehicleModel !=''">
					and a.vehicleModel = #{vehicleModel}
				</if>
				<if test="chassisNumber != null and chassisNumber !=''">
					and a.chassisNumber like '%${chassisNumber}%'
				</if>
				<if test="carLicenseNumber != null and carLicenseNumber !=''">
					and a.carLicenseNumber like '%${carLicenseNumber}%'
				</if>
				<if test="insured != null and insured != ''">
					and a.insured = #{insured}
				</if>
				<if test="carOwner != null and carOwner !=''">
					and a.carOwner like '%${carOwner}%' 
				</if>
				<if test="operatorID != null and operatorID != ''">
					and c.userId = #{operatorID}
				</if>
				<if test="short==2 and shortmain==1"> ORDER BY a.principal ASC</if>
		  	    <if test="short==2 and shortmain==2"> ORDER BY a.principal DESC</if>
		  	    <if test="short==3 and shortmain==1"> ORDER BY a.clerk ASC</if>
		  	    <if test="short==3 and shortmain==2"> ORDER BY a.clerk DESC</if>
		  	    <if test="short==4 and shortmain==1"> ORDER BY a.contact ASC</if>
		  	    <if test="short==4 and shortmain==2"> ORDER BY a.contact DESC</if>
		  	    <if test="short==5 and shortmain==1"> ORDER BY a.contactWay ASC</if>
		  	    <if test="short==5 and shortmain==2"> ORDER BY a.contactWay DESC</if>
		  	    <if test="short==6 and shortmain==1"> ORDER BY a.chassisNumber ASC</if>
		  	    <if test="short==6 and shortmain==2"> ORDER BY a.chassisNumber DESC</if>
		  	    <if test="short==7 and shortmain==1"> ORDER BY a.carLicenseNumber ASC</if>
		  	    <if test="short==7 and shortmain==2"> ORDER BY a.carLicenseNumber DESC</if>
		  	    <if test="short==8 and shortmain==1"> ORDER BY b.coverTypeName ASC</if>
		  	    <if test="short==8 and shortmain==2"> ORDER BY b.coverTypeName DESC</if>
		  	    <if test="short==9 and shortmain==1"> ORDER BY DATE_FORMAT(a.insuranceEndDate,'%m-%d') ASC</if>
		  	    <if test="short==9 and shortmain==2"> ORDER BY DATE_FORMAT(a.insuranceEndDate,'%m-%d') DESC</if>
		  	    <if test="short==10 and shortmain==1"> ORDER BY a.bhUpdateTime ASC</if>
		  	    <if test="short==10 and shortmain==2"> ORDER BY a.bhUpdateTime DESC</if>
		  	    <if test="short==11 and shortmain==1"> ORDER BY a.customerLevel ASC</if>
  	            <if test="short==11 and shortmain==2"> ORDER BY a.customerLevel DESC</if>
		  	    <if test="short==12 and shortmain==1"> ORDER BY a.gotThroughNum ASC</if>
		  	    <if test="short==12 and shortmain==2"> ORDER BY a.gotThroughNum DESC</if>
		  	    <if test="short==13 and shortmain==1"> ORDER BY a.willingTraceDate ASC</if>
		  	    <if test="short==13 and shortmain==2"> ORDER BY a.willingTraceDate DESC</if>
		  	    <if test="short==14 and shortmain==1"> ORDER BY a.lastTraceDate ASC</if>
		  	    <if test="short==14 and shortmain==2"> ORDER BY a.lastTraceDate DESC</if>
		  	    <if test="short==15 and shortmain==1"> ORDER BY a.lastTraceResult ASC</if>
		  	    <if test="short==15 and shortmain==2"> ORDER BY a.lastTraceResult DESC</if>
		  	    <if test="short==16 and shortmain==1"> ORDER BY e.delayDate ASC</if>
		  	    <if test="short==16 and shortmain==2"> ORDER BY e.delayDate DESC</if>
		  	    <if test="short==17 and shortmain==1"> ORDER BY a.virtualJqxdqr ASC</if>
		  	    <if test="short==17 and shortmain==2"> ORDER BY a.virtualJqxdqr DESC</if>
		  	    <if test="short==18 and shortmain==1"> ORDER BY e.assignDate ASC</if>
		  	    <if test="short==18 and shortmain==2"> ORDER BY e.assignDate DESC</if>
		  	    <if test="short==19 and shortmain==1"> ORDER BY htr ASC</if>
		  	    <if test="short==19 and shortmain==2"> ORDER BY htr DESC</if>
		  	 </where>
		) t LEFT JOIN bf_bip_customer_assign e on t.customerId = e.customerId and IFNULL(e.traceStatu,0) !=3
			LEFT JOIN bf_bip_user d on e.userId = d.id
			<where>
				<if test="holder != null and holder !=''">
					and d.userName = #{holder}
				</if>
				<if test="roleId1 != null and roleId1 != ''">
			  		and d.roleId = #{roleId1}
			  	</if>
			</where>
			LIMIT #{start,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}
  	</select>
  	<!-- 已回退查询总数 -->
	<select id="countFindByYiHuiTui" resultType="java.lang.Integer" parameterType="java.util.HashMap">
  	 	select count(1) from (
	  	 	SELECT
				a.customerId
			FROM
				bf_bip_cover_type b,
				bf_bip_operation_record c,
				bf_bip_user d,
				bf_bip_renewaling_customer a
			LEFT JOIN bf_bip_customer_assign e ON a.customerId = e.customerId
			<where>
		  	 	a.renewalType = b.coverType
				AND a.customerId = c.customerId
				AND c.operationFlag = 2
				AND c.userId = d.id
				AND c.userId = e.userId
			  	<if test="storeId != null and storeId != ''">
			  		and a.fourSStoreId = #{storeId}
			  	</if>
			  	<if test="userId != null and userId != ''">
			  		and c.userId = #{userId}
			  	</if>
			  	<if test="roleId != null and roleId != ''">
			  		and d.roleId = #{roleId}
			  	</if>
			  	<if test="startTime != null and startTime != ''">
			  		<![CDATA[and c.operationDate >= #{startTime,jdbcType=DATE}]]>
			  	</if> 
			  	<if test="endTime != null and endTime != ''">
			  		<![CDATA[and c.operationDate <= #{endTime,jdbcType=DATE}]]>
			  	</if>
			  	<if test="renewalType != null and renewalType != ''">
						and a.renewalType = #{renewalType}
				</if>
				<if test="insuranceCompLY != null and insuranceCompLY !=''">
					and a.insuranceCompLY = #{insuranceCompLY}
				</if>
				<if test="customerLevel != null and customerLevel !=''">
					and a.customerLevel = #{customerLevel}
				</if>
				<if test="insuranceEndDateStart != null and insuranceEndDateStart !=''">
					<![CDATA[and a.insuranceEndDate >=  #{insuranceEndDateStart}]]>
				</if>
				<if test="insuranceEndDateEnd != null and insuranceEndDateEnd !=''">
					<![CDATA[and a.insuranceEndDate <=  #{insuranceEndDateEnd}]]>
				</if>
				<if test="contact != null and contact !=''">
					and a.contact = #{contact}
				</if>
				<if test="contactWay != null and contactWay !=''">
					and (a.contactWay like '%${contactWay}%'
	 		        or a.contactWayReserve like '%${contactWay}%'
	 		    )
				</if>
				<if test="carBrand != null and carBrand !=''">
					and a.carBrand = #{carBrand}
				</if>
				<if test="vehicleModel != null and vehicleModel !=''">
					and a.vehicleModel = #{vehicleModel}
				</if>
				<if test="chassisNumber != null and chassisNumber !=''">
					and a.chassisNumber like '%${chassisNumber}%'
				</if>
				<if test="carLicenseNumber != null and carLicenseNumber !=''">
					and a.carLicenseNumber like '%${carLicenseNumber}%'
				</if>
				<if test="insured != null and insured != ''">
					and a.insured = #{insured}
				</if>
				<if test="carOwner != null and carOwner !=''">
					and a.carOwner like '%${carOwner}%' 
				</if>
				<if test="operatorID != null and operatorID != ''">
					and c.userId = #{operatorID}
				</if>
		  	 </where>
  	 	) t LEFT JOIN bf_bip_customer_assign e on t.customerId = e.customerId and IFNULL(e.traceStatu,0) !=3
			LEFT JOIN bf_bip_user d on e.userId = d.id
			<where>
				<if test="holder != null and holder !=''">
					and d.userName = #{holder}
				</if>
				<if test="roleId1 != null and roleId1 != ''">
			  		and d.roleId = #{roleId1}
			  	</if>
			</where>
  	</select>
  	
  		<!-- 已回退查询总数 -->
	<select id="findByReturnStatuGzjl" resultType="java.lang.Integer" parameterType="java.util.HashMap">
  	 	select count(1) from (
	  	 	SELECT
				a.customerId
			FROM
				bf_bip_cover_type b,
				bf_bip_operation_record c,
				bf_bip_user d,
				bf_bip_renewaling_customer a
			LEFT JOIN bf_bip_customer_assign e ON a.customerId = e.customerId
			<where>
		  	 	a.renewalType = b.coverType
				AND a.customerId = c.customerId
				AND c.operationFlag = 2
				AND c.userId = d.id
				AND c.userId = e.userId
			  	<if test="storeId != null and storeId != ''">
			  		and a.fourSStoreId = #{storeId}
			  	</if>
			  	<if test="userId != null and userId != ''">
			  		and c.userId = #{userId}
			  	</if>
			  	<if test="roleId != null and roleId != ''">
			  		and d.roleId = #{roleId}
			  	</if>
			  	<if test="startTime != null and startTime != ''">
			  		<![CDATA[and c.operationDate >= #{startTime,jdbcType=DATE}]]>
			  	</if> 
			  	<if test="endTime != null and endTime != ''">
			  		<![CDATA[and c.operationDate <= #{endTime,jdbcType=DATE}]]>
			  	</if>
			  	<if test="renewalType != null and renewalType != ''">
						and a.renewalType = #{renewalType}
				</if>
				<if test="insuranceCompLY != null and insuranceCompLY !=''">
					and a.insuranceCompLY = #{insuranceCompLY}
				</if>
				<if test="customerLevel != null and customerLevel !=''">
					and a.customerLevel = #{customerLevel}
				</if>
				<if test="insuranceEndDateStart != null and insuranceEndDateStart !=''">
					<![CDATA[and a.insuranceEndDate >=  #{insuranceEndDateStart}]]>
				</if>
				<if test="insuranceEndDateEnd != null and insuranceEndDateEnd !=''">
					<![CDATA[and a.insuranceEndDate <=  #{insuranceEndDateEnd}]]>
				</if>
				<if test="contact != null and contact !=''">
					and a.contact = #{contact}
				</if>
				<if test="contactWay != null and contactWay !=''">
					and a.contactWay like '%${contactWay}%'
				</if>
				<if test="carBrand != null and carBrand !=''">
					and a.carBrand = #{carBrand}
				</if>
				<if test="vehicleModel != null and vehicleModel !=''">
					and a.vehicleModel = #{vehicleModel}
				</if>
				<if test="chassisNumber != null and chassisNumber !=''">
					and a.chassisNumber like '%${chassisNumber}%'
				</if>
				<if test="carLicenseNumber != null and carLicenseNumber !=''">
					and a.carLicenseNumber like '%${carLicenseNumber}%'
				</if>
				<if test="insured != null and insured != ''">
					and a.insured = #{insured}
				</if>
				<if test="carOwner != null and carOwner !=''">
					and a.carOwner like '%${carOwner}%' 
				</if>
				<if test="operatorID != null and operatorID != ''">
					and c.userId = #{operatorID}
				</if>
		  	 </where>
  	 	) t LEFT JOIN bf_bip_customer_assign e on t.customerId = e.customerId and IFNULL(e.traceStatu,0) !=3
			LEFT JOIN bf_bip_user d on e.userId = d.id
			<where>
				<if test="holder != null and holder !=''">
					and d.userName = #{holder}
				</if>
				<if test="roleId1 != null and roleId1 != ''">
			  		and d.roleId = #{roleId1}
			  	</if>
			</where>
  	</select>
  	
	<!-- APP顾问跟踪完成潜客列表查询 -->
	<select id="findGZFinishedCustomer" resultType="java.util.HashMap" parameterType="java.util.HashMap">
		SELECT t.*, u.userName holder
		FROM(
			SELECT rc.fourSStoreId,rc.insuranceEndDate,rc.renewalType,rc.customerLevel,rc.contact,rc.contactWay,
				rc.principalId,rc.principal,rc.clerkId,rc.clerk,rc.status,rc.cusLostInsurStatu,rc.carLicenseNumber,
				rc.virtualJqxdqr,rc.lastTraceDate,rc.willingTraceDate,rc.lastTraceResult,rc.lastYearIsDeal,rc.chassisNumber,
				rc.firstAcceptDate,rc.factoryLicenseType,rc.carAnnualCheckUpDate,rc.insuredLY,
				ct.coverTypeName,
				ca.customerId,ca.userId,ca.traceStatu,ca.traceDate,ca.inviteStatu,ca.inviteDate,ca.acceptStatu,
				ca.acceptDate,ca.returnStatu,ca.returnDate,ca.customerTraceId,ca.assignDate,ca.delayDate
			FROM
				bf_bip_renewaling_customer rc
			LEFT JOIN bf_bip_cover_type ct ON ct.coverType = rc.renewalType,
			bf_bip_customer_assign ca JOIN bf_bip_user u ON (ca.userId = u.id)
			<where>
				rc.customerId = ca.customerId
				and rc.customerLevel != "O"
				<if test="userId != null">
					and ca.userId = #{userId}
				</if>
				<if test="roleId != null">
					and u.roleId = #{roleId}
				</if>
				<if test="returnStatu != null and returnStatu != ''">
					and ca.returnStatu = #{returnStatu,jdbcType=INTEGER}
				</if> 
				<if test="startTime != null and startTime != ''">
					<![CDATA[and ca.returnDate >= #{startTime,jdbcType=DATE}]]>
				</if> 
				<if test="endTime != null and endTime != ''">
					<![CDATA[and ca.returnDate <= #{endTime,jdbcType=DATE}]]>
				</if>
				<if test="storeId != null and storeId != ''">
					and rc.fourSStoreId = #{storeId}
				</if> 
				<if test="renewalType != null and renewalType != ''">
					and rc.renewalType = #{renewalType}
				</if>
				<if test="insuranceCompLY != null and insuranceCompLY !=''">
					and rc.insuranceCompLY = #{insuranceCompLY}
				</if>
				<if test="customerLevel != null and customerLevel !=''">
					and rc.customerLevel = #{customerLevel}
				</if>
				<if test="insuranceEndDateStart != null and insuranceEndDateStart !=''">
					<![CDATA[and rc.insuranceEndDate >=  #{insuranceEndDateStart}]]>
				</if>
				<if test="insuranceEndDateEnd != null and insuranceEndDateEnd !=''">
					<![CDATA[and rc.insuranceEndDate <=  #{insuranceEndDateEnd}]]>
				</if>
				<if test="contact != null and contact !=''">
					and rc.contact = #{contact}
				</if>
				<if test="contactWay != null and contactWay !=''">
					and rc.contactWay like '%${contactWay}%'
				</if>
				<if test="carBrand != null and carBrand !=''">
					and rc.carBrand = #{carBrand}
				</if>
				<if test="vehicleModel != null and vehicleModel !=''">
					and rc.vehicleModel = #{vehicleModel}
				</if>
				<if test="chassisNumber != null and chassisNumber !=''">
					and rc.chassisNumber like '%${chassisNumber}%'
				</if>
				<if test="carLicenseNumber != null and carLicenseNumber !=''">
					and rc.carLicenseNumber like '%${carLicenseNumber}%'
				</if>
				<if test="insured != null and insured != ''">
					and rc.insured = #{insured}
				</if>
				<if test="carOwner != null and carOwner !=''">
					and rc.carOwner like '%${carOwner}%' 
				</if>
			</where>
			ORDER BY rc.lastTraceDate desc LIMIT #{start,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}
		) AS t
		LEFT JOIN bf_bip_customer_assign ca2 ON t.customerId = ca2.customerId AND ifnull(ca2.traceStatu, 0) != 3
		LEFT JOIN bf_bip_user u ON ca2.userId = u.id
	</select>
	<!-- APP顾问跟踪完成潜客列表查询总数 -->
	<select id="findGZFinishedCustomerCount" resultType="Integer" parameterType="java.util.HashMap">
		SELECT count(1)
		FROM bf_bip_renewaling_customer rc
		LEFT JOIN bf_bip_cover_type ct ON ct.coverType = rc.renewalType,
		bf_bip_customer_assign ca JOIN bf_bip_user u ON (ca.userId = u.id)
		<where>
			rc.customerId = ca.customerId
			and rc.customerLevel != "O"
			<if test="userId != null">
				and ca.userId = #{userId}
			</if>
			<if test="roleId != null">
				and u.roleId = #{roleId}
			</if>
			<if test="returnStatu != null and returnStatu != ''">
				and ca.returnStatu = #{returnStatu,jdbcType=INTEGER}
			</if> 
			<if test="startTime != null and startTime != ''">
				<![CDATA[and ca.returnDate >= #{startTime,jdbcType=DATE}]]>
			</if> 
			<if test="endTime != null and endTime != ''">
				<![CDATA[and ca.returnDate <= #{endTime,jdbcType=DATE}]]>
			</if>
			<if test="storeId != null and storeId != ''">
				and rc.fourSStoreId = #{storeId}
			</if>
			<if test="renewalType != null and renewalType != ''">
				and rc.renewalType = #{renewalType}
			</if>
			<if test="insuranceCompLY != null and insuranceCompLY !=''">
				and rc.insuranceCompLY = #{insuranceCompLY}
			</if>
			<if test="customerLevel != null and customerLevel !=''">
				and rc.customerLevel = #{customerLevel}
			</if>
			<if test="insuranceEndDateStart != null and insuranceEndDateStart !=''">
				<![CDATA[and rc.insuranceEndDate >=  #{insuranceEndDateStart}]]>
			</if>
			<if test="insuranceEndDateEnd != null and insuranceEndDateEnd !=''">
				<![CDATA[and rc.insuranceEndDate <=  #{insuranceEndDateEnd}]]>
			</if>
			<if test="contact != null and contact !=''">
				and rc.contact = #{contact}
			</if>
			<if test="contactWay != null and contactWay !=''">
				and rc.contactWay like '%${contactWay}%'
			</if>
			<if test="carBrand != null and carBrand !=''">
				and rc.carBrand = #{carBrand}
			</if>
			<if test="vehicleModel != null and vehicleModel !=''">
				and rc.vehicleModel = #{vehicleModel}
			</if>
			<if test="chassisNumber != null and chassisNumber !=''">
				and rc.chassisNumber like '%${chassisNumber}%'
			</if>
			<if test="carLicenseNumber != null and carLicenseNumber !=''">
				and rc.carLicenseNumber like '%${carLicenseNumber}%'
			</if>
			<if test="insured != null and insured != ''">
				and rc.insured = #{insured}
			</if>
			<if test="carOwner != null and carOwner !=''">
				and rc.carOwner like '%${carOwner}%' 
			</if>
		</where>
	</select>
	<!-- 修改邀约状态和邀约日期 -->
	<update id="updateInviteDateAndStatu" parameterType="java.util.HashMap">
		update bf_bip_renewaling_customer 
		<set>
			isInvite = #{isInvite},
			inviteDate = #{inviteDate}
		</set> 
		where customerId = #{customerId}
	</update>
	
	<!-- 修复正常状态的潜客进入到已脱保页面的数据 -->
	<update id="updateYtbCustomerByRepairData">
		update bf_bip_renewaling_customer a set a.cusLostInsurStatu =0 
		where a.cusLostInsurStatu =2 and a.status = 2 and DATEDIFF(a.virtualJqxdqr,CURDATE())>7
	</update>
	<!-- 修复正常状态的潜客进入到将脱保页面的数据 -->
	<update id="updateJtbCustomerByRepairData">
		update bf_bip_renewaling_customer a set a.cusLostInsurStatu =0 
		where a.cusLostInsurStatu =1 and a.status = 2 and DATEDIFF(a.virtualJqxdqr,CURDATE())>7
	</update>
	<!-- 统计某个角色持有的潜客数 -->
	<select id="countFindByRoleId" resultType="java.lang.Integer" parameterType="java.util.HashMap">
		SELECT count(1) 
		from bf_bip_renewaling_customer c
		inner join  bf_bip_customer_assign a on a.customerId = c.customerId
		inner join bf_bip_user u on u.id = a.userId 
		<where>
			ifnull(a.traceStatu, 0) != 3
			<if test="storeId != null and storeId != ''">
				and c.fourSStoreId = #{storeId}
			</if>
			<if test="roleId != null and roleId != ''">
				and u.roleId = #{roleId}
			</if>
		</where>
	</select>
	<!-- 更新刚导入的潜客，需要更新保险信息的潜客(小池子) -->
	<update id="updateBxMessageList" parameterType="java.util.List"> 
		<foreach item="item" collection="list" separator=";">
			update bf_bip_renewaling_customer
				<set>
		  		  <if test="item.jqxrqEnd != null">
	  		         insuranceEndDate = #{item.jqxrqEnd,jdbcType=DATE},
	  		      </if>
	  		      <if test="item.virtualJqxdqr != null">
	  		         virtualJqxdqr = #{item.virtualJqxdqr,jdbcType=DATE},
	  		      </if>
	  		      <if test="item.syxrqEnd != null">
	  		         syxrqEnd = #{item.syxrqEnd,jdbcType=DATE},
	  		      </if>
	  		      <if test="item.registrationDate != null">
	  		         registrationDate = #{item.registrationDate,jdbcType=DATE},
	  		      </if>
		  		  <if test="item.insuranceCompLY != null">
		  		     insuranceCompLY = #{item.insuranceCompLY,jdbcType=VARCHAR},
		  		  </if>
		  		  <if test="item.engineNumber != null">
	  		         engineNumber = #{item.engineNumber,jdbcType=VARCHAR},
	  		      </if>
	  		      <if test="item.factoryLicenseType != null">
	  		         factoryLicenseType = #{item.factoryLicenseType,jdbcType=VARCHAR},
	  		      </if>
	  		      <if test="item.carOwner != null">
	  		         carOwner =#{item.carOwner,jdbcType=VARCHAR},
		  		  </if>
		  		  <if test="item.insured != null">
		  		     insured =#{item.insured,jdbcType=VARCHAR},
		  		  </if>
		  		  <if test="item.customerCharacter != null">
		  		     customerCharacter =#{item.customerCharacter,jdbcType=VARCHAR},
		  		  </if>
		  		  <if test="item.insuranceTypeLY != null">
		  		     insuranceTypeLY =#{item.insuranceTypeLY,jdbcType=VARCHAR},
		  		  </if>
		  		  <if test="item.certificateNumber != null">
		  		     certificateNumber =#{item.certificateNumber,jdbcType=VARCHAR}
		  		  </if>
			   </set>
			   where id = #{item.id,jdbcType=INTEGER}
		</foreach>
	 </update>
	 <!-- 更新刚导入的潜客，需要更新保险信息的潜客(大池子) 单个-->
  	<!-- <update id="updateBxMessage" parameterType = "java.lang.Integer">
  		 update bf_bip_renewaling_customer
  		 <set>
  		     <if test="jqxrqEnd != null">
	  		     insuranceEndDate = #{jqxrqEnd,jdbcType=DATE},
	  		 </if>
	  		 <if test="syxrqEnd != null">
	  		     syxrqEnd = #{syxrqEnd,jdbcType=DATE}
	  		 </if>    
  		  </set>
  		   where customerId = #{id,jdbcType=INTEGER}
  	</update> -->
</mapper>